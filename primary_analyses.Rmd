---
title: "Hospital Moinhos de Vento | Projeto Toledo"
subtitle: "Análises Projeto Toledo - Adulto"
author: "Data Manager | Fernanda Kelly R. Silva"
date: "`r format(Sys.time(), '%A, %d de %B de %Y')`"
output: 
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 6    
    toc_float:   
      collapsed: yes
    code_folding: hide
    fig_caption: yes
    fig_height: 6
    fig_width: 7
    highlight: tango #Tango, pygments, kate, monochrome, espresso, zenburn, haddock, breezedark, e textmate.
    theme: flatly #cerulean, journal, flatly, darkly, readable, spacelab, united, cosmo, lumen, paper, sandstone, simplex e yeti.
    df_print: paged #kable, tibble e  paged
---

```{r eval=FALSE, include=FALSE}
library(stringr)
library(dplyr)
library(devtools)
library(lubridate)
library(DT)
library(reactable)
library(plotly)
library(sampling)
library(qwraps2)
library(reactable)
library(readxl)
library(writexl)
library(lme4)

source("/persistent-files/fernanda/Dados/DadosCompleto.R")

ajustes_exposicao <- read_excel("/persistent-files/fernanda/Dados/ajustes_exposição.xlsx") %>% 
                       janitor::clean_names()

imc_adolesc_who <- read_excel("/persistent-files/fernanda/Relatórios/Análises/Analise_Controle/imc_adolesc_who.xlsx") %>% 
                       janitor::clean_names() %>% 
                       dplyr::rename("sexo_tab" = sexo,
                                     "p5_tab"  = p5,
                                     "p85_tab" = p85,
                                     "p95_tab" = p95,
                                     "idade_mesestab" = idade_meses) %>% 
                        dplyr::mutate(merge_tab2 = merge_tab+10000)

#options(digits = 4)
options(scipen=999)
options(qwraps2_markup = "markdown")
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
##################
# BANCO DE DADOS #
##################

dados_completo <- dadosCompleto %>% 
                    dplyr::filter(elegivel_EL == 1 & elegivel_CPCR == 1) %>%  
                    dplyr::filter(LB_creation_date < Sys.Date())  %>% 
                    dplyr::select(!(ends_with("comment") | ends_with("metadata"))) %>%
  
                    #GERAL
                    dplyr::mutate(data_de_nascimento = base::as.Date(data_de_nascimento),
                                  LB_creation_date   = base::as.Date(LB_creation_date),
                                  
                                  # IDADE
                                  idade = base::floor((LB_creation_date - data_de_nascimento)/365.25),
                                  idade = base::as.numeric(idade),
                                  idade_dia = (LB_creation_date - data_de_nascimento),
                                  idade_mes = round((idade_dia*12/365.25),0),
                                  merge     = base::ifelse(sexo == "F", 
                                                           idade_mes+12000,
                                                           idade_mes+11000),
                                  idade_cat          = dplyr::case_when(idade < 18                ~ "1",
                                                                        idade >= 18 & idade < 65  ~ "2",
                                                                        idade >= 65               ~ "3"),
                                  idade_cat          = base::factor(idade_cat, levels = c("1", "2", "3")),
                                  idade_1865 = dplyr::case_when(idade_cat == 1 ~ "1",
                                                                   TRUE ~ "0"),
                                  idade_1865 = base::factor(idade_1865, levels = c("0", "1")),
                                  idade_cat4 = dplyr::case_when(idade < 18                ~ "1",
                                                                idade >= 18 & idade < 40  ~ "2",
                                                                idade >= 40 & idade < 65  ~ "3",
                                                                idade >= 65 ~ "4"),
                                  idade_cat4          = base::factor(idade_cat4, levels = c("1", "2", "3", "4")),
                               
                                  #SEXO
                                  sexo               = base::factor(sexo, levels = c("F", "M")),
                                  
                                  #RAÇA
                                  LB1                = factor(LB1, levels = c("1","2","3","4","5","6")),
                                  LB1_WBBO           = dplyr::case_when(LB1 == 1 ~ "White",
                                                                        LB1 == 2 ~ "Black",
                                                                        LB1 == 3 ~ "Brown",
                                                                        LB1 == 4 | LB1 == 5 | LB1 == 6 ~ "Others" ),
                                  LB1_WBBO            = base::factor(LB1_WBBO,  levels = c("White", "Black", "Brown", "Others")),
                                  LB1_WBO           = dplyr::case_when(LB1 == 1 ~ "Branco",
                                                                        LB1 == 2 ~ "Preto",
                                                                        TRUE ~ "Outros"),
                                  LB1_WBO           = base::factor(LB1_WBO,  levels = c("Branco", "Preto", "Outros")),
                                  
                                  #FUMANTE
                                  LB5                = base::factor(LB5,  levels = c("0", "1"))) %>% 
                                  
                    #OBESIDADE
                    dplyr::left_join(imc_adolesc_who, 
                                     by = c("merge" = "merge_tab2"))  %>% 
                    dplyr::mutate(p5  = base::ifelse(sexo == sexo_tab & idade_mes == idade_mesestab,
                                                    p5_tab,
                                                    NA_character_),
                                  p85 = base::ifelse(sexo == sexo_tab & idade_mes == idade_mesestab,
                                                      p85_tab,
                                                      NA_character_),
                                  p95 = base::ifelse(sexo == sexo_tab & idade_mes == idade_mesestab,
                                                      p95_tab,
                                                    NA_character_))  %>%  
                    dplyr::mutate(bmi   =  (LB4/(LB3/100)^2),
                                bmi_cat = dplyr::case_when(bmi > 30 ~ "1",
                                                           TRUE ~"0"),
                                bmi_cat = base::factor(bmi_cat,  levels = c("0", "1"))) %>%  

                    dplyr::mutate(percentil_imc = base::ifelse(bmi < p5, "1",
                                                               base::ifelse(bmi >= p5 & bmi < p85, "2",
                                                                            base::ifelse(bmi >= p85 & bmi < p95, "3",
                                                                                         base::ifelse(bmi >= p95, "4",
                                                                                                      NA_character_))))) %>%
                    dplyr::mutate(cat_imc = dplyr::case_when((idade < 18 & percentil_imc == "1") ~ "Baixo peso",
                                                             (idade < 18 & percentil_imc == "2") ~ "Eutrófico",
                                                             (idade < 18 & percentil_imc == "3") ~ "Sobrepeso",
                                                             (idade < 18 & percentil_imc == "4") ~ "Obeso",
                                                             
                                                             (idade >= 18 & bmi < 18.5) ~ "Baixo peso",
                                                             (idade >= 18 & bmi >= 18.5) & (idade >= 18 & bmi < 25) ~ "Eutrófico",
                                                             (idade >= 18 & bmi >= 25) & (idade >= 18 & bmi < 30)   ~ "Sobrepeso",
                                                             idade >= 18 & bmi >= 30 ~ "Obeso"),
                                  
                                  cat_imc  = base::factor(cat_imc,  levels = c("Baixo peso", "Eutrófico", "Sobrepeso", "Obeso")),
                                  cat_imc0 = dplyr::case_when(cat_imc == "Baixo peso" | cat_imc == "Eutrófico" | cat_imc == "Sobrepeso" ~ "Não Obeso",
                                                               cat_imc == "Obeso" ~ "Obeso"),
                                  cat_imc0 = base::factor(cat_imc0,  levels = c("Não Obeso", "Obeso"))) %>%  
                                  
                    #COMORBIDADES
                    dplyr::mutate(LB55h = base::ifelse(recruitment_number == 1000188,
                                                       0, LB55h)) %>% 
                    dplyr::mutate(hematological  = dplyr::case_when(LB55q == 1 | LB55r == 1 ~ "1",
                                                                   TRUE ~ "0"),
                                  mellitus       = dplyr::case_when(LB55i == 1 | LB55h == 1 ~ "1",
                                                                   TRUE ~ "0"),
                                  solidorgan     = dplyr::case_when(LB55o == 1 | LB55p == 1 ~ "1",
                                                                   TRUE ~ "0"),
                                  chronichepatic = dplyr::case_when(LB55l == 1 | LB55m == 1 ~ "1",
                                                                   TRUE ~ "0")) %>% 
                    dplyr::mutate(hematological  = base::factor(hematological,  levels = c("0", "1")),
                                  mellitus       = base::factor(mellitus,       levels = c("0", "1")),
                                  solidorgan     = base::factor(solidorgan,     levels = c("0", "1")),
                                  chronichepatic = base::factor(chronichepatic, levels = c("0", "1"))) %>% 
                    dplyr::mutate(cardio = dplyr::case_when(LB55a == 1 | LB55b == 1 |
                                                            LB55c == 1 | LB55f == 1 ~ "1",
                                                            TRUE ~ "0"),
                                  cardio = base::factor(cardio,  levels = c("0", "1"))) %>% 
                    #CHARLSON
                    dplyr::mutate(charlson_1 = 1*(LB55a + LB55b + LB55c + LB55e + LB55f + LB55g + LB55h + LB55j + LB55k + LB55l),
                                  charlson_2 = 2*(LB55d + LB55i + LB55n + LB55o + LB55q + LB55r),
                                  charlson_3 = 3*(LB55m),
                                  charlson_6 = 6*(LB55p + LB55s),
                                  lb_indice_charlson = charlson_1 + charlson_2 + charlson_3 + charlson_6,
                                  LB_indice_charlson_cat = dplyr::case_when(lb_indice_charlson >= 2 ~ "1",
                                                                            lb_indice_charlson == 1 ~ "2",
                                                                            lb_indice_charlson == 0 ~ "3",
                                                                            TRUE ~ "0"),
                                  LB_indice_charlson_cat1 = dplyr::case_when(lb_indice_charlson >= 1 ~ "1",
                                                                            TRUE ~ "0"),
                                  
                                  LB_indice_charlson_cat2 = dplyr::case_when(lb_indice_charlson >= 2 ~ "1",
                                                                            TRUE ~ "0"),
                                  LB_indice_charlson_cat = base::factor(LB_indice_charlson_cat,  levels = c("0", "1", "2", "3")),
                                  LB_indice_charlson_cat1 = base::factor(LB_indice_charlson_cat1,  levels = c("0", "1")),
                                  LB_indice_charlson_cat2 = base::factor(LB_indice_charlson_cat2,  levels = c("0", "1"))) %>% 
              
                    #STATUS VACINAL
                    dplyr::mutate(LB117 = base::as.Date(LB117),
                                  LB43  = base::as.Date(LB43),
                                  LB44  = base::as.Date(LB44),
                                  LB63  = base::as.Date(LB63, origin = "1970-01-01"),
                                  LB64  = base::as.Date(LB64),
                                  LB83  = base::as.Date(LB83),
                                  LB84  = base::as.Date(LB84)) %>% 
             
                    dplyr::mutate(mes_3dose = lubridate::month(LB44),
                                  ano_3dose = lubridate::year(LB44),
                                  mes_2dose = lubridate::month(LB64),
                                  ano_2dose = lubridate::year(LB64),
                                  mes_1dose = lubridate::month(LB84),
                                  ano_1dose = lubridate::year(LB84)) %>%
  
                    dplyr::mutate(dia_3dose   = dplyr::if_else(LB45 == 1, "05",
                                                         dplyr::if_else(LB45 == 2, "15", "25")),
                                  dia_2dose   = dplyr::if_else(LB65 == 1, "05",
                                                         dplyr::if_else(LB65 == 2, "15", "25")),
                                  dia_1dose   = dplyr::if_else(LB85 == 1, "05",
                                                         dplyr::if_else(LB85 == 2, "15", "25"))) %>%
              
                    dplyr::mutate(dia_3dose    = base::paste(ano_3dose, mes_3dose, dia_3dose, sep = "-"),
                                  dia_2dose    = base::paste(ano_2dose, mes_2dose, dia_2dose, sep = "-"),
                                  dia_1dose    = base::paste(ano_1dose, mes_1dose, dia_1dose, sep = "-")) %>% 
                
                    dplyr::mutate(dia_3dose   = base::as.Date(base::as.character(dia_3dose), "%Y-%m-%d"),
                                  dia_2dose   = base::as.Date(base::as.character(dia_2dose), "%Y-%m-%d"),
                                  dia_1dose   = base::as.Date(base::as.character(dia_1dose), "%Y-%m-%d")) %>%  
  
                    dplyr::mutate(data_3dose  = dplyr::coalesce(LB43,dia_3dose),
                                  data_2dose  = dplyr::coalesce(LB63,dia_2dose),
                                  data_1dose  = dplyr::coalesce(LB83,dia_1dose)) %>% 
                 
                    dplyr::mutate(data_dif_4dose  = difftime(LB117, data_4_dose, units = "day"),
                                  data_dif_3dose  = difftime(LB117, data_3dose, units = "day"),
                                  data_dif_2dose  = difftime(LB117, data_2dose, units = "day"),
                                  data_dif_1dose  = difftime(LB117, data_1dose, units = "day"),
                                  
                                  data_dif_4dose = base::as.numeric(data_dif_4dose),
                                  data_dif_3dose = base::as.numeric(data_dif_3dose),
                                  data_dif_2dose = base::as.numeric(data_dif_2dose),
                                  data_dif_1dose = base::as.numeric(data_dif_1dose)) %>% 
  
                    dplyr::mutate(LB40 = base::factor(LB40, levels = c("0", "1")),
                                  LB41 = base::factor(LB41, levels = c("1", "2", "3", "4"))) %>% 
                    dplyr::mutate(nenhuma_dose = dplyr::case_when(LB40 == 0 ~ 1,
                                                                TRUE ~ 0),
                                  uma_dose     = dplyr::case_when(LB41 == 1 & LB86 != "4" ~ 1,
                                                                   TRUE ~ 0),
                                  duas_dose    = dplyr::case_when(LB41 == 2 | LB86 == "4" ~ 1,
                                                                   TRUE ~ 0),
                                  tres_dose    = dplyr::case_when(LB41 == 3 ~ 1,
                                                                TRUE ~ 0),
                                  quatro_dose    = dplyr::case_when(LB41 == 4 ~ 1,
                                                                TRUE ~ 0)) %>% 
                                  dplyr::mutate(nenhuma_dose = base::factor(nenhuma_dose, levels = c("0", "1")),
                                                uma_dose     = base::factor(uma_dose,     levels = c("0", "1")),
                                                duas_dose    = base::factor(duas_dose,    levels = c("0", "1")),
                                                tres_dose    = base::factor(tres_dose,    levels = c("0", "1")),
                                                quatro_dose  = base::factor(quatro_dose,    levels = c("0", "1"))) %>%  
                                  dplyr::mutate(dose = dplyr::case_when(nenhuma_dose == 1 ~ "0",
                                                                        uma_dose     == 1 ~ "1",
                                                                        duas_dose    == 1 ~ "2",
                                                                        tres_dose    == 1 ~ "3",
                                                                        quatro_dose  == 1 ~ "4")) %>% 
                                  dplyr::mutate(dose = base::factor(dose, levels = c("0","1", "2", "3", "4"))) %>% 
  
                    #EXPOSIÇÃO MAICON
                    dplyr::mutate(data_ultimaDose = base::ifelse(LB40 == 1 & LB41 == 1,
                                                                 data_1dose,
                                                                 base::ifelse(LB40 == 1 & LB41 == 2,
                                                                              data_2dose,
                                                                              base::ifelse(LB40 == 1 & LB41 == 3,
                                                                                           data_3dose,
                                                                                           data_4_dose)))) %>% 
                    dplyr::mutate(data_ultimaDose = base::as.Date(data_ultimaDose, origin = "1970-01-01")) %>% 
                    dplyr::mutate(delta_tempo_dose =  LB117 - data_ultimaDose,
                                  delta_tempo_dose_cat3m = dplyr::case_when((LB40 == 0)  ~ 0,
                                                                            (LB40 == 1 & delta_tempo_dose <= 90) ~ 1,
                                                                            (LB40 == 1 & delta_tempo_dose > 90)  ~ 2),
                                  exp_primaria = dplyr::case_when((LB40 == 0) ~ 0,
                                                                  (delta_tempo_dose >= 7 & LB41 == 2 & LB86 == 3 & EL66 == 3) |
                                                                  (LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3) ~ 1,
                                                                  TRUE ~ 8),
                                  exp_sec_1d  = dplyr::case_when((LB40 == 0) ~ 0,
                                                                 (delta_tempo_dose >= 14 & LB41 == 1 & LB86 == 3) ~ 1,
                                                                  TRUE ~ 8) , 
                                  exp_sec_2d  = dplyr::case_when((LB40 == 0) ~ 0,
                                                                 (delta_tempo_dose >= 7 & LB41 == 2 & LB86 == 3 & EL66 == 3) ~ 1,
                                                                 TRUE ~ 8) , 
                                  exp_sec_3d  = dplyr::case_when((LB40 == 0) ~ 0,
                                                                 (delta_tempo_dose >= 7 & LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3) ~ 1,
                                                                 TRUE ~ 8),
                                  
                                  exp_sec     = dplyr::case_when((LB40 == 0) ~ 0,
                                                                  exp_sec_1d == 1 ~ 1,
                                                                  exp_sec_2d == 1 ~ 2,
                                                                  exp_sec_3d == 1 ~ 3,
                                                                 TRUE ~ 8),
                                  
                                  exp_sec_123d  = dplyr::case_when((LB40 == 0) ~ 0,
                                                                   (delta_tempo_dose >= 14 & LB41 == 1 & LB86 == 3) |
                                                                   (LB41 == 2 & LB86 == 3 & EL66 == 3) | 
                                                                   (LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3) ~ 1,
                                                                   TRUE ~ 8) , 
                                  exp_ter_2d  = dplyr::case_when((LB40 == 0) ~ 0,
                                                                 (delta_tempo_dose >= 7 & LB41 == 2 & LB86 == 3 & EL66 == 3) ~ 1,
                                                                 (delta_tempo_dose >= 15 & LB41 == 2 & LB86 == 2 & EL66 == 2) ~ 2,
                                                                 (delta_tempo_dose >= 14 & LB41 == 2 & LB86 == 1 & EL66 == 1) ~ 3,
                                                                 (delta_tempo_dose >= 14 & LB41 == 1 & LB86 == 4) ~ 4,
                                                                   TRUE ~ 8) , 
                                  exp_booster_pfizer  = dplyr::case_when(
                                                                 (delta_tempo_dose >= 7 & LB41 == 2 & LB86 == 3 & EL66 == 3) ~ 1,
                                                                 (delta_tempo_dose >= 7 & LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3) ~ 2,
                                                                 TRUE ~ 8) , 
                                  exp_booster  = dplyr::case_when((delta_tempo_dose >= 7 & LB41 == 2 & LB86 == 3 & EL66 == 3) |
                                                                  (delta_tempo_dose >= 15 & LB41 == 2 & LB86 == 2 & EL66 == 2) |
                                                                  (delta_tempo_dose >= 14 & LB41 == 2 & LB86 == 1 & EL66 == 1) |
                                                                  (delta_tempo_dose >= 14 & LB41 == 1 & LB86 == 4) ~ 0,
                                                                  (delta_tempo_dose >= 7 & LB41 == 3 & LB46 == 3) ~ 1,
                                                                  (delta_tempo_dose >= 15 & LB41 == 3 & LB46 == 2) ~ 2,
                                                                  (delta_tempo_dose >= 14 & LB41 == 3 & LB46 == 1) ~ 3,
                                                                  (delta_tempo_dose >= 14 & LB41 == 2 & EL66 == 4) ~ 4,
                                                                  TRUE ~ 8) , 
                                 exp_pfizer_sub_tempo  = dplyr::case_when(exp_primaria == 0 ~ 0,
                                                                          exp_primaria == 1 & delta_tempo_dose_cat3m == 1 ~ 1,
                                                                          exp_primaria == 1 & delta_tempo_dose_cat3m == 2 ~ 2,
                                                                    exp_primaria == 8 ~ 8))  %>% 
                      
                   #EXPOSIÇÃO
                   dplyr::mutate(exposicao =    dplyr::case_when(LB40 == 0 ~ "Nenhuma",
                 
                                                                 LB41 == 1 & LB86 == 3 ~ "1° Pfizer",
                                                                 LB41 == 2 & EL66 == 3 & LB86 == 3 ~ "1° e 2° Pfizer",
                                                                 LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 3 ~ "1°, 2° e 3° Pfizer",
                                                                 
                                                                 ((LB41 == 2 & EL66 == 3 & LB86 == 3) |
                                                                 (LB41 == 3 & EL66 == 3 & LB86 == 3 & LB46 == 3)) ~ "2° ou 3° Pfizer",
                                                                 ((LB41 == 1 & LB86 == 3) |
                                                                 (LB41 == 2 & LB86 == 3 & EL66 == 3) |
                                                                 (LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3)) ~ "1°, 2° ou 3° Pfizer",
                                 
                                                                 LB41 == 1 & LB86 == 4 ~ "1° Janssen",
                                                                 LB41 == 2 & EL66 == 4 & LB86 == 4 ~ "1° e 2° Janssen",
                                                                 LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 4 ~ "1°, 2° e 3° Janssen",
                                 
                                                                 LB41 == 1 & LB86 == 1 ~ "1° CoronaVac",
                                                                 LB41 == 2 & EL66 == 1 & LB86 == 1 ~ "1° e 2° CoronaVac",
                                                                 LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 1 ~ "1°, 2° e 3° CoronaVac",
                                 
                                                                 LB41 == 1 & LB86 == 2 ~ "1° AstraZeneca",
                                                                 LB41 == 2 & EL66 == 2 & LB86 == 2 ~ "1° e 2° AstraZeneca",
                                                                 LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 2 ~ "1°, 2° e 3° AstraZeneca",
                                 
                                                                 LB41 == 1 & LB86 == 5 ~ "1° Outra",
                                                                 LB41 == 2 & EL66 == 5 & LB86 == 5 ~ "1° e 2° Outra",
                                                                 LB41 == 3 & LB46 == 5 & EL66 == 5 & LB86 == 5 ~ "1°, 2° e 3° Outra",
    
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 3) ~ "1° e 2° Pfizer, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 3) ~ "1° e 2° Pfizer, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 3) ~ "1° e 2° Pfizer, 3° Janssen",

                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 1) ~ "1° e 2° CoronaVac, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 2) ~ "1° e 2° AstraZeneca, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 4) ~ "1° e 2° Janssen, 3° Pfizer",
                                                                 (LB41 == 3 & EL66 == 3 & LB86 == 4)             ~ "1° Janssen, 3° Pfizer",
                                                                 
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 1) ~ "1° CoronaVac e 2° AstraZeneca, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 1) ~ "1° CoronaVac e 2° Janssen, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 1) ~ "1° CoronaVac e 2° Pfizer, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 1) ~ "1° CoronaVac e 2° CoronaVac, 3° Pfizer",
                                                                 
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 2) ~ "1° AstraZeneca e 2° CoronaVac, 3° Pfizer", 
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 2) ~ "1° AstraZeneca e 2° Janssen, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 2) ~ "1° AstraZeneca e 2° Pfizer, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 2) ~ "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer",
                                                                 
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 4) ~ "1° Janssen e 2° CoronaVac, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 4) ~ "1° Janssen e 2° AstraZeneca, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 4) ~ "1° Janssen e 2° Pfizer, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 4) ~ "1° Janssen e 2° Janssen, 3° Pfizer",
                                                                 
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 3) ~ "1° Pfizer e 2° CoronaVac, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 3) ~ "1° Pfizer e 2° AstraZeneca, 3° Pfizer",
                                                                 (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 3) ~ "1° Pfizer e 2° Janssen, 3° Pfizer",
                                                                 
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 1) ~ "1° CoronaVac, 2° AstraZeneca, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 1) ~ "1° CoronaVac, 2° Pfizer, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 1) ~ "1° CoronaVac, 2° Janssen, 3° CoronaVac",  
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 2) ~ "1° AstraZeneca, 2° AstraZeneca, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 2) ~ "1° AstraZeneca, 2° AstraZeneca, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 2) ~ "1° AstraZeneca, 2° Pfizer, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 2) ~ "1° AstraZeneca, 2° Janssen, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 3) ~ "1° Pfizer, 2° CoronaVac, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 3) ~ "1° Pfizer, 2° AstraZeneca, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 3) ~ "1° Pfizer, 2° Pfizer, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 3) ~ "1° Pfizer, 2° Janssen, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 4) ~ "1° Janssen, 2° CoronaVac, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 4) ~ "1° Janssen, 2° AstraZeneca, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 4) ~ "1° Janssen, 2° Pfizer, 3° CoronaVac",
                                                                 (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 4) ~ "1° Janssen, 2° Janssen, 3° CoronaVac",  
                                                                 
                                                                (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 1) ~ "1° CoronaVac, 2° CoronaVac, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 1) ~ "1° CoronaVac, 2° AstraZeneca, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 1) ~ "1° CoronaVac, 2° Pfizer, 3° AstraZeneca", 
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 1) ~ "1° CoronaVac, 2° Janssen, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 2) ~ "1° AstraZeneca, 2° CoronaVac, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 2) ~ "1° AstraZeneca, 2° Pfizer, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 2) ~ "1° AstraZeneca, 2° Janssen, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 3) ~ "1° Pfizer, 2° CoronaVac, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 3) ~ "1° Pfizer, 2° AstraZeneca, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 3) ~ "1° Pfizer, 2° Pfizer, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 3) ~ "1° Pfizer, 2° Janssen, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 4) ~ "1° Janssen, 2° CoronaVac, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 4) ~ "1° Janssen, 2° AstraZeneca, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 4) ~ "1° Janssen, 2° Pfizer, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 4) ~ "1° Janssen, 2° Janssen, 3° AstraZeneca",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 1) ~ "1° CoronaVac, 2° CoronaVac, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 1) ~ "1° CoronaVac, 2° AstraZeneca, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 1) ~ "1° CoronaVac, 2° Pfizer, 3° Janssen",  
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 1) ~ "1° CoronaVac, 2° Janssen, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 2) ~ "1° AstraZeneca, 2° CoronaVac, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 2) ~ "1° AstraZeneca, 2° AstraZeneca, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 2) ~ "1° AstraZeneca, 2° Pfizer, 3° Janssen",  
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 2) ~ "1° AstraZeneca, 2° Janssen, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 3) ~ "1° Pfizer, 2° CoronaVac, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 3) ~ "1° Pfizer, 2° AstraZeneca, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 3) ~ "1° Pfizer, 2° Janssen, 3° Janssen",  
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 4) ~ "1° Janssen, 2° CoronaVac, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 4) ~ "1° Janssen, 2° AstraZeneca, 3° Janssen",
                                                                 (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 4) ~ "1° Janssen, 2° Pfizer, 3° Janssen" , 
                                                                 
                                                                 (LB41 == 2 & EL66 == 2 & LB86 == 4)    ~ "1° Janssen, 2° AstraZenecn" ,
                                                                 (LB41 == 2 & EL66 == 1 & LB86 == 4)    ~ "1° Janssen, 2° CoronaVac" ,

                                                                 (LB41 == 2 & LB86 == 1 & EL66 == 2) ~ "1° CoronaVac, 2° AstraZeneca",
                                                                 (LB41 == 2 & LB86 == 1 & EL66 == 3) ~ "1° CoronaVac, 2° Pfizer",
                                                                 (LB41 == 2 & LB86 == 1 & EL66 == 4) ~ "1° CoronaVac, 2° Janssen",
                                 
                                                                 (LB41 == 2 & LB86 == 2 & EL66 == 1) ~ "1° AstraZeneca, 2° CoronaVac",
                                                                 (LB41 == 2 & LB86 == 2 & EL66 == 3) ~ "1° AstraZeneca, 2° Pfizer",
                                                                 (LB41 == 2 & LB86 == 2 & EL66 == 4) ~ "1° AstraZeneca, 2° Janssen",
                             
                                                                 (LB41 == 2 & LB86 == 3 & EL66 == 1) ~ "1° Pfizer, 2° CoronaVac",
                                                                 (LB41 == 2 & LB86 == 3 & EL66 == 2) ~ "1° Pfizer, 2° CoronaVac",
                                                                 (LB41 == 2 & LB86 == 3 & EL66 == 4) ~ "1° Pfizer, 2° Janssen",
                                                                 
                                                                 (LB41 == 4 & LB86 == 2 & EL66 == 2 & LB46 == 3 & x4_dose == 2) ~ "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° AstraZeneca",
                                                                 (LB41 == 4 & LB86 == 2 & EL66 == 2 & LB46 == 3 & x4_dose == 4) ~ "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Janssen",
                                                                 (LB41 == 4 & LB86 == 2 & EL66 == 2 & LB46 == 3 & x4_dose == 3) ~ "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Pfizer",
                                                                 (LB41 == 4 & LB86 == 1 & EL66 == 1 & LB46 == 3 & x4_dose == 2) ~ "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° AstraZeneca",
                                                                 (LB41 == 4 & LB86 == 1 & EL66 == 1 & LB46 == 3 & x4_dose == 4) ~ "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° Janssen")) %>% 

                   
                   # GENOTIPAGEM
                   dplyr::mutate(omicron = dplyr::case_when(variante == "Omicron Ba.1" |
                                                            variante == "Omicron Ba.2" |
                                                            variante == "Omicron Ba.4" ~ "1",
                                                            is.na(variante) ~ NA_character_,
                                                            TRUE ~ "0")) %>% 
                      
                   # TEMPO
                    dplyr::mutate(data_dif_12dose = difftime(data_2dose, data_1dose,  units = "day"),
                                  data_dif_12dose = base::as.numeric(data_dif_12dose))  %>% 
  
                    dplyr::mutate(data_dif_2booter = difftime(data_3dose, data_2dose, units = "day"),
                                  data_dif_2booter = base::as.numeric(data_dif_2booter))  %>%
                   
                    dplyr::mutate(LB_creation_date = base::as.Date(LB_creation_date),
                                  LB_creation_date_ano = lubridate::year(LB_creation_date),
                                  data_estudo      = rep("2021-11-03", 4596),
                                  data_estudo      = base::as.Date(data_estudo)) %>% 
  
                    dplyr::mutate(data_dif_tempo   = difftime(LB_creation_date, data_estudo, units = "day"),
                                  data_dif_tempo   = base::as.numeric(data_dif_tempo)) %>% 
  
                    dplyr::mutate(data_dif_tempoDose   = dplyr::if_else(LB41 == 1,
                                                                        data_dif_1dose,
                                                                        dplyr::if_else(LB41 == 2,
                                                                                       data_dif_2dose,
                                                                                       dplyr::if_else(LB41 == 3,
                                                                                                      data_dif_3dose,
                                                                                                      data_dif_4dose))),
                                  
                                  data_dif_tempoDose   = base::as.numeric(data_dif_tempoDose)) %>%
  
                    dplyr::mutate(LB117 = base::as.character(LB117)) %>% 
                    dplyr::mutate(LB117 = base::ifelse(recruitment_number == 1002613,
                                                           "2022-02-21", 
                                                           base::ifelse(recruitment_number == 1002602,
                                                                        "2022-02-17",
                                                                        base::ifelse(recruitment_number == 3000139 | recruitment_number == 1002279 |
                                                                                     recruitment_number == 1003674 | recruitment_number == 3000179,
                                                                                     NA, LB117))))  %>% 
                    dplyr::mutate(LB117 = base::as.Date(base::as.character(LB117), "%Y-%m-%d"))  %>% 
    
  
                    dplyr::mutate(data_dif_tempoDoseC = difftime(LB_creation_date, LB117, units = "day"),
                                  data_dif_tempoDoseControle = dplyr::case_when(data_dif_tempoDoseC < 5 & resultado == 2 ~ "1",
                                                                                data_dif_tempoDoseC >= 5 | resultado == 1 ~ "0",
                                                                           is.na(data_dif_tempoDoseC) ~ NA_character_),
                                  data_dif_tempoDoseControle = base::factor(data_dif_tempoDoseControle, levels = c("0", "1"))) %>% 

                    dplyr::mutate(data_dif_tempoDoseM = dplyr::case_when(LB40 == 0 ~ "0M",
                                                                         LB40 == 1 & data_dif_tempoDose >= 7 & data_dif_tempoDose   < 30 ~ "1M",
                                                                         LB40 == 1 & data_dif_tempoDose >= 30 & data_dif_tempoDose  < 60 ~ "2M",
                                                                         LB40 == 1 & data_dif_tempoDose >= 60 & data_dif_tempoDose  < 90 ~ "3M",
                                                                         LB40 == 1 & data_dif_tempoDose >= 90 & data_dif_tempoDose  < 120 ~ "4M",
                                                                         LB40 == 1 & data_dif_tempoDose >= 120 & data_dif_tempoDose < 150 ~ "5M",
                                                                         LB40 == 1 & data_dif_tempoDose >= 150 & data_dif_tempoDose < 180 ~ "6M",
                                                                         LB40 == 1 & data_dif_tempoDose >= 180  ~ "7M",
                                                                         is.na(data_dif_tempoDose) ~ NA_character_),
                                  data_dif_tempoDoseM = base::factor(data_dif_tempoDoseM, levels = c("0M", "1M", "2M", "3M", "4M", "5M", "6M", "7M")),
                                  
                                  data_dif_tempoDose3M = dplyr::case_when(data_dif_tempoDoseM == "0M" ~"0",
                                                                          data_dif_tempoDoseM == "1M" | data_dif_tempoDoseM == "2M" |                                                                                                                         data_dif_tempoDoseM == "3M" ~ "1",                                                                                                                                                  data_dif_tempoDoseM == "4M" | data_dif_tempoDoseM == "5M" |                                                                                                                         data_dif_tempoDoseM == "6M" | data_dif_tempoDoseM == "7M"  ~ "2",
                                                                             TRUE ~ NA_character_ ),
                                  data_dif_tempoDose3M = base::factor(data_dif_tempoDose3M, levels = c("0", "1", "2"))) %>%

  
                    dplyr::mutate(semana   = lubridate::wday(LB_creation_date),
                                  mes      = lubridate::month(LB_creation_date),
                                  semana_do_estudo = ceiling(data_dif_tempo/6)) %>% 
  
                    #VARIADAS
                    dplyr::mutate(quartil_analise = dplyr::case_when(data_dif_tempo <= 56 ~ "Q1",
                                                                     data_dif_tempo >= 57  & data_dif_tempo < 115 ~ "Q2",
                                                                     data_dif_tempo >= 115 & data_dif_tempo < 173 ~ "Q3",
                                                                     data_dif_tempo >= 173 ~ "Q4")) %>% 
                     dplyr::group_by(semana_do_estudo) %>% 
                     dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                                   total_semana = n(),
                                   pfizer_semana_7dias    = sum(exp_primaria == "1", na.rm = T),
                                   pfizer_semana_doseplus = sum(exposicao == "2° ou 3° Pfizer", na.rm = T),
                                   taxa_positivos = positivos_semana / total_semana * 100,
                                   taxa_pfizer    = pfizer_semana_7dias / total_semana * 100) %>% 
                     dplyr::ungroup() %>% 
                
                     # ID que não foi possível verificar exposição
                     dplyr::filter(!(recruitment_number %in% c("1000568", "1002667", "1002786",
                                                               "1002832", "1003632", "1003686",
                                                               "1004221", "1004286", "1004321",
                                                               "1000783", "1001271", "1001309",
                                                               "1001976", "1001978", "1003223",
                                                               "1003607", "1004167", "4000056",
                                                               "4000094", "1003341", "1003627",
                                                               "1001811")))

```

```{r echo=TRUE, message=FALSE, warning=FALSE}

library(stringr)
library(dplyr)
library(devtools)
library(lubridate)
library(DT)
library(reactable)
library(plotly)
library(sampling)
library(qwraps2)
library(reactable)
library(readxl)
library(writexl)
library(lme4)

load("~/persistent-files/fernanda/Relatórios/Análises/Analise_Controle/Dados/dados_completo_2909.RData")
dados_completo <- dados_completo_2909 

# dados_completo_2909 <- dados_completo
# save(dados_completo_2909, file = "~/persistent-files/fernanda/Relatórios/Análises/dados_completo_2909.RData")
```

# Descritiva

```{r message=FALSE, warning=FALSE, include=FALSE}

options(qwraps2_markup = "markdown")

our_summary1 <-  
  list("Years" =
         list("Age, years – median (IQR)" = ~ qwraps2::median_iqr(idade, na_rm = TRUE),
              "Age, years – mean (SD)"    = ~ qwraps2::mean_sd(idade, denote_sd = "paren",  na_rm = TRUE)),
       "Age" =
       list("12 to 17 years – no/total no. (%)" = ~ qwraps2::n_perc(idade_cat4 == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "18 to 39 years – no/total no. (%)" = ~ qwraps2::n_perc(idade_cat4 == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "40 to 64 years – no/total no. (%)" = ~ qwraps2::n_perc(idade_cat4 == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "≥ 65 years – no/total no. (%)"     = ~ qwraps2::n_perc(idade_cat4 == 4, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       "Gender" =
          list("Female – no/total no. (%)" = ~ qwraps2::n_perc(sexo == "F", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
               "Male – no/total no. (%)" = ~ qwraps2::n_perc(sexo == "M", show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       "Self-reported ethnicity – no./total no. (%)" =
       list("White"            = ~ qwraps2::n_perc(LB1 == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Black"            = ~ qwraps2::n_perc(LB1 == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Brown"            = ~ qwraps2::n_perc(LB1 == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Yellow"           = ~ qwraps2::n_perc(LB1 == 4, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Indigenous"       = ~ qwraps2::n_perc(LB1 == 5, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Other"            = ~ qwraps2::n_perc(LB1 == 6, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       "Self-reported ethnicity (Agrupado) – no./total no. (%)" =
       list("White"            = ~ qwraps2::n_perc(LB1_WBBO == "White", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Black"            = ~ qwraps2::n_perc(LB1_WBBO == "Black", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Brown"            = ~ qwraps2::n_perc(LB1_WBBO == "Brown", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Others"           = ~ qwraps2::n_perc(LB1_WBBO == "Others", show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       "Healthcare professional" =
       list("Healthcare professional – no./total no. (%)" = ~ qwraps2::n_perc(LB6 == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "Pregnant" =
         list("Pregnant – no/total no. (%)" = ~ qwraps2::n_perc(LB7 == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "Comorbidities – no./total no. (%)" = 
       list("Current smoker"               = ~ qwraps2::n_perc(LB5       == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Obesity (Yes)"                = ~ qwraps2::n_perc(cat_imc0 == "Obeso", show_symbol = TRUE, na_rm = TRUE), 
            "Obesity (No )"                = ~ qwraps2::n_perc(cat_imc0 == "Não Obeso", show_symbol = TRUE, na_rm = TRUE),
            "Heart failure"                = ~ qwraps2::n_perc(LB55b          == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Ischemic heart disease"       = ~ qwraps2::n_perc(LB55a          == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE), 
            "Cerebrovascular disease"      = ~ qwraps2::n_perc(LB55c          == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE), 
            "Peripheral arterial disease"  = ~ qwraps2::n_perc(LB55f          == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Cognitive impairment"         = ~ qwraps2::n_perc(LB55e          == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE), 
            "Diabetes Mellitus"            = ~ qwraps2::n_perc(mellitus       == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Chronic pulmonary disease"    = ~ qwraps2::n_perc(LB55g          == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Chronic renal disease"        = ~ qwraps2::n_perc(LB55n          == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Chronic hepatic disease"      = ~ qwraps2::n_perc(chronichepatic == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Solid organ cancer"           = ~ qwraps2::n_perc(solidorgan     == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Hematological malignancy"     = ~ qwraps2::n_perc(hematological  == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),   
            "Connective tissue disease"    = ~ qwraps2::n_perc(LB55j == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "AIDS"                         = ~ qwraps2::n_perc(LB55s == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "BMI" = 
       list("Underweight – no/total no. (%)"   = ~ qwraps2::n_perc(cat_imc == "Baixo peso", show_symbol = TRUE, show_denom = "always", na_rm = TRUE), 
            "Normal weight – no/total no. (%)" = ~ qwraps2::n_perc(cat_imc == "Eutrófico", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Overweight – no/total no. (%)"    = ~ qwraps2::n_perc(cat_imc == "Sobrepeso", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Obese – no/total no. (%)"         = ~ qwraps2::n_perc(cat_imc == "Obeso", show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "Cardiovascular Disease" = 
       list("Cardiovascular Disease (Yes) – no./total no. (%)" = ~ qwraps2::n_perc(cardio == 1, show_symbol = TRUE, na_rm = TRUE), 
            "Cardiovascular Disease (No ) – no./total no. (%)" = ~ qwraps2::n_perc(cardio == 0, show_symbol = TRUE, na_rm = TRUE)),

       "Charlson comorbidity index " =
         list("Charlson comorbidity index (>=2) – no/total no. (%)" = ~ qwraps2::n_perc(LB_indice_charlson_cat == 1,
                                                                                        show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Charlson comorbidity index (= 1) – no/total no. (%)" = ~ qwraps2::n_perc(LB_indice_charlson_cat == 2,
                                                                                        show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Charlson comorbidity index (= 0) – no/total no. (%)" = ~ qwraps2::n_perc(LB_indice_charlson_cat == 3,
                                                                                        show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "Charlson comorbidity index (Agrupado) " =
         list("Charlson comorbidity index (= 0) – no/total no. (%)" = ~ qwraps2::n_perc(LB_indice_charlson_cat == 3,
                                                                                        show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Charlson comorbidity index (> 0) – no/total no. (%)" = ~ qwraps2::n_perc(LB_indice_charlson_cat == 1 | LB_indice_charlson_cat == 2,
                                                                                        show_symbol = TRUE,    show_denom = "always", na_rm = TRUE)),
       
       "Vaccination status – no./total no. (%)" = 
       list("Not vaccinated"                      = ~ qwraps2::n_perc(LB40 == 0, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Pfizer BNT162b2 -  1 dose"           = ~ qwraps2::n_perc(exp_sec_1d == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Pfizer BNT162b2 -  2 doses"          = ~ qwraps2::n_perc(exp_sec_2d == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Pfizer BNT162b2 -  3 doses"          = ~ qwraps2::n_perc(exp_sec_3d == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Pfizer BNT162b2 -  3 doses >= 7"     = ~ qwraps2::n_perc((delta_tempo_dose >= 7 & LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3),
                                                                      show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Pfizer BNT162b2 -  3 doses < 7"      = ~ qwraps2::n_perc((delta_tempo_dose < 7 & LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3),
                                                                      show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Pfizer BNT162b2 -  1, 2 or 3 doses"  = ~ qwraps2::n_perc(exp_sec_123d == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "Pfizer BNT162b2 -  2 or 3 doses"     = ~ qwraps2::n_perc(exp_primaria == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "AstraZeneca - 1 dose"                = ~ qwraps2::n_perc(exposicao == "1° AstraZeneca", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "CoronaVac - 1 dose"                  = ~ qwraps2::n_perc(exposicao == "1° CoronaVac", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "AstraZeneca - 2 doses"               = ~ qwraps2::n_perc(exp_ter_2d == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "CoronaVac - 2 doses"                 = ~ qwraps2::n_perc(exp_ter_2d == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE) ,
            "Janssen - 1 dose"                    = ~ qwraps2::n_perc(exp_ter_2d == 4, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            
            "Other regimens"                      = ~ qwraps2::n_perc(exp_sec_1d != 1 &
                                                                      exposicao  != "1° Pfizer" &   
                                                                      exp_sec_2d != 1 &
                                                                      exposicao  != "1° e 2° Pfizer" &   
                                                                      exp_sec_3d != 1 &
                                                                      exposicao  != "1°, 2° e 3° Pfizer" &   
                                                                      exposicao  != "1° AstraZeneca" &
                                                                      exposicao  != "1° CoronaVac" &
                                                                      exp_ter_2d != 2 &
                                                                      exposicao  != "1° e 2° CoronaVac" &
                                                                      exp_ter_2d != 3 &
                                                                      exposicao  != "1° e 2° AstraZeneca" &   
                                                                      exp_ter_2d != 4 &
                                                                      exposicao  !=  "1° Janssen" &
                                                                      LB40 != 0 &
                                                                      exposicao  !=  "Nenhuma", show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
        "Interval between 1 and 2 dose"  =
         list("Interval between 1 and 2 dose, days– median (IQR)" = ~ qwraps2::median_iqr(data_dif_12dose, na_rm = TRUE)),    
        "Interval between 2 and booster dose" =
         list("Interval between 2 and booster dose, days– median (IQR)" = ~ qwraps2::median_iqr(data_dif_2booter, na_rm = TRUE)),
        "Interval between last dose and symptom" =
         list("Interval between 1 dose and symptom, days– median (IQR)"       = ~ qwraps2::median_iqr(data_dif_1dose,na_rm = TRUE),
              "Interval between 2 dose and symptom, days– median (IQR)"       = ~ qwraps2::median_iqr(data_dif_2dose,na_rm = TRUE),
              "Interval between Booster dose and symptom, days– median (IQR)" = ~ qwraps2::median_iqr(data_dif_3dose,na_rm = TRUE),
              "Interval between last dose and symptom, days– median (IQR)"    = ~ qwraps2::median_iqr(data_dif_tempoDose,na_rm = TRUE),
              "Interval between last dose and symptom, days– mean (SD)"       = ~ qwraps2::mean_sd(data_dif_tempoDose, denote_sd = "paren",  na_rm = TRUE),
              "Interval between last dose and symptom > 90 days, no/total no. (%)"  = ~ qwraps2::n_perc(data_dif_tempoDose3M == 2,
                                                                                                  show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Interval between last dose and symptom (<5), no/total no. (%)" = ~ qwraps2::n_perc(data_dif_tempoDoseControle == 1,
                                                                                                  show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       "COVID (PCR-positive)"  =
         list("COVID (PCR-positive) – no/total no. (%)" = ~ qwraps2::n_perc(resultado == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE))
       )
```

## Completo

```{r message=FALSE, warning=FALSE,  results = "asis"}
####################
#      COMPLETO
###################
options(qwraps2_markup = "markdown")
completo_pcr <- qwraps2::summary_table(dados_completo, our_summary1)
completo_pcr

completo_pcr <- data.frame(completo_pcr)
completo_pcr$nome <- rownames(completo_pcr)

# print(completo_pcr,
#       rtitle = "Summary Statistics",
#       cnames = c("All participants"))
```

## Covid vs Não Covid 

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# POSITIVO E NEGATIVO
######################
options(qwraps2_markup = "markdown")
resultado_pcr <- qwraps2::summary_table(dplyr::group_by(dados_completo, resultado),
                           summaries = our_summary1)
resultado_pcr

resultado_pcr <- data.frame(resultado_pcr)
resultado_pcr$nome <- rownames(resultado_pcr)
```

## Pfizer vs Não Pfizer

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# PFIZER: 2 OU 3 DOSES
######################
options(qwraps2_markup = "markdown")
pfizer_23doses <- qwraps2::summary_table(dplyr::group_by(dados_completo, exp_sec_123d),
                           summaries = our_summary1)
pfizer_23doses

pfizer_23doses <- data.frame(pfizer_23doses)
pfizer_23doses$nome <- rownames(pfizer_23doses)
```

## Outros Regimes

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# Outros Regimes
######################
options(qwraps2_markup = "markdown")
outrosRegimes <- qwraps2::summary_table(dplyr::group_by(dados_completo, exposicao),
                           summaries = our_summary1)

tabExp <- dados_completo %>% 
                 dplyr::mutate(exposicao = base::factor(exposicao, levels = c("1° AstraZeneca, 2° AstraZeneca, 3° CoronaVac",
                                                                              "1° AstraZeneca, 2° AstraZeneca, 3° Janssen",
                                                                              "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° AstraZeneca",
                                                                              "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Janssen",
                                                                              "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Pfizer",
                                                                              "1° AstraZeneca, 2° CoronaVac",
                                                                              "1° AstraZeneca, 2° Pfizer",
                                                                              "1° CoronaVac, 2° CoronaVac, 3° AstraZeneca",
                                                                              "1° CoronaVac, 2° CoronaVac, 3° Janssen",
                                                                              "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° AstraZeneca",
                                                                              "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° Janssen",
                                                                              "1° e 2° AstraZeneca, 3° Pfizer",
                                                                              "1° e 2° CoronaVac, 3° Pfizer",
                                                                              "1° e 2° Janssen",
                                                                              "1° e 2° Outra",
                                                                              "1° e 2° Pfizer, 3° AstraZeneca",
                                                                              "1° e 2° Pfizer, 3° Janssen",
                                                                              "1° Janssen, 2° AstraZenecn",
                                                                              "1°, 2° e 3° AstraZeneca",
                                                                              "1°, 2° e 3° CoronaVac"))) %>% 
                 dplyr::summarise("1° AstraZeneca, 2° AstraZeneca, 3° CoronaVac"                   = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° CoronaVac",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° AstraZeneca, 3° Janssen"                     = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° AstraZeneca"      = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Janssen"          = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Pfizer"           = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Pfizer",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° CoronaVac"                                   = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° CoronaVac",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° Pfizer"                                      = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° Pfizer",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° CoronaVac, 2° CoronaVac, 3° AstraZeneca"                     = qwraps2::n_perc(exposicao  == "1° CoronaVac, 2° CoronaVac, 3° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° CoronaVac, 2° CoronaVac, 3° Janssen"                         = qwraps2::n_perc(exposicao  == "1° CoronaVac, 2° CoronaVac, 3° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° AstraZeneca"          = qwraps2::n_perc(exposicao  == "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° Janssen"              = qwraps2::n_perc(exposicao  == "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° AstraZeneca, 3° Pfizer"                                 = qwraps2::n_perc(exposicao  == "1° e 2° AstraZeneca, 3° Pfizer",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° CoronaVac, 3° Pfizer"                                   = qwraps2::n_perc(exposicao  == "1° e 2° CoronaVac, 3° Pfizer",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° Janssen"                                                = qwraps2::n_perc(exposicao  == "1° e 2° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° Outra"                                                  = qwraps2::n_perc(exposicao  == "1° e 2° Outra",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° Pfizer, 3° AstraZeneca"                                 = qwraps2::n_perc(exposicao  == "1° e 2° Pfizer, 3° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° Pfizer, 3° Janssen"                                     = qwraps2::n_perc(exposicao  == "1° e 2° Pfizer, 3° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° Janssen, 2° AstraZenecn"                                     = qwraps2::n_perc(exposicao  == "1° Janssen, 2° AstraZenecn",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1°, 2° e 3° AstraZeneca"                                        = qwraps2::n_perc(exposicao  == "1°, 2° e 3° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1°, 2° e 3° CoronaVac"                                          = qwraps2::n_perc(exposicao  == "1°, 2° e 3° CoronaVac",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE)) %>% 
                 base::t()

```

```{r echo=TRUE}
knitr::kable(tabExp,
             caption = "Outros Regimes",
             col.names =  ("n(%)"))   
```

Tabela de outros regimes por resultado:

```{r echo=TRUE, message=FALSE, warning=FALSE}

outros_regimes <- dados_completo %>% 
                   dplyr::filter(exp_sec_1d != 1 &
                                 exposicao  != "1° Pfizer" &   
                                 exp_sec_2d != 1 &
                                 exposicao  != "1° e 2° Pfizer" &   
                                 exp_sec_3d != 1 &
                                 exposicao  != "1°, 2° e 3° Pfizer" &   
                                 exposicao  != "1° AstraZeneca" &
                                 exposicao  != "1° CoronaVac" &
                                 exp_ter_2d != 2 &
                                 exposicao  != "1° e 2° CoronaVac" &
                                 exp_ter_2d != 3 &
                                 exposicao  != "1° e 2° AstraZeneca" &   
                                 exp_ter_2d != 4 &
                                 exposicao  !=  "1° Janssen" &
                                 LB40 != 0 &
                                 exposicao  !=  "Nenhuma")

outros_regimesC <- qwraps2::summary_table(dplyr::group_by(outros_regimes, resultado),
                                   summaries = our_summary1)
outros_regimesC

```

## 1° Dose Pfizer (exp_sec_1d)

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# PFIZER: exp_sec_1d
######################
options(qwraps2_markup = "markdown")
pfizer_exp_sec_1d <- qwraps2::summary_table(dplyr::group_by(dados_completo, exp_sec_1d),
                           summaries = our_summary1)
pfizer_exp_sec_1d

pfizer_exp_sec_1d <- data.frame(pfizer_exp_sec_1d)
pfizer_exp_sec_1d$nome <- rownames(pfizer_exp_sec_1d)
```

## 1° e 2° Dose Pfizer (exp_sec_2d)

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# PFIZER: exp_sec_2d
######################
options(qwraps2_markup = "markdown")
pfizerexp_sec_2d <- qwraps2::summary_table(dplyr::group_by(dados_completo, exp_sec_2d),
                           summaries = our_summary1)
pfizerexp_sec_2d

pfizerexp_sec_2d <- data.frame(pfizerexp_sec_2d)
pfizerexp_sec_2d$nome <- rownames(pfizerexp_sec_2d)
```

## 1°, 2° e 3° Dose Pfizer (exp_sec_3d)

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# PFIZER: exp_sec_3d
######################
options(qwraps2_markup = "markdown")
pfizerexp_sec_3d <- qwraps2::summary_table(dplyr::group_by(dados_completo, exp_sec_3d),
                           summaries = our_summary1)
pfizerexp_sec_3d

pfizerexp_sec_3d <- data.frame(pfizerexp_sec_3d)
pfizerexp_sec_3d$nome <- rownames(pfizerexp_sec_3d)
```

## 1° ou 2° ou 3° Dose Pfizer (exp_sec_123d)

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# PFIZER: exp_sec_123d
######################
options(qwraps2_markup = "markdown")
pfizerexp_sec_123d <- qwraps2::summary_table(dplyr::group_by(dados_completo, exp_sec_123d),
                           summaries = our_summary1)
pfizerexp_sec_123d

pfizerexp_sec_123d <- data.frame(pfizerexp_sec_123d)
pfizerexp_sec_123d$nome <- rownames(pfizerexp_sec_123d)
```

## 1° e 2° Dose Qualquer tipo (exp_ter_2d)

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# PFIZER: exp_ter_2d
######################
options(qwraps2_markup = "markdown")
pfizerexp_ter_2d <- qwraps2::summary_table(dplyr::group_by(dados_completo, exp_ter_2d),
                           summaries = our_summary1)
pfizerexp_ter_2d

pfizerexp_ter_2d <- data.frame(pfizerexp_ter_2d)
pfizerexp_ter_2d$nome <- rownames(pfizerexp_ter_2d)
```

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# PFIZER: exp_ter_2d
######################
options(qwraps2_markup = "markdown")
pfizerexp_ter_2d <- qwraps2::summary_table(dplyr::group_by(dados_completo, exposicao),
                           summaries = our_summary1)
pfizerexp_ter_2d

pfizerexp_ter_2d <- data.frame(pfizerexp_ter_2d)
pfizerexp_ter_2d$nome <- rownames(pfizerexp_ter_2d)



tabExp <- dados_completo %>% 
                 dplyr::mutate(exposicao = base::factor(exposicao, levels = c("1° AstraZeneca, 2° AstraZeneca, 3° CoronaVac",
                                                                              "1° AstraZeneca, 2° AstraZeneca, 3° Janssen",
                                                                              "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° AstraZeneca",
                                                                              "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Janssen",
                                                                              "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Pfizer",
                                                                              "1° AstraZeneca, 2° CoronaVac",
                                                                              "1° AstraZeneca, 2° Pfizer",
                                                                              "1° CoronaVac, 2° CoronaVac, 3° AstraZeneca",
                                                                              "1° CoronaVac, 2° CoronaVac, 3° Janssen",
                                                                              "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° AstraZeneca",
                                                                              "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° Janssen",
                                                                              "1° e 2° AstraZeneca, 3° Pfizer",
                                                                              "1° e 2° CoronaVac, 3° Pfizer",
                                                                              "1° e 2° Janssen",
                                                                              "1° e 2° Outra",
                                                                              "1° e 2° Pfizer, 3° AstraZeneca",
                                                                              "1° e 2° Pfizer, 3° Janssen",
                                                                              "1° Janssen, 2° AstraZenecn",
                                                                              "1°, 2° e 3° AstraZeneca",
                                                                              "1°, 2° e 3° CoronaVac"))) %>% 
                 dplyr::summarise("1° AstraZeneca, 2° AstraZeneca, 3° CoronaVac"                   = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° CoronaVac",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° AstraZeneca, 3° Janssen"                     = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° AstraZeneca"      = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Janssen"          = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Pfizer"           = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° AstraZeneca, 3° Pfizer, 4° Pfizer",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° CoronaVac"                                   = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° CoronaVac",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° AstraZeneca, 2° Pfizer"                                      = qwraps2::n_perc(exposicao  == "1° AstraZeneca, 2° Pfizer",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° CoronaVac, 2° CoronaVac, 3° AstraZeneca"                     = qwraps2::n_perc(exposicao  == "1° CoronaVac, 2° CoronaVac, 3° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° CoronaVac, 2° CoronaVac, 3° Janssen"                         = qwraps2::n_perc(exposicao  == "1° CoronaVac, 2° CoronaVac, 3° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° AstraZeneca"          = qwraps2::n_perc(exposicao  == "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° Janssen"              = qwraps2::n_perc(exposicao  == "1° CoronaVac, 2° CoronaVac, 3° Pfizer, 4° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° AstraZeneca, 3° Pfizer"                                 = qwraps2::n_perc(exposicao  == "1° e 2° AstraZeneca, 3° Pfizer",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° CoronaVac, 3° Pfizer"                                   = qwraps2::n_perc(exposicao  == "1° e 2° CoronaVac, 3° Pfizer",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° Janssen"                                                = qwraps2::n_perc(exposicao  == "1° e 2° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° Outra"                                                  = qwraps2::n_perc(exposicao  == "1° e 2° Outra",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° Pfizer, 3° AstraZeneca"                                 = qwraps2::n_perc(exposicao  == "1° e 2° Pfizer, 3° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° e 2° Pfizer, 3° Janssen"                                     = qwraps2::n_perc(exposicao  == "1° e 2° Pfizer, 3° Janssen",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1° Janssen, 2° AstraZenecn"                                     = qwraps2::n_perc(exposicao  == "1° Janssen, 2° AstraZenecn",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1°, 2° e 3° AstraZeneca"                                        = qwraps2::n_perc(exposicao  == "1°, 2° e 3° AstraZeneca",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE),
                                  "1°, 2° e 3° CoronaVac"                                          = qwraps2::n_perc(exposicao  == "1°, 2° e 3° CoronaVac",
                                                                                                                     na_rm = TRUE, show_symbol = TRUE)) %>% 
                 base::t()

knitr::kable(tabExp,
             caption = "Outros Regimes",
             col.names =  ("n(%)"))                 

```


## Booster Qualquer tipo (exp_booster)

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# PFIZER: exp_booster
######################
options(qwraps2_markup = "markdown")
pfizerexp_booster <- qwraps2::summary_table(dplyr::group_by(dados_completo, exp_booster),
                           summaries = our_summary1)
pfizerexp_booster

pfizerexp_booster <- data.frame(pfizerexp_booster)
pfizerexp_booster$nome <- rownames(pfizerexp_booster)
```

# Vacinas

## Sem Tempo

A tabela abaixo descreve os esquemas de vacinas **sem** considerar o tempo entre a última dose administrada e o início dos sintomas do participante.

```{r include=FALSE}
# TIPOS DE VACINA SEM TEMPO
  
dados_completo <- dados_completo %>% 
                     dplyr::mutate(dose_pfizer          = dplyr::case_when(LB41 == 1 & LB86 == 3 ~ "1",
                                                                         LB41 == 2 & EL66 == 3 & LB86 == 3 ~ "2",
                                                                         LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 3 ~ "3",
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                 TRUE ~ "0"),
                                 
                                 dose_janssen         = dplyr::case_when(LB41 == 1 & LB86 == 4 ~ "1",
                                                                         LB41 == 2 & EL66 == 4 & LB86 == 4 ~ "2",
                                                                         LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 4 ~ "3",
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                TRUE ~ "0"),
                                 
                                 dose_coronavac       = dplyr::case_when(LB41 == 1 & LB86 == 1 ~ "1",
                                                                         LB41 == 2 & EL66 == 1 & LB86 == 1 ~ "2",
                                                                         LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 1 ~ "3",
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                TRUE ~ "0"),
                                 
                                 dose_astrazeneca     = dplyr::case_when(LB41 == 1 & LB86 == 2 ~ "1",
                                                                         LB41 == 2 & EL66 == 2 & LB86 == 2 ~ "2",
                                                                         LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 2 ~ "3",
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                TRUE ~ "0"),
                                 outro_tipo           = dplyr::case_when(LB41 == 1 & LB86 == 5 ~ "1",
                                                                         LB41 == 2 & EL66 == 5 & LB86 == 5 ~ "2",
                                                                         LB41 == 3 & LB46 == 5 & EL66 == 5 & LB86 == 5 ~ "3",
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                TRUE ~ "0"),
                                 
                                 dose_pfizer_nbooster = dplyr::case_when((LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 3) |
                                                                         (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 3) |
                                                                         (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 3)   ~ "1",
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                TRUE ~ "0"),
                                 
                                 ndose_pfizerbooster  = dplyr::case_when((LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 1) |
                                                                         (LB41 == 3 & EL66 == 3 & LB86 == 4)             |
                                                                         
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 1) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 1) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 1) |
                                                                         
                                                                         
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 2) | 
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 2) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 2) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 2) |
                                                                         
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 4) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 4) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 4) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 4) |
                                                                         
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 3) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 3) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 3) ~ "1",
                                                                         
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                TRUE ~ "0"),
                                 
                                 completo_outras      = dplyr::case_when( 
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 1) |  
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 4) |  
                                                                         
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 1) |  
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 1) | 
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 4) |
                                                                            
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 1) |  
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 2) |  
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 3) | 
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 3) |  
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 4) |  
                                                                          
                                                                          (LB41 == 2 & EL66 == 2 & LB86 == 4)  |
                                                                          (LB41 == 2 & EL66 == 1 & LB86 == 4)  ~ "1",
                                                                         
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                TRUE ~ "0"),
                                 
                                 completo_excecao     = dplyr::case_when(LB41 == 2 & LB86 == 1 & EL66 == 2 ~ "1",
                                                                         LB41 == 2 & LB86 == 1 & EL66 == 3 ~ "2",
                                                                         LB41 == 2 & LB86 == 1 & EL66 == 4 ~ "3",
                                                                         
                                                                         LB41 == 2 & LB86 == 2 & EL66 == 1 ~ "4",
                                                                         LB41 == 2 & LB86 == 2 & EL66 == 3 ~ "5",
                                                                         LB41 == 2 & LB86 == 2 & EL66 == 4 ~ "6",
                                                                         
                                                                         LB41 == 2 & LB86 == 3 & EL66 == 1 ~ "7",
                                                                         LB41 == 2 & LB86 == 3 & EL66 == 2 ~ "8",
                                                                         LB41 == 2 & LB86 == 3 & EL66 == 4 ~ "9",
                                                                    
                                                                         is.na(LB41) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                       TRUE ~ "0"))
  
```

```{r include=FALSE}

options(qwraps2_markup = "markdown")

our_summary2 <-  
  list(
       "Nenhuma Dose" =
       list("0° Dose – no/total no. (%)" = ~ qwraps2::n_perc(LB40 == 0, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),

       "Pfizer" =
       list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_pfizer  == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_pfizer  == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_pfizer  == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "CoronaVac" =
        list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_coronavac == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_coronavac == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_coronavac == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
  
       "AstraZeneca" =
        list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_astrazeneca == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_astrazeneca == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_astrazeneca == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
        
        "Janssen" =
        list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_janssen  == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_janssen  == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_janssen  == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "Quatro Doses" =
        list("4° Dose – no/total no. (%)" = ~ qwraps2::n_perc(LB41 == 4, show_denom = "always", na_rm = TRUE, show_symbol = TRUE)),
       
       "Moderna" =
        list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(outro_tipo  == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(outro_tipo  == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(outro_tipo  == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "Outros Regimes" =
        list("Duas Pfizer +Qualquer Booster – no/total no. (%)" = ~ qwraps2::n_perc(dose_pfizer_nbooster == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "Qualquer 1° e 2° Dose +Pfizer Booster – no/total no. (%)" = ~ qwraps2::n_perc(ndose_pfizerbooster == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "Regime Completo (1° e 2° dose Qualquer) +Booster outras vacinas – no/total no. (%)" = ~ qwraps2::n_perc(completo_outras == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "Regimes de Exceção" =
        list("1° CoronaVac e 2° AstraZeneca" = ~ qwraps2::n_perc(completo_excecao == 1, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° CoronaVac e 2° Pfizer"       = ~ qwraps2::n_perc(completo_excecao == 2, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° CoronaVac e 2° Janssen"      = ~ qwraps2::n_perc(completo_excecao == 3, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
        
            "1° AstraZeneca e 2° CoronaVac"  = ~ qwraps2::n_perc(completo_excecao == 4, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° AstraZeneca e 2° Pfizer"     = ~ qwraps2::n_perc(completo_excecao == 5, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° AstraZeneca e 2° Janssen"    = ~ qwraps2::n_perc(completo_excecao == 6, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
        
            "1° Pfizer e 2° CoronaVac"       = ~ qwraps2::n_perc(completo_excecao == 7, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° Pfizer e 2° AstraZeneca"     = ~ qwraps2::n_perc(completo_excecao == 8, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° Pfizer e 2° Janssen"         = ~ qwraps2::n_perc(completo_excecao == 9, show_denom = "always", na_rm = TRUE, show_symbol = TRUE)))
```

```{r message=FALSE, warning=FALSE,  results = "asis"}
##############################
#  STATUS VACINAL: SEM TEMPO #
##############################
options(qwraps2_markup = "markdown")
vacina_ST <- qwraps2::summary_table(dados_completo, our_summary2)
vacina_ST

vacina_ST <- data.frame(vacina_ST)
vacina_ST$nome <- rownames(vacina_ST)

```

## Com Tempo

A tabela abaixo descreve os esquemas de vacinas considerando o tempo entre a última dose administrada e o início dos sintomas do participantes.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# TIPOS DE VACINA COM TEMPO

dados_completo <- dados_completo %>% 
                   dplyr::mutate(dose_pfizerT          = dplyr::case_when(LB41 == 1 & LB86 == 3 ~ "1",
                                                                          LB41 == 2 & EL66 == 3 & LB86 == 3 ~ "2",
                                                                          LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 3 ~ "3",
                                                                          is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                  TRUE ~ "0"),
                                 
                                 dose_janssenT         = dplyr::case_when(LB41 == 1 & LB86 == 4 ~ "1",
                                                                          LB41 == 2 & EL66 == 4 & LB86 == 4 ~ "2",
                                                                          LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 4 ~ "3",
                                                                          is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                 TRUE ~ "0"),
                                 
                                 dose_coronavacT       = dplyr::case_when(LB41 == 1 & LB86 == 1 ~ "1",
                                                                          LB41 == 2 & EL66 == 1 & LB86 == 1 ~ "2",
                                                                          LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 1 ~ "3",
                                                                          is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                 TRUE ~ "0"),
                                 
                                 dose_astrazenecaT     = dplyr::case_when(LB41 == 1 & LB86 == 2 ~ "1",
                                                                          LB41 == 2 & EL66 == 2 & LB86 == 2 ~ "2",
                                                                          LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 2 ~ "3",
                                                                          is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                 TRUE ~ "0"),
                                 outro_tipoT           = dplyr::case_when(LB41 == 1 & LB86 == 5 ~ "1",
                                                                          LB41 == 2 & EL66 == 5 & LB86 == 5 ~ "2",
                                                                          LB41 == 3 & LB46 == 5 & EL66 == 5 & LB86 == 5 ~ "3",
                                                                          is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                 TRUE ~ "0"),
                                 
                                 dose_pfizer_nboosterT = dplyr::case_when((LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 3)   ~ "1",
                                                                          is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                 TRUE ~ "0"),
                                 
                               ndose_pfizerboosterT  = dplyr::case_when((LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 1) |
                                                                         (LB41 == 3 & EL66 == 3 & LB86 == 4)             |
                                                                         
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 1) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 1) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 1) |

                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 2) | 
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 2) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 2) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 2) |
                                                                         
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 4) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 4) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 3 & LB86 == 4) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 4) |
                                                                         
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 1 & LB86 == 3) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 2 & LB86 == 3) |
                                                                         (LB41 == 3 & LB46 == 3 & EL66 == 4 & LB86 == 3) ~ "1",
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                TRUE ~ "0"),
                                 
                                 completo_outrasT      = dplyr::case_when( 
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 1) |  
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 1 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 2 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 3 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 1 & EL66 == 4 & LB86 == 4) |  
                                                                         
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 1) |  
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 1) | 
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 1 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 2 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 3 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 2 & EL66 == 4 & LB86 == 4) |
                                                                            
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 1) |  
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 1) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 2) |  
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 2) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 3) | 
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 3) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 4 & LB86 == 3) |  
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 1 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 2 & LB86 == 4) |
                                                                          (LB41 == 3 & LB46 == 4 & EL66 == 3 & LB86 == 4) |  
                                                                          
                                                                          (LB41 == 2 & EL66 == 2 & LB86 == 4)  |
                                                                          (LB41 == 2 & EL66 == 1 & LB86 == 4)  ~ "1",
                                                                         
                                                                         is.na(LB41) | is.na(LB46) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                                TRUE ~ "0"),
                                 
                                 completo_excecaoT     = dplyr::case_when(
                                                                         (LB41 == 2 & LB86 == 1 & EL66 == 2) ~ "1",
                                                                         (LB41 == 2 & LB86 == 1 & EL66 == 3) ~ "2",
                                                                         (LB41 == 2 & LB86 == 1 & EL66 == 4) ~ "3",
                                                                         
                                                                         (LB41 == 2 & LB86 == 2 & EL66 == 1) ~ "4",
                                                                         (LB41 == 2 & LB86 == 2 & EL66 == 3) ~ "5",
                                                                         (LB41 == 2 & LB86 == 2 & EL66 == 4) ~ "6",
                                                                         
                                                                         (LB41 == 2 & LB86 == 3 & EL66 == 1) ~ "7",
                                                                         (LB41 == 2 & LB86 == 3 & EL66 == 2) ~ "8",
                                                                         (LB41 == 2 & LB86 == 3 & EL66 == 4) ~ "9",
                                                                    
                                                                         is.na(LB41) | is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                       TRUE ~ "0"),
                                 
                                 MenorDias_doseT      = dplyr::case_when((data_dif_1dose < 14 & LB41 == 1 & LB86 == 1) ~ "1",
                                                                         (data_dif_1dose < 15 & LB41 == 1 & LB86 == 2) ~ "2",
                                                                         (data_dif_1dose < 7  & LB41 == 1 & LB86 == 3) ~ "3",
                                                                         (data_dif_1dose < 14 & LB41 == 1 & LB86 == 3) ~ "4",
                                                                          
                                                                          
                                                                         data_dif_1dose < 14 & LB41 == 2 & LB86 == 1 & EL66 == 1 ~ "5",
                                                                         data_dif_1dose < 15 & LB41 == 2 & LB86 == 2 & EL66 == 2 ~ "6",
                                                                         data_dif_1dose < 7  & LB41 == 2 & LB86 == 3 & EL66 == 3 ~ "7",
                                                                         data_dif_1dose < 14 & LB41 == 2 & LB86 == 4 & EL66 == 4 ~ "8",
                                                                         
                                                                         data_dif_3dose < 14 & LB41 == 2 & LB86 == 1 & EL66 == 1 & LB46 == 1 ~ "9",                                                                                                                      data_dif_3dose < 15 & LB41 == 2 & LB86 == 2 & EL66 == 2 & LB46 == 2 ~ "10",
                                                                         data_dif_3dose < 7  & LB41 == 2 & LB86 == 3 & EL66 == 3 & LB46 == 3 ~ "11",
                                                                         data_dif_3dose < 14 & LB41 == 2 & LB86 == 4 & EL66 == 4 & LB46 == 4 ~ "12",
                                                                          
                                                                         is.na(LB41) | is.na(LB46) |is.na(EL66) | is.na(LB86) ~ NA_character_,                                                                                                                    TRUE ~ "0"))  
   


```

```{r include=FALSE}

options(qwraps2_markup = "markdown")

our_summary3 <-  
  list(
       "Nenhuma Dose" =
       list("0° Dose – no/total no. (%)" = ~ qwraps2::n_perc(LB40 == 0, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),

       "Pfizer" =
       list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(exp_sec_1d  == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(exp_sec_2d  == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
            "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(exp_sec_3d  == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "CoronaVac" =
        list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_coronavacT == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_coronavacT == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_coronavacT == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
  
       "AstraZeneca" =
        list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_astrazenecaT == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_astrazenecaT == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_astrazenecaT == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
        
        "Janssen" =
        list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_janssenT  == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_janssenT  == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(dose_janssenT  == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),

        "Moderna" =
        list("1° Dose – no/total no. (%)" = ~ qwraps2::n_perc(outro_tipoT  == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "2° Dose – no/total no. (%)" = ~ qwraps2::n_perc(outro_tipoT  == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "3° Dose – no/total no. (%)" = ~ qwraps2::n_perc(outro_tipoT  == 3, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),

       
       "Outros Regimes" =
        list("Duas Pfizer +Qualquer Booster – no/total no. (%)" = ~ qwraps2::n_perc(dose_pfizer_nboosterT == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "Qualquer 1° e 2° Dose +Pfizer Booster – no/total no. (%)" = ~ qwraps2::n_perc(ndose_pfizerboosterT == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
             "Regime Completo (1° e 2° dose) +Booster outras vacinas – no/total no. (%)" = ~ qwraps2::n_perc(completo_outrasT == 1, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)),
       
       "Regimes de Exceção" =
        list("1° CoronaVac e 2° AstraZeneca" = ~ qwraps2::n_perc(completo_excecaoT == 1, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° CoronaVac e 2° Pfizer"       = ~ qwraps2::n_perc(completo_excecaoT == 2, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° CoronaVac e 2° Janssen"      = ~ qwraps2::n_perc(completo_excecaoT == 3, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
        
            "1° AstraZeneca e 2° CoronaVac"  = ~ qwraps2::n_perc(completo_excecaoT == 4, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° AstraZeneca e 2° Pfizer"     = ~ qwraps2::n_perc(completo_excecaoT == 5, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° AstraZeneca e 2° Janssen"    = ~ qwraps2::n_perc(completo_excecaoT == 6, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
        
            "1° Pfizer e 2° CoronaVac"       = ~ qwraps2::n_perc(completo_excecaoT == 7, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° Pfizer e 2° AstraZeneca"     = ~ qwraps2::n_perc(completo_excecaoT == 8, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
            "1° Pfizer e 2° Janssen"         = ~ qwraps2::n_perc(completo_excecaoT == 9, show_denom = "always", na_rm = TRUE, show_symbol = TRUE)),
       
       
       "Menor que dias estipulados" =
        list("1° CoronaVac Menor 14 dias"   = ~ qwraps2::n_perc(MenorDias_doseT  == 1, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "1° AstraZeneca Menor 15 dias" = ~ qwraps2::n_perc(MenorDias_doseT  == 2, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "1° Pfizer Menor 7 dias"       = ~ qwraps2::n_perc(MenorDias_doseT  == 3, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "1° Janssen Menor 14 dias"     = ~ qwraps2::n_perc(MenorDias_doseT  == 4, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "2° CoronaVac Menor 14 dias"   = ~ qwraps2::n_perc(MenorDias_doseT  == 5, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "2° AstraZeneca Menor 15 dias" = ~ qwraps2::n_perc(MenorDias_doseT  == 6, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "2° Pfizer Menor 7 dias"       = ~ qwraps2::n_perc(MenorDias_doseT  == 7, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "2° Janssen Menor 14 dias"     = ~ qwraps2::n_perc(MenorDias_doseT  == 8, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "3° CoronaVac Menor 14 dias"   = ~ qwraps2::n_perc(MenorDias_doseT  == 9, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "3° AstraZeneca Menor 15 dias" = ~ qwraps2::n_perc(MenorDias_doseT  == 10, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "3° Pfizer Menor 7 dias"       = ~ qwraps2::n_perc(MenorDias_doseT  == 11, show_denom = "always", na_rm = TRUE, show_symbol = TRUE),
             "3° Janssen Menor 14 dias"     = ~ qwraps2::n_perc(MenorDias_doseT  == 12, show_denom = "always", na_rm = TRUE, show_symbol = TRUE)))






```

```{r message=FALSE, warning=FALSE,  results = "asis"}
##############################
#  STATUS VACINAL: COM TEMPO #
##############################
options(qwraps2_markup = "markdown")
vacina_CT <- qwraps2::summary_table(dados_completo, our_summary3)
vacina_CT

vacina_CT <- data.frame(vacina_CT)
vacina_CT$nome <- rownames(vacina_CT)

```


# Análise Primária

## Pfizer: 2 Pfizer 

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analise2P <-   dados_completo  %>%
                       dplyr::filter(exp_sec_2d == 0 | exp_sec_2d == 1) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(exp2P = dplyr::case_when(exp_sec_2d == 1 ~ "1",
                                                              exp_sec_2d == 0 ~ "0",
                                                              TRUE ~ NA_character_),
                                     exp2P = base::factor(exp2P, levels = c("0", "1")))
```

Há `r nrow(dados_analise2P)` participantes com duas ou mais doses do tipo Pfizer. Há `r sum(dados_analise2P$exp2 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise2P$exp2 == 0)` não vacinados. São `r sum(dados_analise2P$resultado == 1)` positivos e `r sum(dados_analise2P$resultado == 2)` negativos. A tabela a seguir demonstra as características gerais destes participantes:

```{r message=FALSE, warning=FALSE, results= "asis"}
####################
#PFIZER: EXPOSIÇÃO
####################
#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")

doses_2pfizer <- summary_table(dplyr::group_by(dados_analise2P, exp2P),
                              summaries = our_summary1)
doses_2pfizer

doses_2pfizer <- data.frame(doses_2pfizer)
doses_2pfizer$nome <- rownames(doses_2pfizer)
```

Tabela relacionada com os casos positivos e negativos:

```{r message=FALSE, warning=FALSE, results= "asis"}
##########################################
# PFIZER: 2 OU 3 DOSES + COVID E NÃO COVID
##########################################
options(qwraps2_markup = "markdown")
pfizer_2dosesNC <- qwraps2::summary_table(dplyr::group_by(dados_analise2P, resultado),
                           summaries = our_summary1)
pfizer_2dosesNC

pfizer_2dosesNC <- data.frame(pfizer_2dosesNC)
pfizer_2dosesNC$nome <- rownames(pfizer_2dosesNC)
```

Tabela com o total,

```{r message=FALSE, warning=FALSE, results= "asis"}
##########################################
# PFIZER: 2 PFIZER
##########################################
options(qwraps2_markup = "markdown")
pfizer_2doseC <- qwraps2::summary_table(dplyr::group_by(dados_analise2P),
                           summaries = our_summary1)
pfizer_2doseC

pfizer_2doseC <- data.frame(pfizer_2doseC)
pfizer_2doseC$nome <- rownames(pfizer_2doseC)
```


Figura resumo:

```{r echo=FALSE, message=FALSE, warning=FALSE}
###############################################
#       TAXA DE POSITIVIDADE & ÔMICRON        #
###############################################

dados_analise2P %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                pfizer_semana_7dias    = sum(exp2P == "1", na.rm = T),
                omicron_semana_7dias   = sum(omicron == "1", na.rm = T),
                #pfizer_semana_doseplus = sum(V2dosesplus == "1", na.rm = T),
                taxa_positivos = positivos_semana/total_semana * 100,
                taxa_pfizer    = pfizer_semana_7dias/total_semana * 100,
                taxa_omicron   = omicron_semana_7dias/total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(pfizer_semana_7dias), x = as.numeric(semana_do_estudo), color = 'Pfizer')) +
  geom_line(aes(y = as.numeric(taxa_omicron), x = as.numeric(semana_do_estudo), color = 'Ômicron')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()


```

A relação de variante se encontra a seguir:

```{r message=FALSE, warning=FALSE, include=FALSE}

options(qwraps2_markup = "markdown")

our_summary3 <-  
  list("Variante" =
         list("Delta – no/total no. (%)"        = ~ qwraps2::n_perc(variante == "Delta", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.1 – no/total no. (%)" = ~ qwraps2::n_perc(variante == "Omicron Ba.1", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.2 – no/total no. (%)" = ~ qwraps2::n_perc(variante == "Omicron Ba.2", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.4 – no/total no. (%)" = ~ qwraps2::n_perc(variante == "Omicron Ba.4", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.5 – no/total no. (%)" = ~ qwraps2::n_perc(variante == "Omicron Ba.5", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Not possible to identify – no/total no. (%)" = ~ qwraps2::n_perc(variante == "Inconclusivo" | variante == "Inválido", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "COVID (PCR-negative) – no/total no. (%)"     = ~ qwraps2::n_perc(resultado == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)) 
       )
```


```{r message=FALSE, warning=FALSE, results= "asis"}
##########################################
# PFIZER: 2 DOSES
##########################################
options(qwraps2_markup = "markdown")
pfizer_2doses <- qwraps2::summary_table(dplyr::group_by(dados_analise2P, exp_sec_2d),
                           summaries = our_summary3)
pfizer_2doses

pfizer_2doses <- data.frame(pfizer_2doses)
pfizer_2doses$nome <- rownames(pfizer_2doses)
```

### Modelo
#### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################
# MODELO BRUTO: DUAS  VACINAS PFIZER #
######################################
m_logBC <-  glm(resultado ~  exp2P, 
                family = 'binomial', 
                data = dados_analise2P)
m_results <-  summary(m_logBC)
odds <- exp(coefficients(m_logBC))
conf <- exp(confint(m_logBC))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes  <- paste0(( round(exp(m_logBC$coefficients[2]),3)) ,
                          ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,2]),3),
              ';',
              round(abs(1 - conf[2,1]),3), ')')

Retorno_modelo1 <-  data.frame(Coeficientes,
                               ve,
                               P_valor = round(coef(summary(m_logBC))[,'Pr(>|z|)'][2],3),
                               Amplitude = exp(confint(m_logBC)[2,2] - confint(m_logBC)[2,1]))
Retorno_modelo1
```

```{r echo=FALSE}
#############################################
#      Indica que o modelo ajustou ok       #
#############################################
library('ResourceSelection')
hoslem.test(dados_analise2P$resultado, fitted(m_logBC))
```


A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC, type = "deviance")
probabilitiesBC = predict(m_logBC, type = "response")

dados_analise2P <-  dados_analise2P %>%
  dplyr::mutate(logit_modeloBC = base::log(probabilitiesBC/(1-probabilitiesBC)),
                deviance_modeloBC = res.devBC) 

figura_1 <-  ggplot(dados_analise2P, aes(semana_do_estudo, y = deviance_modeloBC))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise2P, aes(semana_do_estudo, y = probabilitiesBC))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

##### Por Semana

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO BRUTO: DUAS OU TRÊS VACINAS PFIZER + SEMANA DO ESTUDO
###############################################

m_logBCSemana <-  glm(resultado ~  exp2P + semana_do_estudo, 
                      family = 'binomial', 
                      data = dados_analise2P)
m_results <-  summary(m_logBCSemana)
odds <- exp(coefficients(m_logBCSemana))
conf <- exp(confint(m_logBCSemana))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCSemana, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesBCSemana <- predict(m_logBCSemana, type = "response")

dados_analise2P <-  dados_analise2P %>%
                      dplyr::mutate(logit_modeloBCSemana = base::log(probabilitiesBCSemana/(1-probabilitiesBCSemana)),
                                    deviance_modeloBCSemana = residuals(m_logBCSemana, type = "deviance"))

Coeficientes <- paste0( (round(exp(m_logBCSemana$coefficients[2]),3)),
                        ' (',
                        round(conf[2,1],3),
                        ';', round(conf[2,2],3), ')')

ve <- paste0((round(1 - exp(m_logBCSemana$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,2]),3),
              ';',
              round(abs(1 - conf[2,1]),3), ')')


Retorno_modelo <- data.frame(Coeficientes, 
                             ve,
                             P_valor   = round(coef(summary(m_logBCSemana))[,'Pr(>|z|)'][2],3),
                             Amplitude = exp(confint(m_logBCSemana)[2,2] - confint(m_logBCSemana)[2,1]))
Retorno_modelo
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCSemana)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}
figura_1 <-  ggplot(dados_analise2P, aes(deviance_modeloBCSemana, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise2P, aes(logit_modeloBCSemana, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3
```

##### Taxa Positivos

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TAXA DE POSITIVOS (por semana)
###############################################

m_logBCPositivo <-  glm(resultado ~ exp2P + taxa_positivos, 
                        family = 'binomial', 
                        data = dados_analise2P)

m_results <-  summary(m_logBCPositivo)
odds <- exp(coefficients(m_logBCPositivo))
conf <- exp(confint(m_logBCPositivo))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCPositivo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesBCPositivo <- predict(m_logBCPositivo, type = "response")

dados_analise2P <- dados_analise2P %>%
  dplyr::mutate(logit_modeloBCPositivo    = log(probabilitiesBCPositivo/(1-probabilitiesBCPositivo)),
                deviance_modeloBCPositivo = residuals(m_logBCPositivo, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logBCPositivo$coefficients[2]),3)),
                       ' (',   round(conf[2,1],3), ';',
                       round(conf[2,2],3), ')')


ve <- paste0((round(1 - exp(m_logBCPositivo$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,2]),3),
              ';',
              round(abs(1 - conf[2,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBCPositivo))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBCPositivo)[2,2] - confint(m_logBCPositivo)[2,1]))
Retorno_modelo
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCPositivo)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise2P, aes(deviance_modeloBCPositivo, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_1 <-  ggplot(dados_analise2P, aes(logit_modeloBCPositivo, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

##### Taxa Pfizer

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TAXA DE PFIZER (por semana)
###############################################

m_logBCPfizer <-  glm(resultado ~ exp2P + taxa_pfizer, 
                      family = 'binomial', 
                      data = dados_analise2P)

m_results <-  summary(m_logBCPfizer)
odds <- exp(coefficients(m_logBCPfizer))
conf <- exp(confint(m_logBCPfizer))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCPfizer, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesBCPfizer <- predict(m_logBCPfizer, type = "response")

dados_analise2P <- dados_analise2P %>%
  dplyr::mutate(logit_modeloBCPfizer    = log(probabilitiesBCPfizer/(1-probabilitiesBCPfizer)),
                deviance_modeloBCPfizer = residuals(m_logBCPfizer, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logBCPfizer$coefficients[2]),3)),
                       ' (',   round(conf[2,1],3), ';',
                       round(conf[2,2],3), ')')

ve <- paste0((round(1 - exp(m_logBCPfizer$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,2]),3),
              ';',
              round(abs(1 - conf[2,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logBCPfizer))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBCPfizer)[2,2] - confint(m_logBCPfizer)[2,1]))
Retorno_modelo
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCPfizer)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise2P, aes(deviance_modeloBCPfizer, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_1 <-  ggplot(dados_analise2P, aes(logit_modeloBCPfizer, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

##### Quartis

Abaixo se encontram resultados do modelo bruto por quartil.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO BRUTO: DUAS OU TRÊS VACINAS PFIZER: POR QUARTIS 
###############################################

m_logBCQuartis <-  glm(resultado ~ exp2P + quartil_analise, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logBCQuartis)
odds <- exp(coefficients(m_logBCQuartis))
conf <- exp(confint(m_logBCQuartis))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesBCQuartis <- predict(m_logBCQuartis, type = "response")

dados_analise2P <- dados_analise2P %>%
  dplyr::mutate(logit_modeloBCQuartis    = log(probabilitiesBCQuartis/(1-probabilitiesBCQuartis)),
                deviance_modeloBCQuartis = residuals(m_logBCQuartis, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logBCQuartis$coefficients[2:5]),3)),
                       ' (',   round(conf[2:5,1],3), ';',
                       round(conf[2:5,2],3), ')')


ve <- paste0((round(1 - exp(m_logBCQuartis$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,2]),3),
              ';',
              round(abs(1 - conf[2,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logBCQuartis))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logBCQuartis)[2:5,2] - confint(m_logBCQuartis)[2:5,1]))
Retorno_modelo
```

```{r message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCQuartis)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}
figura_1 <-  ggplot(dados_analise2P, aes(x = semana_do_estudo,
                                         y = deviance_modeloBCQuartis,
                                         fill = quartil_analise))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise2P, aes(x = semana_do_estudo,
                                         y = logit_modeloBCQuartis,
                                         fill = quartil_analise)) +
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3
```

###### Quartis Interação

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO BRUTO: DUAS OU TRÊS VACINAS PFIZER: POR QUARTIS (interação)
###############################################

m_logBCQuartisInte <-  glm(resultado ~ factor(exp2P) * quartil_analise, 
                           family = 'binomial', 
                           data = dados_analise2P)

m_results <-  summary(m_logBCQuartisInte)
odds <- exp(coefficients(m_logBCQuartisInte))
conf <- exp(confint(m_logBCQuartisInte))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCQuartisInte, type = '3')
```

```{r message=FALSE, warning=FALSE, include=FALSE}

probabilitiesBCQuartisInt <- predict(m_logBCQuartisInte, type = "response")

dados_analise2P <- dados_analise2P %>%
  dplyr::mutate(logit_modeloBCQuartisInte    = log(probabilitiesBCQuartisInt/(1-probabilitiesBCQuartisInt)),
                deviance_modeloBCQuartisInte = residuals(m_logBCQuartisInte, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logBCQuartisInte$coefficients[2]),3)),
                       ' (',   round(conf[2,1],3), ';',
                       round(conf[2,2],3), ')')

ve <- paste0((round(1 - exp(m_logBCQuartisInte$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,2]),3),
              ';',
              round(abs(1 - conf[2,1]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBCQuartisInte))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBCQuartisInte)[2,2] - confint(m_logBCQuartisInte)[2,1]))

Retorno_modelo
```

```{r message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCQuartisInte)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}
figura_1 <-  ggplot(dados_analise2P, aes(deviance_modeloBCQuartisInte, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_1 <-  ggplot(dados_analise2P, aes(logit_modeloBCQuartisInte, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3
```

#### Ajustado Categórico

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
#####################################
# MODELO AJUSTADO: DUAS POR QUARTIS #
#####################################

m_logAJQuartis <-  glm(resultado ~ exp2P + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJQuartis)
odds <- exp(coefficients(m_logAJQuartis))
conf <- exp(confint(m_logAJQuartis))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesAJQuartis <- predict(m_logAJQuartis, type = "response")
dados_analise2P <- dados_analise2P %>%
                      dplyr::mutate(logit_modeloAJQuartis    = log(probabilitiesAJQuartis/(1-probabilitiesAJQuartis)),
                                    deviance_modeloAJQuartis = residuals(m_logAJQuartis, type = "deviance"))
                    
Coeficientes <- paste0((round(exp(m_logAJQuartis$coefficients[2:11]),3)),
                        ' (',
                        round(conf[2:11,1],3),
                        ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJQuartis$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJQuartis))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJQuartis)[2:11,2] - confint(m_logAJQuartis)[2:11,1]))
Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise2P, aes(deviance_modeloAJQuartis, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_1 <-  ggplot(dados_analise2P, aes(logit_modeloAJQuartis, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

##### Com Raça

Abaixo se encontram resultados do modelo ajustado com raça (branco, preto pardo e outros).

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################
# MODELO AJUSTADO: DUAS PFIZER: RAÇA #
######################################

m_logAJQuartis <-  glm(resultado ~ exp2P + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + LB1_WBBO, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJQuartis)
conf <- exp(confint(m_logAJQuartis))
car::Anova(m_logAJQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJQuartis$coefficients[2:14]),3)),
                       ' (',
                       round(conf[2:14,1],3),
                       ';',
                       round(conf[2:14,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJQuartis$coefficients[2:14]),3)),
             ' (',
             round(1 - conf[2:14,2],3),
             ';',
             round(1 - conf[2:14,1],3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJQuartis))[,'Pr(>|z|)'][2:14],3))
Retorno_modelo
```

###### Bruto

Abaixo se encontram resultados do modelo ajustado com raça (branco, preto, pardo e outros).

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################
# MODELO AJUSTADO: DUAS PFIZER: raça #
######################################
m_logAJQuartis <-  glm(resultado ~ exp2P + LB1_WBBO, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJQuartis)
odds <- exp(coefficients(m_logAJQuartis))
conf <- exp(confint(m_logAJQuartis))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJQuartis <- predict(m_logAJQuartis, type = "response")

dados_analise2P <- dados_analise2P %>%
                      dplyr::mutate(logit_modeloAJQuartis    = log(probabilitiesAJQuartis/(1-probabilitiesAJQuartis)),
                                    deviance_modeloAJQuartis = residuals(m_logAJQuartis, type = "deviance"))
                    
Coeficientes <- paste0((round(exp(m_logAJQuartis$coefficients[2:4]),3)),
                       ' (',
                       round(conf[2:4,1],3),
                       ';',
                       round(conf[2:4,2],3),
                       ')')
ve <- paste0((round(1 - exp(m_logAJQuartis$coefficients[2:4]),3)) ,
              ' (',
              round(abs(1 - conf[2:4,2]),3),
              ';',
              round(abs(1 - conf[2:4,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJQuartis))[,'Pr(>|z|)'][2:4],3),
                              Amplitude = exp(confint(m_logAJQuartis)[2:4,2] - confint(m_logAJQuartis)[2:4,1]))
Retorno_modelo
```

Abaixo se encontram resultados do modelo ajustado com raça (todas categorias).

```{r message=FALSE, warning=FALSE, include=FALSE}
############################################
# MODELO AJUSTADO: DUAS PFIZER: POR QUARTIS#
############################################
m_logAJQuartis <-  glm(resultado ~ exp2P + LB1, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJQuartis)
odds <- exp(coefficients(m_logAJQuartis))
conf <- exp(confint(m_logAJQuartis))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJQuartis <- predict(m_logAJQuartis, type = "response")

dados_analise2P <- dados_analise2P %>%
                      dplyr::mutate(logit_modeloAJQuartis    = log(probabilitiesAJQuartis/(1-probabilitiesAJQuartis)),
                                    deviance_modeloAJQuartis = residuals(m_logAJQuartis, type = "deviance"))
                    
Coeficientes <- paste0((round(exp(m_logAJQuartis$coefficients[2:7]),3)),
                       ' (',
                       round(conf[2:7,1],3),
                       ';',
                       round(conf[2:7,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJQuartis$coefficients[2:7]),3)) ,
              ' (',
              round(abs(1 - conf[2:7,2]),3),
              ';',
              round(abs(1 - conf[2:7,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJQuartis))[,'Pr(>|z|)'][2:7],3),
                              Amplitude = exp(confint(m_logAJQuartis)[2:7,2] - confint(m_logAJQuartis)[2:7,1]))
Retorno_modelo
```


### Subgrupos
#### Idade
##### Interação

```{r echo=FALSE, message=FALSE, warning=FALSE}
#######################################################
# MODELO AJUSTADO: DUAS PFIZER: IDADE #
#######################################################

m_logAJIdade <-  glm(resultado ~ exp2P*idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJIdade)
odds <- exp(coefficients(m_logAJIdade))
conf <- exp(confint(m_logAJIdade))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIdade, type = '3')

Coeficientes <- paste0((round(exp(m_logAJIdade$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIdade$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,2]),3),
              ';',
              round(abs(1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIdade))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJIdade)[2:8,2] - confint(m_logAJIdade)[2:8,1]))
Retorno_modelo

```

##### Idade (12y a 17y)

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analise1R12 <- dados_analise2P %>% 
                      dplyr::filter(idade_cat4 == 1)
```

Há `r nrow(dados_analise1R12)` participantes com duas doses do tipo Pfizer com idade entre 12 e 17 anos. Há `r sum(dados_analise1R12$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R12$exp2P == 0)` não vacinados. São `r sum(dados_analise1R12$resultado == 1)` positivos e `r sum(dados_analise1R12$resultado == 2)` negativos. 

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO AJUSTADO: DUAS PFIZER: IDADE 12 A 17 #
###############################################

m_logAJ1217 <-  glm(resultado ~ exp2P + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R12)

m_results <-  summary(m_logAJ1217)
odds <- exp(coefficients(m_logAJ1217))
conf <- exp(confint(m_logAJ1217))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ1217, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJ1217$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJ1217$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,2]),3),
              ';',
              round(abs(1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ1217))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJ1217)[2:8,2] - confint(m_logAJ1217)[2:8,1]))
Retorno_modelo
```

##### Idade (18y a 39y)

```{r include=FALSE}
dados_analise1R1839 <- dados_analise2P %>% 
                      dplyr::filter(idade_cat4 == 2)
```

Há `r nrow(dados_analise1R1839)` participantes com duas doses do tipo Pfizer com idade entre 18 e 39 anos. Há `r sum(dados_analise1R1839$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R1839$exp2P == 0)` não vacinados. São `r sum(dados_analise1R1839$resultado == 1)` positivos e `r sum(dados_analise1R1839$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
####################################################
# MODELO AJUSTADO: DUAS PFIZER: IDADE 18 a 39 anos #
####################################################

m_logAJ1839 <-  glm(resultado ~ exp2P + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R1839)

m_results <-  summary(m_logAJ1839)
odds <- exp(coefficients(m_logAJ1839))
conf <- exp(confint(m_logAJ1839))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ1839, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJ1839$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJ1839$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,2]),3),
              ';',
              round(abs(1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ1839))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJ1839)[2:8,2] - confint(m_logAJ1839)[2:8,1]))
Retorno_modelo
```

##### Idade (40y a 64y)

```{r include=FALSE}
dados_analise1R4064 <- dados_analise2P %>% 
                      dplyr::filter(idade_cat4 == 3)
```

Há `r nrow(dados_analise1R4064)` participantes com duas doses do tipo Pfizer com idade entre 40 e 64 anos. Há `r sum(dados_analise1R4064$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R4064$exp2P == 0)` não vacinados. São `r sum(dados_analise1R4064$resultado == 1)` positivos e `r sum(dados_analise1R4064$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r message=FALSE, warning=FALSE, include=FALSE}
####################################################################
# MODELO AJUSTADO: DUAS PFIZER: IDADE 18 a 39 anos #
####################################################################

m_logAJ4064 <-  glm(resultado ~ exp2P + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R4064)

m_results <-  summary(m_logAJ4064)
odds <- exp(coefficients(m_logAJ4064))
conf <- exp(confint(m_logAJ4064))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ4064, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJ4064$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJ4064$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,2]),3),
              ';',
              round(abs(1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ4064))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJ4064)[2:8,2] - confint(m_logAJ4064)[2:8,1]))
Retorno_modelo
```

##### Idade (>=65y)

```{r include=FALSE}
dados_analise1R65 <- dados_analise2P %>% 
                      dplyr::filter(idade_cat4 == 4)
```

Há `r nrow(dados_analise1R65)` participantes com duas doses do tipo Pfizer com idade maior que 65 anos. Há `r sum(dados_analise1R65$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R65$exp2P == 0)` não vacinados. São `r sum(dados_analise1R65$resultado == 1)` positivos e `r sum(dados_analise1R65$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado. Não se ajusta devido ao n.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
########################################################################
# MODELO AJUSTADO: DUAS PFIZER: IDADE maior igual a 65 #
########################################################################

m_logAJ65 <-  glm(resultado ~ exp2P + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R65)

m_results <-  summary(m_logAJ65)
odds <- exp(coefficients(m_logAJ65))
conf <- exp(confint(m_logAJ65))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ65, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

Coeficientes <- paste0((round(exp(m_logAJ65$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJ65$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,2]),3),
              ';',
              round(abs(1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ65))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJ65)[2:8,2] - confint(m_logAJ65)[2:8,1]))
Retorno_modelo
```

#### Tempo desde a última vacina

##### Interação

```{r echo=FALSE}
#######################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO #
#######################################################

m_logAJTempo <-  glm(resultado ~ exp2P*data_dif_tempoDoseM + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

#car::Anova(m_logAJTempo, type = '3')

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,2]),3),
              ';',
              round(abs(1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:8,2] - confint(m_logAJTempo)[2:8,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=7 days and <30 days)

```{r include=FALSE}
dados_analise1R730M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 30 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R730M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (>=7 days and <30 days). Há `r sum(dados_analise1R730M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R730M$exp2P == 0)` não vacinados. São `r sum(dados_analise1R730M$resultado == 1)` positivos e `r sum(dados_analise1R730M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp2P + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R730M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=30 days and <60 days)

```{r include=FALSE}
dados_analise1R73060M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDose >= 30 & data_dif_tempoDose < 60 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R73060M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (>=30 days and <60 days). Há `r sum(dados_analise1R73060M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R73060M$exp2P == 0)` não vacinados. São `r sum(dados_analise1R73060M$resultado == 1)` positivos e `r sum(dados_analise1R73060M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp2P + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R73060M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=60 days and <90 days)

```{r include=FALSE}
dados_analise1R6090M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDose >= 60 & data_dif_tempoDose < 90 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R6090M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (>=60 days and <90 days). Há `r sum(dados_analise1R6090M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R6090M$exp2P == 0)` não vacinados. São `r sum(dados_analise1R6090M$resultado == 1)` positivos e `r sum(dados_analise1R6090M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp2P + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R6090M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=90 days and <120 days)

```{r include=FALSE}
dados_analise1R90120M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDose >= 90 & data_dif_tempoDose < 120 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R90120M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (>=90 days and <120 days). Há `r sum(dados_analise1R90120M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R90120M$exp2P == 0)` não vacinados. São `r sum(dados_analise1R90120M$resultado == 1)` positivos e `r sum(dados_analise1R90120M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp2P + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R90120M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=120 days and <150 days)

```{r include=FALSE}
dados_analise1R120150M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDose >= 120 & data_dif_tempoDose < 150 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R120150M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (>=120 days and <150 days). Há `r sum(dados_analise1R120150M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R120150M$exp2P == 0)` não vacinados. São `r sum(dados_analise1R120150M$resultado == 1)` positivos e `r sum(dados_analise1R120150M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp2P + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R120150M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=150 days and <180 days)

```{r include=FALSE}
dados_analise1R150180M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDose >= 150 & data_dif_tempoDose < 180 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R150180M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (>=150 days and <180 days). Há `r sum(dados_analise1R150180M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R150180M$exp2P == 0)` não vacinados. São `r sum(dados_analise1R150180M$resultado == 1)` positivos e `r sum(dados_analise1R150180M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp2P + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R150180M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=180 days)

```{r include=FALSE}
dados_analise1R180M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDose >= 180 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R180M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (>=180 days). Há `r sum(dados_analise1R180M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R180M$exp2P == 0)` não vacinados. São `r sum(dados_analise1R180M$resultado == 1)` positivos e `r sum(dados_analise1R180M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp2P + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R180M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (<90)

```{r include=FALSE}
dados_analise1R90M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDose < 90 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R90M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (<90). Há `r sum(dados_analise1R90M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R90M$exp2P == 0)` não vacinados. São `r sum(dados_analise1R90M$resultado == 1)` positivos e `r sum(dados_analise1R90M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp2P + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R90M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=90)

```{r include=FALSE}
dados_analise1RM90M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1RM90M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (>=90). Há `r sum(dados_analise1RM90M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RM90M$exp2P == 0)` não vacinados. São `r sum(dados_analise1RM90M$resultado == 1)` positivos e `r sum(dados_analise1RM90M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp2P + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RM90M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (< 90 e >=90)

```{r include=FALSE}
dados_analise1RM90M <- dados_analise2P %>% 
                       dplyr::filter(data_dif_tempoDose < 90 | data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1RM90M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (>=90). Há `r sum(dados_analise1RM90M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RM90M$exp2P == 0)` não vacinados. São `r sum(dados_analise1RM90M$resultado == 1)` positivos e `r sum(dados_analise1RM90M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ data_dif_tempoDose3M + quartil_analise + sexo + idade_cat4 + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RM90M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round((1 - conf[2:11,2]),3),
              ';',
              round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```


##### Tempo desde a última vacina (1 a 7)

```{r include=FALSE}
dados_analise1R7M <- dados_analise2P %>% 
                      dplyr::filter(data_dif_tempoDoseM == "0M" | data_dif_tempoDoseM == "1M" | 
                                    data_dif_tempoDoseM == "2M" | data_dif_tempoDoseM == "3M" |
                                    data_dif_tempoDoseM == "4M" | data_dif_tempoDoseM == "5M" |
                                    data_dif_tempoDoseM == "6M" | data_dif_tempoDoseM == "7M")
```

Há `r nrow(dados_analise1R7M)` participantes com duas doses do tipo Pfizer com Tempo desde a última vacina (1 a 7). Há `r sum(dados_analise1R7M$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1R7M$exp2P == 0)` não vacinados. São `r sum(dados_analise1R7M$resultado == 1)` positivos e `r sum(dados_analise1R7M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ data_dif_tempoDoseM + quartil_analise + sexo + idade_cat4 + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R7M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:12]),3)),
                       ' (',
                       round(conf[2:12,1],3),
                       ';',
                       round(conf[2:12,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:12]),3)) ,
              ' (',
              round((1 - conf[2:12,2]),3),
              ';',
              round((1 - conf[2:12,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:12],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:12,2] - confint(m_logAJTempo)[2:12,1]))
Retorno_modelo
```

```{r echo=FALSE}
ResourceSelection::hoslem.test(dados_analise1R7M$resultado, fitted(m_logAJTempo))
```

#### BMI

##### Interação

```{r echo=FALSE}
#####################################################
# MODELO AJUSTADO: DUAS PFIZER: BMI #
#####################################################

m_logAJBMI <-  glm(resultado ~ exp2P*cat_imc + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJBMI)
odds <- exp(coefficients(m_logAJBMI))
conf <- exp(confint(m_logAJBMI))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJBMI, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJBMI$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJBMI$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,1]),3),
#               ';',
#               round(abs(1 - conf[2:8,2]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJBMI))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJBMI)[2:8,2] - confint(m_logAJBMI)[2:8,1]))
# Retorno_modelo
```

##### BMI:underweight

```{r include=FALSE}
dados_analise1RBMI <- dados_analise2P %>% 
                                   dplyr::filter(cat_imc == "Baixo peso")
```

Há `r nrow(dados_analise1RBMI)` participantes com duas doses do tipo Pfizer com BMI:underweight. Há `r sum(dados_analise1RBMI$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RBMI$exp2P == 0)` não vacinados. São `r sum(dados_analise1RBMI$resultado == 1)` positivos e `r sum(dados_analise1RBMI$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para underweight. Não ajusta devido a exposição.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: DUAS PFIZER: IMC
###################################################

m_logAJIMC <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBMI)

m_results <-  summary(m_logAJIMC)
odds <- exp(coefficients(m_logAJIMC))
conf <- exp(confint(m_logAJIMC))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJIMC, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIMC$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIMC$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,2]),3),
              ';',
              round(abs(1 - conf[2:8,1]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes, 
                              P_valor = round(coef(summary(m_logAJIMC))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJIMC)[2:8,2] - confint(m_logAJIMC)[2:8,1]))
Retorno_modelo
```

##### BMI:normal weight

```{r include=FALSE}
dados_analise1RBMI <- dados_analise2P %>% 
                                   dplyr::filter(cat_imc == "Eutrófico")
```

Há `r nrow(dados_analise1RBMI)` participantes com duas doses do tipo Pfizer com BMI:normal weight. Há `r sum(dados_analise1RBMI$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RBMI$exp2P == 0)` não vacinados. São `r sum(dados_analise1RBMI$resultado == 1)` positivos e `r sum(dados_analise1RBMI$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para normal weight.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: DUAS PFIZER: IMC
###################################################

m_logAJIMC <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBMI)

m_results <-  summary(m_logAJIMC)
odds <- exp(coefficients(m_logAJIMC))
conf <- exp(confint(m_logAJIMC))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIMC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIMC$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIMC$coefficients[2:11]),3)) ,
              ' (',
              round((1 - conf[2:11,2]),3),
              ';',
              round((1 - conf[2:11,1]),3), ')')



Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJIMC))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIMC)[2:11,2] - confint(m_logAJIMC)[2:11,1]))
Retorno_modelo
```

##### BMI:overweight

```{r include=FALSE}
dados_analise1RBMI <- dados_analise2P %>% 
                        dplyr::filter(cat_imc == "Sobrepeso")
```

Há `r nrow(dados_analise1RBMI)` participantes com duas doses do tipo Pfizer com BMI:overweight. Há `r sum(dados_analise1RBMI$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RBMI$exp2P == 0)` não vacinados. São `r sum(dados_analise1RBMI$resultado == 1)` positivos e `r sum(dados_analise1RBMI$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para overweight.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: DUAS PFIZER: IMC
###################################################

m_logAJIMC <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBMI)

m_results <-  summary(m_logAJIMC)
odds <- exp(coefficients(m_logAJIMC))
conf <- exp(confint(m_logAJIMC))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIMC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIMC$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIMC$coefficients[2:11]),3)) ,
              ' (',
              round((1 - conf[2:11,2]),3),
              ';',
              round((1 - conf[2:11,1]),3), ')')



Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJIMC))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIMC)[2:11,2] - confint(m_logAJIMC)[2:11,1]))
Retorno_modelo
```

##### BMI:obese

```{r include=FALSE}
dados_analise1RBMI <- dados_analise2P %>% 
                                   dplyr::filter(cat_imc == "Obeso")
```

Há `r nrow(dados_analise1RBMI)` participantes com duas doses do tipo Pfizer com BMI:obese Há `r sum(dados_analise1RBMI$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RBMI$exp2P == 0)` não vacinados. São `r sum(dados_analise1RBMI$resultado == 1)` positivos e `r sum(dados_analise1RBMI$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para obese.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: DUAS PFIZER: IMC
###################################################

m_logAJIMC <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBMI)

m_results <-  summary(m_logAJIMC)
odds <- exp(coefficients(m_logAJIMC))
conf <- exp(confint(m_logAJIMC))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIMC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIMC$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIMC$coefficients[2:10]),3)) ,
              ' (',
              round((1 - conf[2:10,2]),3),
              ';',
              round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJIMC))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJIMC)[2:10,2] - confint(m_logAJIMC)[2:10,1]))
Retorno_modelo
```

#### Doença Cardiovascular
##### Interação

```{r echo=TRUE, message=FALSE, warning=FALSE}
##########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER:          #
##########################################################

m_logAJPDC <-  glm(resultado ~ exp2P*cardio + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJPDC)
odds <- exp(coefficients(m_logAJPDC))
conf <- exp(confint(m_logAJPDC))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJPDC, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJPDC$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJPDC$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,2]),3),
#               ';',
#               round(abs(1 - conf[2:8,1]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJPDC))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJPDC)[2:8,2] - confint(m_logAJPDC)[2:8,1]))
# Retorno_modelo
```
##### Doença Cardiovascular (Yes)

```{r include=FALSE}
dados_analise1RDV <- dados_analise2P %>% 
                       dplyr::filter(LB55a == 1 | LB55b == 1 |
                                     LB55c == 1 | LB55f == 1 )
```

Há `r nrow(dados_analise1RDV)` participantes com duas doses do tipo Pfizer com Doença Cardiovascular (Yes). Há `r sum(dados_analise1RDV$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RDV$exp2P == 0)` não vacinados. São `r sum(dados_analise1RDV$resultado == 1)` positivos e `r sum(dados_analise1RDV$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Doença Cardiovascular. Não se ajusta.

```{r message=FALSE, warning=FALSE, include=FALSE}
#####################################################################
# MODELO AJUSTADO: DUAS PFIZER: Doença Cardiovascular
#####################################################################

m_logAJIDV <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RDV)

m_results <-  summary(m_logAJIDV)
odds <- exp(coefficients(m_logAJIDV))
conf <- exp(confint(m_logAJIDV))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIDV, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIDV$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';', round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJIDV$coefficients[2:11]),3)) ,
             ' (', 
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIDV))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIDV)[2:11,2] - confint(m_logAJIDV)[2:11,1]))
Retorno_modelo

```

##### Doença Cardiovascular (No)


```{r include=FALSE}
dados_analise1RDV <- dados_analise2P %>% 
                       dplyr::filter(LB55a == 0 & LB55b == 0 &
                                     LB55c == 0 & LB55f == 0)
```


Há `r nrow(dados_analise1RDV)` participantes com duas doses do tipo Pfizer com Doença Cardiovascular (No). Há `r sum(dados_analise1RDV$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RDV$exp2P == 0)` não vacinados. São `r sum(dados_analise1RDV$resultado == 1)` positivos e `r sum(dados_analise1RDV$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Doença Cardiovascular.

```{r echo=TRUE, message=FALSE, warning=FALSE}
#####################################################################
# MODELO AJUSTADO: DUAS PFIZER: Doença Cardiovascular
#####################################################################

m_logAJIDV <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RDV)

m_results <-  summary(m_logAJIDV)
odds <- exp(coefficients(m_logAJIDV))
conf <- exp(confint(m_logAJIDV))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJIDV, type = '3')
```

```{r echo=TRUE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIDV$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';', round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJIDV$coefficients[2:11]),3)) ,
             ' (', 
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIDV))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIDV)[2:11,2] - confint(m_logAJIDV)[2:11,1]))
Retorno_modelo

```



#### Charlson

##### Interação

Abaixo se encontram resultados do modelo ajustado para Charlson.

```{r echo=TRUE, message=FALSE, warning=FALSE}
##########################################################
# MODELO AJUSTADO: DUAS PFIZER: Charlson #
##########################################################

m_logAJCH<-  glm(resultado ~ exp2P*LB_indice_charlson_cat + quartil_analise + idade_cat4 + sexo + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJCH)
odds <- exp(coefficients(m_logAJCH))
conf <- exp(confint(m_logAJCH))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJCH, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJCH$coefficients[2:10]),3)),
#                        ' (',
#                        round(conf[2:10,1],3),
#                        ';',
#                        round(conf[2:10,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJCH$coefficients[2:10]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:10,1]),3),
#               ';',
#               round(abs(1 - conf[2:10,2]),3), ')')
# 
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJCH))[,'Pr(>|z|)'][2:10],3),
#                               Amplitude = exp(confint(m_logAJCH)[2:10,2] - confint(m_logAJCH)[2:10,1]))
# Retorno_modelo
```


##### Charlson (>=1)

```{r include=FALSE}
dados_analise1RCH1 <- dados_analise2P %>% 
                       dplyr::filter(LB_indice_charlson_cat == 1 | LB_indice_charlson_cat   == 2)
```

Há `r nrow(dados_analise1RCH1)` participantes com duas doses do tipo Pfizer com Charlson (>=1). Há `r sum(dados_analise1RCH1$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RCH1$exp2P == 0)` não vacinados. São `r sum(dados_analise1RCH1$resultado == 1)` positivos e `r sum(dados_analise1RCH1$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Charlson (>=1).

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################################
# MODELO AJUSTADO: DUAS PFIZER: Charlson (>=1)
###############################################################

m_logAJICH1 <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RCH1)

m_results <-  summary(m_logAJICH1)
odds <- exp(coefficients(m_logAJICH1))
conf <- exp(confint(m_logAJICH1))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJICH1, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJICH1$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJICH1$coefficients[2:10]),3)) ,
              ' (',
              round(abs(1 - conf[2:10,2]),3),
              ';',
              round(abs(1 - conf[2:10,1]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJICH1))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJICH1)[2:10,2] - confint(m_logAJICH1)[2:10,1]))
Retorno_modelo
```

##### Charlson (=0)

```{r include=FALSE}
dados_analise1RCH0 <- dados_analise2P %>% 
                       dplyr::filter(LB_indice_charlson_cat == 3)
```

Há `r nrow(dados_analise1RCH0)` participantes com duas doses do tipo Pfizer com Charlson (==0). Há `r sum(dados_analise1RCH0$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_analise1RCH0$exp2P == 0)` não vacinados. São `r sum(dados_analise1RCH0$resultado == 1)` positivos e `r sum(dados_analise1RCH0$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Charlson (=0).

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################################
# MODELO AJUSTADO: DUAS PFIZER: Charlson (=0)
###############################################################

m_logAJICH0 <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RCH0)

m_results <-  summary(m_logAJICH0)
odds <- exp(coefficients(m_logAJICH0))
conf <- exp(confint(m_logAJICH0))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJICH0, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJICH0$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJICH0$coefficients[2:10]),3)) ,
              ' (',
              round(abs(1 - conf[2:10,2]),3),
              ';',
              round(abs(1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJICH0))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJICH0)[2:10,2] - confint(m_logAJICH0)[2:10,1]))
Retorno_modelo
```

#### Raça

##### Interação

```{r echo=FALSE}
######################################################
# MODELO AJUSTADO: DUAS PFIZER: RAÇA #
######################################################

m_logAJRACA <-  glm(resultado ~ exp2P*LB1_WBBO + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJRACA)
odds <- exp(coefficients(m_logAJRACA))
conf <- exp(confint(m_logAJRACA))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJRACA, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJRACA$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJRACA$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,1]),3),
#               ';',
#               round(abs(1 - conf[2:8,2]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJRACA))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJRACA)[2:8,2] - confint(m_logAJRACA)[2:8,1]))
# Retorno_modelo
```

##### Raça (branco)

```{r include=FALSE}
dados_analise1RBR <- dados_analise2P %>% 
                       dplyr::filter(LB1 == 1)
```

Há `r nrow(dados_analise1RBR)` participantes com duas doses do tipo Pfizer para raça igual a declarados brancos. Há `r sum(dados_analise1RBR$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1RBR$exp2P == 0)` não vacinados. São `r sum(dados_analise1RBR$resultado == 1)` positivos e `r sum(dados_analise1RBR$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para raça igual a declarados brancos.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS PFIZER: Brancos
########################################################

m_logAJIBR <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBR)

m_results <-  summary(m_logAJIBR)
odds <- exp(coefficients(m_logAJIBR))
conf <- exp(confint(m_logAJIBR))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIBR, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIBR$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJIBR$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,2]),3),
              ';',
              round(abs(1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIBR))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIBR)[2:11,2] - confint(m_logAJIBR)[2:11,1]))
Retorno_modelo
```

##### Raça (preto)

```{r include=FALSE}
dados_analise1RPR <- dados_analise2P %>% 
                       dplyr::filter(LB1 == 2)
```

Há `r nrow(dados_analise1RPR)` participantes com duas doses do tipo Pfizer para raça igual a declarados pretos. Há `r sum(dados_analise1RPR$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1RPR$exp2P == 0)` não vacinados. São `r sum(dados_analise1RPR$resultado == 1)` positivos e `r sum(dados_analise1RPR$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para raça igual a declarados pretos.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS PFIZER: Pretos
########################################################

m_logAJIPR <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RPR)

m_results <-  summary(m_logAJIPR)
odds <- exp(coefficients(m_logAJIPR))
conf <- exp(confint(m_logAJIPR))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIPR, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIPR$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIPR$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIPR))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIPR)[2:11,2] - confint(m_logAJIPR)[2:11,1]))
Retorno_modelo
```

##### Raça (Pardo)

```{r include=FALSE}
dados_analise1RPAR <- dados_analise2P %>% 
                       dplyr::filter(LB1 == 3)
```

Há `r nrow(dados_analise1RPAR)` participantes com duas doses do tipo Pfizer para raça igual a declarados pardos. Há `r sum(dados_analise1RPAR$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1RPAR$exp2P == 0)` não vacinados. São `r sum(dados_analise1RPAR$resultado == 1)` positivos e `r sum(dados_analise1RPAR$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para raça igual a declarados pardos.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS PFIZER: PARDOS
########################################################

m_logAJPAR <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RPAR)

m_results <-  summary(m_logAJPAR)
odds <- exp(coefficients(m_logAJPAR))
conf <- exp(confint(m_logAJPAR))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJPAR, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJPAR$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJPAR$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJPAR))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJPAR)[2:11,2] - confint(m_logAJPAR)[2:11,1]))
Retorno_modelo
```

##### Raça (outros)

```{r include=FALSE}
dados_analise1ROT <- dados_analise2P %>% 
                       dplyr::filter(LB1 == 4 | LB1 == 5 | LB1 == 6 )
```

Há `r nrow(dados_analise1ROT)` participantes com duas doses do tipo Pfizer para raça igual a declarados outros. Há `r sum(dados_analise1ROT$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1ROT$exp2P == 0)` não vacinados. São `r sum(dados_analise1ROT$resultado == 1)` positivos e `r sum(dados_analise1ROT$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para raça igual a declarados outros.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS PFIZER: OUTROS
########################################################

m_logAJOT <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1ROT)

m_results <-  summary(m_logAJOT)
odds <- exp(coefficients(m_logAJOT))
conf <- exp(confint(m_logAJOT))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJOT, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJOT$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOT$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOT))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJOT)[2:11,2] - confint(m_logAJOT)[2:11,1]))
Retorno_modelo
```


#### Sexo
##### Interação

```{r echo=FALSE}
######################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: SEXO #
######################################################

m_logAJSEXO <-  glm(resultado ~ exp2P*sexo + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJSEXO)
odds <- exp(coefficients(m_logAJSEXO))
conf <- exp(confint(m_logAJSEXO))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJSEXO, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJSEXO$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJSEXO$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,1]),3),
#               ';',
#               round(abs(1 - conf[2:8,2]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJSEXO))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJSEXO)[2:8,2] - confint(m_logAJSEXO)[2:8,1]))
# Retorno_modelo
```

##### Sexo:Female

```{r include=FALSE}
dados_analise1F <- dados_analise2P %>% 
                    dplyr::mutate(sexo = base::as.character(sexo)) %>% 
                    dplyr::filter(sexo == "F")
```

Há `r nrow(dados_analise1F)` participantes com duas doses do tipo Pfizer para Sexo:Female. Há `r sum(dados_analise1F$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1F$exp2P == 0)` não vacinados. São `r sum(dados_analise1F$resultado == 1)` positivos e `r sum(dados_analise1F$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Sexo:Female.

```{r echo=TRUE, message=FALSE, warning=FALSE}
########################################################
# MODELO AJUSTADO: DUAS PFIZER: FEMALE
########################################################

m_logAJF <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1F)

m_results <-  summary(m_logAJF)
odds <- exp(coefficients(m_logAJF))
conf <- exp(confint(m_logAJF))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJF, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJF$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJF$coefficients[2:10]),3)),
             ' (',
             round((1 - conf[2:10,2]),3),
             ';',
             round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJF))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJF)[2:10,2] - confint(m_logAJF)[2:10,1]))
Retorno_modelo
```

##### Sexo:male

```{r include=FALSE}
dados_analise1M <- dados_analise2P %>% 
                    dplyr::mutate(sexo = base::as.character(sexo)) %>% 
                    dplyr::filter(sexo == "M")
```

Há `r nrow(dados_analise1M)` participantes com duas doses do tipo Pfizer para Sexo:male. Há `r sum(dados_analise1M$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1M$exp2P == 0)` não vacinados. São `r sum(dados_analise1M$resultado == 1)` positivos e `r sum(dados_analise1M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Sexo:male.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: FEMALE
########################################################

m_logAJM <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1M)

m_results <-  summary(m_logAJM)
odds <- exp(coefficients(m_logAJM))
conf <- exp(confint(m_logAJM))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJM, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJM$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJM$coefficients[2:10]),3)),
             ' (',
             round((1 - conf[2:10,2]),3),
             ';',
             round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJM))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJM)[2:10,2] - confint(m_logAJM)[2:10,1]))
Retorno_modelo
```

#### Smoking
##### Interação

```{r echo=TRUE, message=FALSE, warning=FALSE}
#########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: SMOKING #
#########################################################

m_logAJSMOK <-  glm(resultado ~ exp2P*LB5 + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJSMOK)
odds <- exp(coefficients(m_logAJSMOK))
conf <- exp(confint(m_logAJSMOK))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJSMOK, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJSMOK$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJSMOK$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,2]),3),
#               ';',
#               round(abs(1 - conf[2:8,1]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJSMOK))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJSMOK)[2:8,2] - confint(m_logAJSMOK)[2:8,1]))
# Retorno_modelo
```

##### Current smoking (yes)

```{r include=FALSE}
dados_analise1CS <- dados_analise2P %>% 
                    dplyr::filter(LB5 == 1)
```

Há `r nrow(dados_analise1CS)` participantes com duas doses do tipo Pfizer para Current smoking (yes). Há `r sum(dados_analise1CS$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1CS$exp2P == 0)` não vacinados. São `r sum(dados_analise1CS$resultado == 1)` positivos e `r sum(dados_analise1CS$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Current smoking (yes).

```{r message=FALSE, warning=FALSE, include=FALSE}
##############################################################
# MODELO AJUSTADO: DUAS PFIZER: CURRENT SMOKE#
##############################################################

m_logAJCS <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0, 
                       family = 'binomial', 
                       data = dados_analise1CS)

m_results <-  summary(m_logAJCS)
odds <- exp(coefficients(m_logAJCS))
conf <- exp(confint(m_logAJCS))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJCS, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJCS$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCS$coefficients[2:10]),3)),
             ' (',
             round((1 - conf[2:10,2]),3),
             ';',
             round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCS))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJCS)[2:10,2] - confint(m_logAJCS)[2:10,1]))
Retorno_modelo
```

##### Current smoking (no)

```{r include=FALSE}
dados_analise1CS <- dados_analise2P %>% 
                    dplyr::filter(LB5 == 0)
```

Há `r nrow(dados_analise1CS)` participantes com duas doses do tipo Pfizer para Current smoking (yes). Há `r sum(dados_analise1CS$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1CS$exp2P == 0)` não vacinados. São `r sum(dados_analise1CS$resultado == 1)` positivos e `r sum(dados_analise1CS$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Current smoking (yes).

```{r message=FALSE, warning=FALSE, include=FALSE}
##############################################################
# MODELO AJUSTADO: DUAS PFIZER: CURRENT SMOKE#
##############################################################

m_logAJCS <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0, 
                       family = 'binomial', 
                       data = dados_analise1CS)

m_results <-  summary(m_logAJCS)
odds <- exp(coefficients(m_logAJCS))
conf <- exp(confint(m_logAJCS))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJCS, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJCS$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCS$coefficients[2:10]),3)),
             ' (',
             round((1 - conf[2:10,2]),3),
             ';',
             round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCS))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJCS)[2:10,2] - confint(m_logAJCS)[2:10,1]))
Retorno_modelo
```




#### Diabetes
##### Interação

```{r echo=FALSE, message=FALSE, warning=FALSE}
##########################################################
# MODELO AJUSTADO: DUAS PFIZER: DIABETES #
##########################################################

m_logAJDIAB <-  glm(resultado ~ exp2P*mellitus + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJDIAB)
odds <- exp(coefficients(m_logAJDIAB))
conf <- exp(confint(m_logAJDIAB))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJDIAB, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJDIAB$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJDIAB$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,2]),3),
#               ';',
#               round(abs(1 - conf[2:8,1]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJDIAB))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJDIAB)[2:8,2] - confint(m_logAJDIAB)[2:8,1]))
# Retorno_modelo
```

##### Diabetes (yes)

```{r include=FALSE}
dados_analise1D <- dados_analise2P %>% 
                    dplyr::filter(mellitus == 1)
```

Há `r nrow(dados_analise1D)` participantes com duas ou mais doses do tipo Pfizer para Diabetes (yes). Há `r sum(dados_analise1D$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1D$exp2P == 0)` não vacinados. São `r sum(dados_analise1D$resultado == 1)` positivos e `r sum(dados_analise1D$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Diabetes (yes). Não converge.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
##############################################################
# MODELO AJUSTADO: DUAS PFIZER: DIABETES     #
##############################################################

m_logAJD <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1D)

m_results <-  summary(m_logAJD)
odds <- exp(coefficients(m_logAJD))
conf <- exp(confint(m_logAJD))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJD, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
Coeficientes <- paste0((round(exp(m_logAJD$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJD$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJD))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJD)[2:11,2] - confint(m_logAJD)[2:11,1]))
Retorno_modelo
```

##### Diabetes (no)

```{r include=FALSE}
dados_analise1D <- dados_analise2P %>% 
                    dplyr::filter(mellitus == 0)
```

Há `r nrow(dados_analise1D)` participantes com duas ou mais doses do tipo Pfizer para Diabetes (no). Há `r sum(dados_analise1D$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1D$exp2P == 0)` não vacinados. São `r sum(dados_analise1D$resultado == 1)` positivos e `r sum(dados_analise1D$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Diabetes (no). Não converge.

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################
# MODELO AJUSTADO: DUAS PFIZER: DIABETES     #
##############################################################

m_logAJD <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1D)

m_results <-  summary(m_logAJD)
odds <- exp(coefficients(m_logAJD))
conf <- exp(confint(m_logAJD))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJD, type = '3')
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJD$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJD$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJD))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJD)[2:11,2] - confint(m_logAJD)[2:11,1]))
Retorno_modelo
```
#### Pulmonar
##### Interação

```{r echo=TRUE, message=FALSE, warning=FALSE}
##########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: PULMONAR #
##########################################################

m_logAJPDC <-  glm(resultado ~ exp2P*LB55g + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise2P)

m_results <-  summary(m_logAJPDC)
odds <- exp(coefficients(m_logAJPDC))
conf <- exp(confint(m_logAJPDC))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJPDC, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJPDC$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJPDC$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,2]),3),
#               ';',
#               round(abs(1 - conf[2:8,1]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJPDC))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJPDC)[2:8,2] - confint(m_logAJPDC)[2:8,1]))
# Retorno_modelo
```

##### Chronic pulmonary disease (yes)

```{r include=FALSE}
dados_analise1CPD <- dados_analise2P %>% 
                    dplyr::filter(LB55g == 1)
```

Há `r nrow(dados_analise1CPD)` participantes com duas doses do tipo Pfizer para Chronic pulmonary disease (yes). Há `r sum(dados_analise1CPD$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1CPD$exp2P == 0)` não vacinados. São `r sum(dados_analise1CPD$resultado == 1)` positivos e `r sum(dados_analise1CPD$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Chronic pulmonary disease (yes). Não converge devido ao n.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
###########################################################################
# MODELO AJUSTADO: DUAS PFIZER: Chronic pulmonary disease #
###########################################################################

m_logAJCPD <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1CPD)

m_results <-  summary(m_logAJCPD)
odds <- exp(coefficients(m_logAJCPD))
conf <- exp(confint(m_logAJCPD))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJCPD, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
Coeficientes <- paste0((round(exp(m_logAJCPD$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCPD$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCPD))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJCPD)[2:11,2] - confint(m_logAJCPD)[2:11,1]))
Retorno_modelo
```

##### Chronic pulmonary disease (no)

```{r include=FALSE}
dados_analise1CPD <- dados_analise2P %>% 
                    dplyr::filter(LB55g == 0)
```

Há `r nrow(dados_analise1CPD)` participantes com duas doses do tipo Pfizer para Chronic pulmonary disease (no). Há `r sum(dados_analise1CPD$exp2P == 1)` participantes com Pfizer (duas doses) e `r sum(dados_analise1CPD$exp2P == 0)` não vacinados. São `r sum(dados_analise1CPD$resultado == 1)` positivos e `r sum(dados_analise1CPD$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Chronic pulmonary disease (yes). Não converge devido ao n.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###########################################################################
# MODELO AJUSTADO: DUAS PFIZER: Chronic pulmonary disease #
###########################################################################

m_logAJCPD <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1CPD)

m_results <-  summary(m_logAJCPD)
odds <- exp(coefficients(m_logAJCPD))
conf <- exp(confint(m_logAJCPD))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJCPD, type = '3')
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJCPD$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCPD$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCPD))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJCPD)[2:11,2] - confint(m_logAJCPD)[2:11,1]))
Retorno_modelo
```

### Sensibilidade

#### Delta phase (up to 30-11-21)

```{r include=FALSE}
fase_delta <- dados_analise2P %>% 
                 dplyr::mutate(delta = dplyr::case_when(resultado == 1 & LB_creation_date <= "2021-11-30" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date <= "2021-11-30")
```

Há `r nrow(fase_delta)` participantes nesta fase. Há `r sum(fase_delta$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_delta$exp2P == 0)` não vacinados. São `r sum(fase_delta$resultado == 1)` positivos e `r sum(fase_delta$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado para Delta phase (up to 30-11-21). Não se ajusta.

```{r eval=FALSE, include=FALSE}
###############################
# MODELO AJUSTADO: FASE DELTA #
###############################

m_logAJDF <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_delta)

m_results <-  summary(m_logAJDF)
odds <- exp(coefficients(m_logAJDF))
conf <- exp(confint(m_logAJDF))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJDF, type = '3')

Coeficientes <- paste0((round(exp(m_logAJDF$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJDF$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJDF))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJDF)[2:11,2] - confint(m_logAJDF)[2:11,1]))
Retorno_modelo
```


#### Delta Genotipagem

```{r include=FALSE}
fase_deltaG <- dados_analise2P %>% 
                 dplyr::mutate(delta = dplyr::case_when(variante == "Delta" ~ "Delta",
                                                        is.na(variante)     ~ NA_character_,
                                                        TRUE ~ "Outras"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(delta == "Delta" )
```

Há `r nrow(fase_deltaG)` participantes nesta fase. Há `r sum(fase_deltaG$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_deltaG$exp2P == 0)` não vacinados. São `r sum(fase_deltaG$resultado == 1)` positivos e `r sum(fase_deltaG$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. Não se ajusta.



#### Omicron phase (from 01-12-21)

```{r include=FALSE}
fase_omicron <- dados_analise2P %>% 
                 dplyr::mutate(omicron = dplyr::case_when(resultado == 1 & LB_creation_date >= "2021-12-01" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date >= "2021-12-01")
```

Há `r nrow(fase_omicron)` participantes nesta fase. Há `r sum(fase_omicron$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicron$exp2P == 0)` não vacinados. São `r sum(fase_omicron$resultado == 1)` positivos e `r sum(fase_omicron$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado para Omicron phase (from 01-12-21). 

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFO <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicron)

m_results <-  summary(m_logAJFO)
odds <- exp(coefficients(m_logAJFO))
conf <- exp(confint(m_logAJFO))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFO, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFO$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFO$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFO))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJFO)[2:11,2] - confint(m_logAJFO)[2:11,1]))
Retorno_modelo
```


#### Omicron Genotipagem

```{r include=FALSE}

fase_omicronG <- dados_analise2P %>% 
                 dplyr::mutate(variante = dplyr::case_when(variante == "Omicron Ba.1" |
                                                          variante == "Omicron Ba.2" |
                                                          variante == "Omicron Ba.4" ~ "Omicron",
                                                          is.na(variante)     ~ "Sem Covid"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(variante %in% c("Omicron", "Sem Covid"))
```

Há `r nrow(fase_omicronG)` participantes nesta fase. Há `r sum(fase_omicronG$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronG$exp2P == 0)` não vacinados. São `r sum(fase_omicronG$resultado == 1)` positivos e `r sum(fase_omicronG$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFO <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronG)

m_results <-  summary(m_logAJFO)
odds <- exp(coefficients(m_logAJFO))
conf <- exp(confint(m_logAJFO))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFO, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFO$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFO$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFO))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJFO)[2:11,2] - confint(m_logAJFO)[2:11,1]))
Retorno_modelo
```



#### Omicron Ba1 phase (01-12-21 to 31-03-22)

```{r include=FALSE}
fase_omicronBa1 <- dados_analise2P %>% 
                 dplyr::mutate(omicron_Ba1 = dplyr::case_when(resultado == 1 & LB_creation_date >= "2021-12-01" & LB_creation_date <= "2022-03-31" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date >= "2021-12-01" & LB_creation_date <= "2022-03-31")
```

Há `r nrow(fase_omicronBa1)` participantes nesta fase. Há `r sum(fase_omicronBa1$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronBa1$exp2P == 0)` não vacinados. São `r sum(fase_omicronBa1$resultado == 1)` positivos e `r sum(fase_omicronBa1$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado para Omicron Ba1 phase (01-12-21 to 30-03-22). 

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFOBA1 <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronBa1)

m_results <-  summary(m_logAJFOBA1)
odds <- exp(coefficients(m_logAJFOBA1))
conf <- exp(confint(m_logAJFOBA1))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFOBA1, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFOBA1$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFOBA1$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFOBA1))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJFOBA1)[2:11,2] - confint(m_logAJFOBA1)[2:11,1]))
Retorno_modelo
```


#### Omicron Ba1 Genotipagem

```{r include=FALSE}

fase_omicronba1G <- dados_analise2P %>% 
                 dplyr::mutate(omicronba1 = dplyr::case_when(variante == "Omicron Ba.1"  ~ "Omicron Ba1",
                                                        is.na(variante)     ~ "Sem Covid"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(omicronba1 %in% c("Omicron Ba1", "Sem Covid"))
                                 
```

Há `r nrow(fase_omicronba1G)` participantes nesta fase. Há `r sum(fase_omicronba1G$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronba1G$exp2P == 0)` não vacinados. São `r sum(fase_omicronba1G$resultado == 1)` positivos e `r sum(fase_omicronba1G$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFOBA1G <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronba1G)

m_results <-  summary(m_logAJFOBA1G)
odds <- exp(coefficients(m_logAJFOBA1G))
conf <- exp(confint(m_logAJFOBA1G))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFOBA1G, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFOBA1G$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFOBA1G$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFOBA1G))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJFOBA1G)[2:11,2] - confint(m_logAJFOBA1G)[2:11,1]))
Retorno_modelo
```




#### Omicron Ba2 phase (from 01-04-22)

```{r include=FALSE}
fase_omicronBa2 <- dados_analise2P %>% 
                 dplyr::mutate(omicron_Ba2 = dplyr::case_when(resultado == 1 & LB_creation_date >= "2022-04-01" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date >= "2022-04-01")
```

Há `r nrow(fase_omicronBa2)` participantes com duas ou mais doses do tipo Pfizer. Há `r sum(fase_omicronBa2$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronBa2$exp2P == 0)` não vacinados. São `r sum(fase_omicronBa2$resultado == 1)` positivos e `r sum(fase_omicronBa2$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado para Omicron Ba1 phase (01-12-21 to 30-03-22). 

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFOBA2 <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronBa2)

m_results <-  summary(m_logAJFOBA2)
odds <- exp(coefficients(m_logAJFOBA2))
conf <- exp(confint(m_logAJFOBA2))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFOBA2, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFOBA2$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFOBA2$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFOBA2))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJFOBA2)[2:8,2] - confint(m_logAJFOBA2)[2:8,1]))
Retorno_modelo
```


#### Omicron Ba2 Genotipagem

```{r include=FALSE}

# fase_omicronba2G <- dados_analise2P %>% 
#                  dplyr::mutate(omicronba2 = dplyr::case_when(variante == "Omicron Ba.2"  ~ "Omicron Ba2",
#                                                         is.na(variante)     ~ NA_character_,
#                                                         TRUE ~ "Outras"),
#                                omicronba2 = base::factor(omicronba2, levels = c("Outras","Omicron Ba2"))
#                                resultado = dplyr::case_when(resultado == 1 ~ 1,
#                                                             resultado == 2 ~ 0),
#                                resultado = base::factor(resultado, levels = c("0","1"))) 

#, "Omicron Ba.4" , "Inconclusivo" , "Inválido" , "Delta
fase_omicronba2G <- dados_analise2P %>% 
                    dplyr::mutate(variante = base::ifelse(is.na(variante), "Sem Covid", variante)) %>% 
                    dplyr::filter(variante %in% c("Omicron Ba.2", "Sem Covid")) %>% 
                    dplyr::mutate(resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 3  | resultado == 2  ~ 0),
                               
                                  resultado = base::factor(resultado, levels = c("0","1"))) 
```

Há `r nrow(fase_omicronba2G)` participantes nesta fase. Há `r sum(fase_omicronba2G$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronba2G$exp2P == 0)` não vacinados. São `r sum(fase_omicronba2G$resultado == 1)` positivos e `r sum(fase_omicronba2G$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################


# m_logAJFOBA2G <-  glm(resultado ~ exp2P, 
#                        family = 'binomial', 
#                        data = fase_omicronba2G)


m_logAJFOBA2G <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronba2G)

m_results2G <-  summary(m_logAJFOBA2G)

odds2G <- exp(coefficients(m_logAJFOBA2G))

conf2G <- exp(confint(m_logAJFOBA2G))

#amplitude2G <-  conf[2,2] - conf[2,1]
modeloCompleto2G <- car::Anova(m_logAJFOBA2G, type = '3')

Coeficientes2G <- paste0((round(exp(m_logAJFOBA2G$coefficients[2]),3)),
                       ' (',
                       round(conf2G[2,1],3),
                       ';',
                       round(conf2G[2,2],3), ')')

ve2G <- paste0((round(1 - exp(m_logAJFOBA2G$coefficients[2]),3)),
             ' (',
             round((1 - conf2G[2,2]),3),
             ';',
             round((1 - conf2G[2,1]),3), ')')

Retorno_modelo2G <-  data.frame(Coeficientes2G,
                              ve2G,
                              P_valor = round(coef(summary(m_logAJFOBA2G))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logAJFOBA2G)[2,2] - confint(m_logAJFOBA2G)[2,1]))
Retorno_modelo2G
```



#### First patient enrollment only

```{r message=FALSE, warning=FALSE}

dados_FPE  <-  dados_analise2P %>%
                  dplyr::arrange(nome_completo, data_de_nascimento, LB_creation_date) %>%
                  dplyr::group_by(nome_completo, data_de_nascimento) %>%
                  dplyr::mutate(ordem = row_number()) %>%
                  dplyr::ungroup() %>% 
                  dplyr::filter(ordem == 1)
```

Há `r nrow(dados_FPE)` participantes com primeira entrada. Há `r sum(dados_FPE$exp2P == 1)` participantes com Pfizer (duas) e `r sum(dados_FPE$exp2P == 0)` não vacinados. São `r sum(dados_FPE$resultado == 1)` positivos e `r sum(dados_FPE$resultado == 2)` negativos.


```{r echo=FALSE, message=FALSE, warning=FALSE}
###################################
# MODELO AJUSTADO: FIRST PATIENT  #
###################################

m_logAJFPE <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_FPE)

m_results <-  summary(m_logAJFPE)
odds <- exp(coefficients(m_logAJFPE))
conf <- exp(confint(m_logAJFPE))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFPE, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFPE$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFPE$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFPE))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJFPE)[2:8,2] - confint(m_logAJFPE)[2:8,1]))
Retorno_modelo
```

#### Control group with <5 days of symptoms


```{r echo=FALSE}
############################## 
#       Caso 5 dias          #
##############################

dados_CG <- dados_analise2P %>% 
             dplyr::filter(data_dif_tempoDoseControle == 0) 

```

Há `r nrow(dados_CG)` participantes. Há `r sum(dados_CG$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_CG$exp2P == 0)` não vacinados. São `r sum(dados_CG$resultado == 1)` positivos e `r sum(dados_CG$resultado == 2)` negativos.

```{r echo=FALSE}
m_logAJCG <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_CG)

m_results <-  summary(m_logAJCG)
odds <- exp(coefficients(m_logAJCG))
conf <- exp(confint(m_logAJCG))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJCG, type = '3')

Coeficientes <- paste0((round(exp(m_logAJCG$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCG$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCG))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJCG)[2:8,2] - confint(m_logAJCG)[2:8,1]))
Retorno_modelo
```

### Variantes

O gráfico ao longo da semana epidemiológica das variantes se encontra abaixo:

```{r echo=TRUE, message=FALSE, warning=FALSE}
base_figura <-  dados_analise2P %>%
  dplyr::select(semana_do_estudo, variante) %>%
  dplyr::group_by(semana_do_estudo, variante) %>%
  dplyr::tally() %>%
  dplyr::mutate(variante = base::ifelse(is.na(variante), 'Sem Covid', variante)) %>%
  dplyr::filter(!(variante %in% c('Sem Covid', 'Inconclusivo'))) %>% 
  dplyr::mutate(variante = dplyr::recode(variante, "Omicron Ba.1" = "Ômicron BA.1",
                                                   "Omicron Ba.2" = "Ômicron BA.2",
                                                   "Omicron Ba.5" = "Ômicron BA.5")) %>%
  dplyr::group_by(variante) %>%
  dplyr::mutate(acumulado =  cumsum(n)) %>% 
  dplyr::rename('Variant' = variante)

base_figura %>%
  ggplot(aes(y = acumulado, x = semana_do_estudo, color = Variant)) +
  geom_line() +
  labs(x = "Epidemiological Week", y = "N Accumulated", fill = "Variant") +
  scale_x_continuous(name = 'Epidemiological Week', limits = c(1,38), breaks = seq(1,38,by = 1)) +
  scale_y_continuous(name = 'N Accumulated', limits = c(0,350), breaks = seq(0,350,by = 50))+
  theme_bw()
```

#### Exposição

```{r echo=TRUE}
variante_summary <-  
  list("Variant" =
         list("Delta – no/total no. (%)"        =  ~ qwraps2::n_perc(variante == "Delta", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.1 – no/total no. (%)" =  ~ qwraps2::n_perc(variante == "Omicron Ba.1", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.2 – no/total no. (%)" =  ~ qwraps2::n_perc(variante == "Omicron Ba.2", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.5 – no/total no. (%)" =  ~ qwraps2::n_perc(variante == "Omicron Ba.5", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Not possible to identify – no/total no. (%)" =  ~ qwraps2::n_perc(variante == "Inconclusivo" |
                                                                                 variante == "FALSO" |
                                                                                 variante == "Inválido" , show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "COVID (PCR-negative) – no/total no. (%)"     =  ~ qwraps2::n_perc(resultado == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)))
options(qwraps2_markup = "markdown")
completo_variante <- qwraps2::summary_table(dplyr::group_by(dados_analise2P, exp2P),
                           summaries = variante_summary)
completo_variante

```

```{r message=FALSE, warning=FALSE,  results = "asis"}
####################
#      VARIANTE
###################
options(qwraps2_markup = "markdown")
completo_variante <- qwraps2::summary_table(dplyr::group_by(dados_analise2P, variante),
                           summaries = our_summary1)
completo_variante


completo_variante <- data.frame(completo_variante)
completo_variante$nome <- rownames(completo_variante)

# print(completo_pcr,
#       rtitle = "Summary Statistics",
#       cnames = c("All participants"))
```

#### Completo

```{r echo=TRUE}
variante_summary <-  
  list("Variant" =
         list("Delta – no/total no. (%)"        =  ~ qwraps2::n_perc(variante == "Delta", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.1 – no/total no. (%)" =  ~ qwraps2::n_perc(variante == "Omicron Ba.1", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.2 – no/total no. (%)" =  ~ qwraps2::n_perc(variante == "Omicron Ba.2", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Ômicron Ba.5 – no/total no. (%)" =  ~ qwraps2::n_perc(variante == "Omicron Ba.5", show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "Not possible to identify – no/total no. (%)" =  ~ qwraps2::n_perc(variante == "Inconclusivo" |
                                                                                 variante == "FALSO" |
                                                                                 variante == "Inválido" , show_symbol = TRUE, show_denom = "always", na_rm = TRUE),
              "COVID (PCR-negative) – no/total no. (%)"     =  ~ qwraps2::n_perc(resultado == 2, show_symbol = TRUE, show_denom = "always", na_rm = TRUE)))
options(qwraps2_markup = "markdown")
completo_variante <- qwraps2::summary_table(dplyr::group_by(dados_completo),
                           summaries = variante_summary)
completo_variante

```

```{r message=FALSE, warning=FALSE,  results = "asis"}
####################
#      VARIANTE
###################
options(qwraps2_markup = "markdown")
completo_variante <- qwraps2::summary_table(dplyr::group_by(dados_completo, variante),
                           summaries = our_summary1)
completo_variante


completo_variante <- data.frame(completo_variante)
completo_variante$nome <- rownames(completo_variante)

# print(completo_pcr,
#       rtitle = "Summary Statistics",
#       cnames = c("All participants"))
```

#### Ômicron

```{r message=FALSE, warning=FALSE,  results = "asis"}
####################
#      VARIANTE
###################

dados_omicrontab  <- dados_completo %>% 
                       dplyr::mutate(omicrontab = dplyr::case_when(variante == "Omicron Ba.1" ~ "Omicron Ba.1",
                                                                   variante == "Omicron Ba.2" ~ "Omicron Ba.2",
                                                                   variante == "Omicron Ba.5" ~ "Omicron Ba.5",
                                                                   variante == "Omicron Ba.1" | variante == "Omicron Ba.2" |
                                                                   variante == "Omicron Ba.5" ~ "Ômicron",
                                                                   TRUE ~ "Outros"),
                                     omicron = dplyr::case_when(variante == "Omicron Ba.1" | variante == "Omicron Ba.2" |
                                                                variante == "Omicron Ba.5" ~ "Ômicron",
                                                                TRUE ~ "Outros"))

###################
options(qwraps2_markup = "markdown")
completo_omicron <- qwraps2::summary_table(dplyr::group_by(dados_omicrontab, omicron),
                           summaries = our_summary1)
completo_omicron


completo_omicron <- data.frame(completo_omicron)
completo_omicron$nome <- rownames(completo_omicron)

# print(completo_pcr,
#       rtitle = "Summary Statistics",
#       cnames = c("All participants"))
```


#### Pareamento
##### Ômicron


```{r message=FALSE, warning=FALSE}

dados_resumoBA <-  dados_analise2P %>% 
                    dplyr::mutate(variante = base::ifelse(resultado == 1 & is.na(variante),
                                                          "Inválido",
                                                           base::ifelse(resultado == 2,
                                                          "Sem Covid",
                                                           variante)))  %>%
                    # dplyr::select(recruitment_number, exp2P, resultado, idade_cat4, sexo, LB_indice_charlson_cat2,
                    #               cat_imc0, LB5, quartil_analise, variante, LB_creation_date) %>%
                    dplyr::mutate(dia_creation = lubridate::day(LB_creation_date),
                                  mes_creation = lubridate::month(LB_creation_date),
                                  ano_creation = lubridate::year(LB_creation_date)) %>%
                    dplyr::mutate(vpar_1 = paste(dia_creation,
                                                 mes_creation,
                                                 ano_creation,
                                                 idade_cat4,
                                                 sexo,
                                                 LB_indice_charlson_cat2,
                                                 cat_imc0,
                                                 LB5,
                                                 sep = ';'
                                                 )) %>%
                    dplyr::filter(variante %in% c("Omicron Ba.1", "Omicron Ba.2", "Omicron Ba.4", "Sem Covid")) 
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################################################
### Base de controles
##############################################################################################
controles_resumoBA <-  dados_resumoBA %>%
                          dplyr::filter(variante %in% 'Sem Covid') %>% 
                          dplyr::select(recruitment_number, exp2P, resultado, idade_cat4, sexo, LB_indice_charlson_cat2,
                                       cat_imc0, LB5, quartil_analise, variante, LB_creation_date) 
##############################################################################################
#### Base de casos
##############################################################################################
casos_resumoBA <-  dados_resumoBA %>%
                   dplyr::filter(!variante %in% 'Sem Covid') %>% 
                          dplyr::select(recruitment_number, exp2P, resultado, idade_cat4, sexo, LB_indice_charlson_cat2,
                                        cat_imc0, LB5, quartil_analise, variante, LB_creation_date)
##############################################################################################
# Estamos com 334 casos e 1172 controles
#table(dados_resumoBA1$variante, useNA = 'always')
# Logica: Cada um dos casos deve possuir um controle em uma janela de tempo definida;
# Criterios - Paciente com mesma faixa-etária, no mesmo dia - o id mais baixo é o critério de desempate;
# Vou criar um banco com todas as combinações possiveis entre casos e controles
##############################################################################################
names(casos_resumoBA)     <-  base::paste0(names(casos_resumoBA),'_','casos')
names(controles_resumoBA) <-  base::paste0(names(controles_resumoBA),'_','controles')
base_combinadaBA          <-  base::merge(casos_resumoBA, controles_resumoBA)
##############################################################################################
#### Combinacao Perfeita ####
##############################################################################################
base_combinadaBA <-  base_combinadaBA %>%
                      dplyr::mutate(diferenca_data = base::abs(base::as.numeric(base::difftime(LB_creation_date_casos,LB_creation_date_controles, units = 'days'))),
                                    igual_idade = base::ifelse(idade_cat4_casos == idade_cat4_controles, 1,0),
                                    igual_sexo =  base::ifelse(sexo_casos == sexo_controles, 1,0),
                                    igual_charlson =  base::ifelse(LB_indice_charlson_cat2_casos == LB_indice_charlson_cat2_controles, 1,0),
                                    igual_imc =  base::ifelse(cat_imc0_casos == cat_imc0_controles, 1,0),
                                    igual_lb5 =  base::ifelse(LB5_casos == LB5_controles, 1,0)
                                    ) %>%
                      dplyr::mutate(igual_data   = base::ifelse(diferenca_data == 0,1,0),
                                    igual_data_7 = base::ifelse(diferenca_data <= 7 ,1 ,0)) %>% 
                      dplyr::mutate(criterio = base::ifelse(igual_data_7   == 1 &
                                                            igual_idade    == 1 &
                                                            igual_sexo     == 1 &
                                                            igual_charlson == 1 &
                                                            igual_imc      == 1 &
                                                            igual_lb5      == 1, 1,0))
##############################################################################################
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################################################
#### Rodada 1 - Par Perfeito ####
##############################################################################################
pares <-  base_combinadaBA %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data, recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareadaBA <-  pares %>%
                 dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

##############################################################################################
#### Rodada 2 ####  
##############################################################################################
pares <-  pares %>%
          dplyr::filter(!recruitment_number_casos %in% base_pareadaBA$recruitment_number_casos) %>%
          dplyr::filter(!recruitment_number_controles %in% base_pareadaBA$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data, recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA <-  base_pareadaBA %>%
                    base::rbind(base_pareada_auxiliarBA)

rm(base_pareada_auxiliarBA)

##############################################################################################
#### Rodada  3 #### 
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA <- pares %>%
                            dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA <-  base_pareadaBA %>%
                    base::rbind(base_pareada_auxiliarBA)

rm(base_pareada_auxiliarBA)

##############################################################################################
#### Rodada 4 ####    
##############################################################################################

pares <-  pares %>%
          dplyr::filter(!recruitment_number_casos %in% base_pareadaBA$recruitment_number_casos) %>%
          dplyr::filter(!recruitment_number_controles %in% base_pareadaBA$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA <-  base_pareadaBA %>%
                    base::rbind(base_pareada_auxiliarBA)

rm(base_pareada_auxiliarBA)

##############################################################################################
#### Rodada 5 ####   
##############################################################################################

pares <-  pares %>%
          dplyr::filter(!recruitment_number_casos %in% base_pareadaBA$recruitment_number_casos) %>%
          dplyr::filter(!recruitment_number_controles %in% base_pareadaBA$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA <-  base_pareadaBA %>%
                    base::rbind(base_pareada_auxiliarBA)
rm(base_pareada_auxiliarBA)

##############################################################################################
#### Rodada 6 #### 
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA$recruitment_number_controles)

pares <- pares %>%
         dplyr::group_by(recruitment_number_casos, criterio) %>%
         dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
         dplyr::mutate(ordem_controle = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
         dplyr::group_by(recruitment_number_controles, criterio) %>%
         dplyr::mutate(ordem_caso = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::filter(criterio == 1)

base_pareada_auxiliarBA <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)
base_pareadaBA <-  base_pareadaBA %>%
                    base::rbind(base_pareada_auxiliarBA)
rm(base_pareada_auxiliarBA)

##############################################################################################
#### Rodada 7 #### 
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA$recruitment_number_controles)

pares <- pares %>%
         dplyr::group_by(recruitment_number_casos, criterio) %>%
         dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
         dplyr::mutate(ordem_controle = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
         dplyr::group_by(recruitment_number_controles, criterio) %>%
         dplyr::mutate(ordem_caso = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::filter(criterio == 1)

base_pareada_auxiliarBA <- pares %>%
                            dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA <- base_pareadaBA %>%
                   base::rbind(base_pareada_auxiliarBA)

rm(base_pareada_auxiliarBA)

##############################################################################################
#### Rodada 8 ####   
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA$recruitment_number_controles)
rm(pares)
# Ficamos com 255 pares #
# Criacao da coluna de identificador do par
base_pareadaBA$par <- paste0(base_pareadaBA$recruitment_number_casos,'-',base_pareadaBA$recruitment_number_controles) 


```

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################################################
# Novo banco de dados ####
##############################################################################################

base_pareada_casos <-  base_pareadaBA %>%
                       dplyr::select(recruitment_number_casos, par) %>%
                       dplyr::rename('recruitment_number' = 'recruitment_number_casos')

base_pareada_controles <- base_pareadaBA %>%
                          dplyr::select(recruitment_number_controles, par) %>%
                          dplyr::rename('recruitment_number' = 'recruitment_number_controles')

base_pareada_resumoBA <- base::rbind(base_pareada_casos, base_pareada_controles)
rm(base_pareada_casos, base_pareada_controles)

# Dados pareados ####
dados_BA <-  dados_resumoBA %>%
                    dplyr::left_join(base_pareada_resumoBA, by = c('recruitment_number' = 'recruitment_number')) %>%
                    dplyr::filter(!is.na(par)) 

```


##### BA.1

```{r message=FALSE, warning=FALSE}

dados_resumoBA1 <-  dados_analise2P %>% 
                    dplyr::mutate(variante = base::ifelse(resultado == 1 & is.na(variante),
                                                          "Inválido",
                                                           base::ifelse(resultado == 2,
                                                          "Sem Covid",
                                                           variante)))  %>%
                    # dplyr::select(recruitment_number, exp2P, resultado, idade_cat4, sexo, LB_indice_charlson_cat2,
                    #               cat_imc0, LB5, quartil_analise, variante, LB_creation_date) %>%
                    dplyr::mutate(dia_creation = lubridate::day(LB_creation_date),
                                  mes_creation = lubridate::month(LB_creation_date),
                                  ano_creation = lubridate::year(LB_creation_date)) %>%
                    dplyr::mutate(vpar_1 = paste(dia_creation,
                                                 mes_creation,
                                                 ano_creation,
                                                 idade_cat4,
                                                 sexo,
                                                 LB_indice_charlson_cat2,
                                                 cat_imc0,
                                                 LB5,
                                                 sep = ';'
                                                 )) %>%
                    dplyr::filter(variante %in% c("Omicron Ba.1", "Sem Covid")) 
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################################################
### Base de controles
##############################################################################################
controles_resumoBA1 <-  dados_resumoBA1 %>%
                          dplyr::filter(variante %in% 'Sem Covid') %>% 
                          dplyr::select(recruitment_number, exp2P, resultado, idade_cat4, sexo, LB_indice_charlson_cat2,
                                       cat_imc0, LB5, quartil_analise, variante, LB_creation_date) 
##############################################################################################
#### Base de casos
##############################################################################################
casos_resumoBA1 <-  dados_resumoBA1 %>%
                   dplyr::filter(!variante %in% 'Sem Covid') %>% 
                          dplyr::select(recruitment_number, exp2P, resultado, idade_cat4, sexo, LB_indice_charlson_cat2,
                                        cat_imc0, LB5, quartil_analise, variante, LB_creation_date)
##############################################################################################
# Estamos com 334 casos e 1172 controles
#table(dados_resumoBA1$variante, useNA = 'always')
# Logica: Cada um dos casos deve possuir um controle em uma janela de tempo definida;
# Criterios - Paciente com mesma faixa-etária, no mesmo dia - o id mais baixo é o critério de desempate;
# Vou criar um banco com todas as combinações possiveis entre casos e controles
##############################################################################################
names(casos_resumoBA1)     <-  base::paste0(names(casos_resumoBA1),'_','casos')
names(controles_resumoBA1) <-  base::paste0(names(controles_resumoBA1),'_','controles')
base_combinadaBA1          <-  base::merge(casos_resumoBA1, controles_resumoBA1)
##############################################################################################
#### Combinacao Perfeita ####
##############################################################################################
base_combinadaBA1 <-  base_combinadaBA1 %>%
                      dplyr::mutate(diferenca_data = base::abs(base::as.numeric(base::difftime(LB_creation_date_casos,LB_creation_date_controles, units = 'days'))),
                                    igual_idade = base::ifelse(idade_cat4_casos == idade_cat4_controles, 1,0),
                                    igual_sexo =  base::ifelse(sexo_casos == sexo_controles, 1,0),
                                    igual_charlson =  base::ifelse(LB_indice_charlson_cat2_casos == LB_indice_charlson_cat2_controles, 1,0),
                                    igual_imc =  base::ifelse(cat_imc0_casos == cat_imc0_controles, 1,0),
                                    igual_lb5 =  base::ifelse(LB5_casos == LB5_controles, 1,0)
                                    ) %>%
                      dplyr::mutate(igual_data   = base::ifelse(diferenca_data == 0,1,0),
                                    igual_data_7 = base::ifelse(diferenca_data <= 7 ,1 ,0)) %>% 
                      dplyr::mutate(criterio = base::ifelse(igual_data_7   == 1 &
                                                            igual_idade    == 1 &
                                                            igual_sexo     == 1 &
                                                            igual_charlson == 1 &
                                                            igual_imc      == 1 &
                                                            igual_lb5      == 1, 1,0))
##############################################################################################
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################################################
#### Rodada 1 - Par Perfeito ####
##############################################################################################
pares <-  base_combinadaBA1 %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data, recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareadaBA1 <-  pares %>%
                 dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

##############################################################################################
#### Rodada 2 ####  
##############################################################################################
pares <-  pares %>%
          dplyr::filter(!recruitment_number_casos %in% base_pareadaBA1$recruitment_number_casos) %>%
          dplyr::filter(!recruitment_number_controles %in% base_pareadaBA1$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data, recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA1 <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA1 <-  base_pareadaBA1 %>%
                    base::rbind(base_pareada_auxiliarBA1)

rm(base_pareada_auxiliarBA1)

##############################################################################################
#### Rodada  3 #### 
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA1$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA1$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA1 <- pares %>%
                            dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA1 <-  base_pareadaBA1 %>%
                    base::rbind(base_pareada_auxiliarBA1)

rm(base_pareada_auxiliarBA1)

##############################################################################################
#### Rodada 4 ####    
##############################################################################################

pares <-  pares %>%
          dplyr::filter(!recruitment_number_casos %in% base_pareadaBA1$recruitment_number_casos) %>%
          dplyr::filter(!recruitment_number_controles %in% base_pareadaBA1$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA1 <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA1 <-  base_pareadaBA1 %>%
                    base::rbind(base_pareada_auxiliarBA1)

rm(base_pareada_auxiliarBA1)

##############################################################################################
#### Rodada 5 ####   
##############################################################################################

pares <-  pares %>%
          dplyr::filter(!recruitment_number_casos %in% base_pareadaBA1$recruitment_number_casos) %>%
          dplyr::filter(!recruitment_number_controles %in% base_pareadaBA1$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA1 <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA1 <-  base_pareadaBA1 %>%
                    base::rbind(base_pareada_auxiliarBA1)
rm(base_pareada_auxiliarBA1)

##############################################################################################
#### Rodada 6 #### 
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA1$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA1$recruitment_number_controles)

pares <- pares %>%
         dplyr::group_by(recruitment_number_casos, criterio) %>%
         dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
         dplyr::mutate(ordem_controle = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
         dplyr::group_by(recruitment_number_controles, criterio) %>%
         dplyr::mutate(ordem_caso = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::filter(criterio == 1)

base_pareada_auxiliarBA1 <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)
base_pareadaBA1 <-  base_pareadaBA1 %>%
                    base::rbind(base_pareada_auxiliarBA1)
rm(base_pareada_auxiliarBA1)

##############################################################################################
#### Rodada 7 #### 
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA1$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA1$recruitment_number_controles)

pares <- pares %>%
         dplyr::group_by(recruitment_number_casos, criterio) %>%
         dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
         dplyr::mutate(ordem_controle = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
         dplyr::group_by(recruitment_number_controles, criterio) %>%
         dplyr::mutate(ordem_caso = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::filter(criterio == 1)

base_pareada_auxiliarBA1 <- pares %>%
                            dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA1 <- base_pareadaBA1 %>%
                   base::rbind(base_pareada_auxiliarBA1)

rm(base_pareada_auxiliarBA1)

##############################################################################################
#### Rodada 8 ####   
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA1$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA1$recruitment_number_controles)
rm(pares)
# Ficamos com 255 pares #
# Criacao da coluna de identificador do par
base_pareadaBA1$par <- paste0(base_pareadaBA1$recruitment_number_casos,'-',base_pareadaBA1$recruitment_number_controles) 


```

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################################################
# Novo banco de dados ####
##############################################################################################

base_pareada_casos <-  base_pareadaBA1 %>%
                       dplyr::select(recruitment_number_casos, par) %>%
                       dplyr::rename('recruitment_number' = 'recruitment_number_casos')

base_pareada_controles <- base_pareadaBA1 %>%
                          dplyr::select(recruitment_number_controles, par) %>%
                          dplyr::rename('recruitment_number' = 'recruitment_number_controles')

base_pareada_resumoBA1 <- base::rbind(base_pareada_casos, base_pareada_controles)
rm(base_pareada_casos, base_pareada_controles)

# Dados pareados ####
dados_BA1 <-  dados_resumoBA1 %>%
                    dplyr::left_join(base_pareada_resumoBA1, by = c('recruitment_number' = 'recruitment_number')) %>%
                    dplyr::filter(!is.na(par)) 

```

##### BA.2

```{r message=FALSE, warning=FALSE}

dados_resumoBA2 <-  dados_analise2P %>% 
                    dplyr::mutate(variante = base::ifelse(resultado == 1 & is.na(variante),
                                                          "Inválido",
                                                           base::ifelse(resultado == 2,
                                                          "Sem Covid",
                                                           variante)))  %>%
                    # dplyr::select(recruitment_number, exp2P, resultado, idade_cat4, sexo, LB_indice_charlson_cat2,
                    #               cat_imc0, LB5, quartil_analise, variante, LB_creation_date) %>%
                    dplyr::mutate(dia_creation = lubridate::day(LB_creation_date),
                                  mes_creation = lubridate::month(LB_creation_date),
                                  ano_creation = lubridate::year(LB_creation_date)) %>%
                    dplyr::mutate(vpar_1 = paste(dia_creation,
                                                 mes_creation,
                                                 ano_creation,
                                                 idade_cat4,
                                                 sexo,
                                                 LB_indice_charlson_cat2,
                                                 cat_imc0,
                                                 LB5,
                                                 sep = ';'
                                                 )) %>%
                    dplyr::filter(variante %in% c("Omicron Ba.2", "Sem Covid")) 
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################################################
### Base de controles
##############################################################################################
controles_resumoBA2 <-  dados_resumoBA2 %>%
                        dplyr::filter(variante %in% 'Sem Covid') %>% 
                        dplyr::select(recruitment_number, exp2P, resultado, idade_cat4, sexo, LB_indice_charlson_cat2,
                                       cat_imc0, LB5, quartil_analise, variante, LB_creation_date) 
##############################################################################################
#### Base de casos
##############################################################################################
casos_resumoBA2 <-  dados_resumoBA2 %>%
                    dplyr::filter(!variante %in% 'Sem Covid') %>% 
                          dplyr::select(recruitment_number, exp2P, resultado, idade_cat4, sexo, LB_indice_charlson_cat2,
                                        cat_imc0, LB5, quartil_analise, variante, LB_creation_date)
##############################################################################################
# Estamos com 334 casos e 1172 controles
#table(dados_resumoBA1$variante, useNA = 'always')
# Logica: Cada um dos casos deve possuir um controle em uma janela de tempo definida;
# Criterios - Paciente com mesma faixa-etária, no mesmo dia - o id mais baixo é o critério de desempate;
# Vou criar um banco com todas as combinações possiveis entre casos e controles
##############################################################################################
names(casos_resumoBA2)     <-  base::paste0(names(casos_resumoBA2),'_','casos')
names(controles_resumoBA2) <-  base::paste0(names(controles_resumoBA2),'_','controles')
base_combinadaBA2          <-  base::merge(casos_resumoBA2, controles_resumoBA2)
##############################################################################################
#### Combinacao Perfeita ####
##############################################################################################
base_combinadaBA2 <-  base_combinadaBA2 %>%
                      dplyr::mutate(diferenca_data = base::abs(base::as.numeric(base::difftime(LB_creation_date_casos,LB_creation_date_controles, units = 'days'))),
                                    igual_idade = base::ifelse(idade_cat4_casos == idade_cat4_controles, 1,0),
                                    igual_sexo =  base::ifelse(sexo_casos == sexo_controles, 1,0),
                                    igual_charlson =  base::ifelse(LB_indice_charlson_cat2_casos == LB_indice_charlson_cat2_controles, 1,0),
                                    igual_imc =  base::ifelse(cat_imc0_casos == cat_imc0_controles, 1,0),
                                    igual_lb5 =  base::ifelse(LB5_casos == LB5_controles, 1,0)
                                    ) %>%
                      dplyr::mutate(igual_data   = base::ifelse(diferenca_data == 0,1,0),
                                    igual_data_7 = base::ifelse(diferenca_data <= 7 ,1 ,0)) %>% 
                      dplyr::mutate(criterio = base::ifelse(igual_data_7   == 1 &
                                                            igual_idade    == 1 &
                                                            igual_sexo     == 1 &
                                                            igual_charlson == 1 &
                                                            igual_imc      == 1 &
                                                            igual_lb5      == 1, 1,0))
##############################################################################################
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################################################
#### Rodada 1 - Par Perfeito ####
##############################################################################################
pares <-  base_combinadaBA2 %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data, recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareadaBA2 <-  pares %>%
                 dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

##############################################################################################
#### Rodada 2 ####  
##############################################################################################
pares <-  pares %>%
          dplyr::filter(!recruitment_number_casos %in% base_pareadaBA2$recruitment_number_casos) %>%
          dplyr::filter(!recruitment_number_controles %in% base_pareadaBA2$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data, recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA2 <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA2 <-  base_pareadaBA2 %>%
                    base::rbind(base_pareada_auxiliarBA2)

rm(base_pareada_auxiliarBA2)

##############################################################################################
#### Rodada  3 #### 
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA2$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA2$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA2 <- pares %>%
                            dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA2 <-  base_pareadaBA2 %>%
                    base::rbind(base_pareada_auxiliarBA2)

rm(base_pareada_auxiliarBA2)

##############################################################################################
#### Rodada 4 ####    
##############################################################################################

pares <-  pares %>%
          dplyr::filter(!recruitment_number_casos %in% base_pareadaBA2$recruitment_number_casos) %>%
          dplyr::filter(!recruitment_number_controles %in% base_pareadaBA2$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA2 <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA2 <-  base_pareadaBA2 %>%
                    base::rbind(base_pareada_auxiliarBA2)

rm(base_pareada_auxiliarBA2)

##############################################################################################
#### Rodada 5 ####   
##############################################################################################

pares <-  pares %>%
          dplyr::filter(!recruitment_number_casos %in% base_pareadaBA2$recruitment_number_casos) %>%
          dplyr::filter(!recruitment_number_controles %in% base_pareadaBA2$recruitment_number_controles)

pares <-  pares %>%
          dplyr::group_by(recruitment_number_casos, criterio) %>%
          dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
          dplyr::mutate(ordem_controle = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
          dplyr::group_by(recruitment_number_controles, criterio) %>%
          dplyr::mutate(ordem_caso = row_number()) %>%
          dplyr::ungroup() %>%
          dplyr::filter(criterio == 1)

base_pareada_auxiliarBA2 <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA2 <-  base_pareadaBA2 %>%
                    base::rbind(base_pareada_auxiliarBA2)
rm(base_pareada_auxiliarBA2)

##############################################################################################
#### Rodada 6 #### 
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA2$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA2$recruitment_number_controles)

pares <- pares %>%
         dplyr::group_by(recruitment_number_casos, criterio) %>%
         dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
         dplyr::mutate(ordem_controle = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
         dplyr::group_by(recruitment_number_controles, criterio) %>%
         dplyr::mutate(ordem_caso = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::filter(criterio == 1)

base_pareada_auxiliarBA2 <-  pares %>%
                             dplyr::filter(ordem_controle == 1 & ordem_caso == 1)
base_pareadaBA2 <-  base_pareadaBA2 %>%
                    base::rbind(base_pareada_auxiliarBA2)
rm(base_pareada_auxiliarBA2)

##############################################################################################
#### Rodada 7 #### 
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA2$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA2$recruitment_number_controles)

pares <- pares %>%
         dplyr::group_by(recruitment_number_casos, criterio) %>%
         dplyr::arrange(diferenca_data, recruitment_number_controles) %>%
         dplyr::mutate(ordem_controle = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::arrange(diferenca_data,recruitment_number_casos) %>%
         dplyr::group_by(recruitment_number_controles, criterio) %>%
         dplyr::mutate(ordem_caso = row_number()) %>%
         dplyr::ungroup() %>%
         dplyr::filter(criterio == 1)

base_pareada_auxiliarBA2 <- pares %>%
                            dplyr::filter(ordem_controle == 1 & ordem_caso == 1)

base_pareadaBA2 <- base_pareadaBA2 %>%
                   base::rbind(base_pareada_auxiliarBA2)

rm(base_pareada_auxiliarBA2)

##############################################################################################
#### Rodada 8 ####   
##############################################################################################

pares <- pares %>%
         dplyr::filter(!recruitment_number_casos %in% base_pareadaBA2$recruitment_number_casos) %>%
         dplyr::filter(!recruitment_number_controles %in% base_pareadaBA2$recruitment_number_controles)
rm(pares)
# Ficamos com 255 pares #
# Criacao da coluna de identificador do par
base_pareadaBA2$par <- paste0(base_pareadaBA2$recruitment_number_casos,'-',base_pareadaBA2$recruitment_number_controles) 


```

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################################################
# Novo banco de dados ####
##############################################################################################

base_pareada_casos <-  base_pareadaBA2 %>%
                       dplyr::select(recruitment_number_casos, par) %>%
                       dplyr::rename('recruitment_number' = 'recruitment_number_casos')

base_pareada_controles <- base_pareadaBA2 %>%
                          dplyr::select(recruitment_number_controles, par) %>%
                          dplyr::rename('recruitment_number' = 'recruitment_number_controles')

base_pareada_resumoBA2 <- base::rbind(base_pareada_casos, base_pareada_controles)
rm(base_pareada_casos, base_pareada_controles)

# Dados pareados ####
dados_BA2 <-  dados_resumoBA2 %>%
                    dplyr::left_join(base_pareada_resumoBA2, by = c('recruitment_number' = 'recruitment_number')) %>%
                    dplyr::filter(!is.na(par)) 

```

##### Descritiva
###### Ômicron

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# ÔMICRON BA
######################
options(qwraps2_markup = "markdown")
omicron_batable <- qwraps2::summary_table(dplyr::group_by(dados_BA, exp2P),
                           summaries = our_summary1)
omicron_batable

omicron_batable <- data.frame(omicron_batable)
omicron_batable$nome <- rownames(omicron_batable)
```

###### BA.1

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# ÔMICRON BA1
######################
options(qwraps2_markup = "markdown")
omicron_ba1table <- qwraps2::summary_table(dplyr::group_by(dados_BA1, exp2P),
                           summaries = our_summary1)
omicron_ba1table

omicron_ba1table <- data.frame(omicron_ba1table)
omicron_ba1table$nome <- rownames(omicron_ba1table)
```

###### BA.2

```{r message=FALSE, warning=FALSE,  results = "asis"}
######################
# ÔMICRON BA1
######################
options(qwraps2_markup = "markdown")
omicron_ba2table <- qwraps2::summary_table(dplyr::group_by(dados_BA2, exp2P),
                           summaries = our_summary1)
omicron_ba2table

omicron_ba2table <- data.frame(omicron_ba2table)
omicron_ba2table$nome <- rownames(omicron_ba2table)
```

#### Modelagem
##### Bruto Ômicron

###### GLM

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Modelo 1 - Bruto ####
m_log_1 <-  stats::glm(resultado ~ exp2P, family = 'binomial', data = dados_BA)
m_results <-  summary(m_log_1)
intervalo <-  confint(m_log_1)
m_confint <-  exp(intervalo)
Coeficientes <-   paste0( ( round(exp(m_log_1$coefficients[2]),3)) , ' (',   
                        round(m_confint[2,1],3), ';', 
                        round(m_confint[2,2],3), ')' )
VE <-   paste0((
             round(1 - exp(m_log_1$coefficients[2]),3)) , ' (',   
             round(1- m_confint[2,2],3),';', 
             round(1 -m_confint[2,1],3), ')' )
Retorno_modelo1 <-  data.frame(VE,
                             Coeficientes, 
                             P_valor = round(coef(summary(m_log_1))[,'Pr(>|z|)'][2],3))
modelo_bruto <-  Retorno_modelo1


####################################
# Modelo 1 - Total - Quartis
####################################
m_log_2 <- stats::glm(resultado ~ exp2P + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5 + quartil_analise, 
                      family = 'binomial', 
                      data = dados_BA)

m_results <- summary(m_log_2)
intervalo <- confint(m_log_2)
m_confint <- exp(intervalo)
Coeficientes <- paste0((round(exp(m_log_2$coefficients[2]),3)) , ' (',   
                        round(m_confint[2,1],3), ';', 
                        round(m_confint[2,2],3), ')' )

VE <-   paste0((round(1 - exp(m_log_2$coefficients[2]),3)) , ' (',   
                round(1- m_confint[2,2],3),';', 
                round(1 -m_confint[2,1],3), ')' )

Retorno_modelo2 <- data.frame(VE,
                              Coeficientes, 
                              P_valor = round(coef(summary(m_log_2))[,'Pr(>|z|)'][2],3))
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
Crude <-  Retorno_modelo1
Crude
Ajustado <-  Retorno_modelo2
Ajustado
```

###### GEE

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
# Modelo Pareado por GEE ####
dados_BA$par_recod <-  base::as.factor(dados_BA$par)

dados_BA <-  dados_BA %>%
             dplyr::arrange(par_recod)

modelo_gee <- geepack::geeglm(resultado ~ exp2P, 
                              id = par_recod, 
                              family = 'binomial', 
                              corstr = 'exc', 
                              data = dados_BA)
summary(modelo_gee)
```

###### MM

```{r echo=TRUE, message=FALSE, warning=FALSE}

dados_BA$par_recod <-  base::as.factor(dados_BA$par)

dados_BA <-  dados_BA %>%
             dplyr::arrange(par_recod)

modelo_misto <-  lme4::glmer(resultado ~ exp2P + (1 | par_recod), family = binomial, data = dados_BA)
summary(modelo_misto)
```


##### Bruto BA.1

###### GLM

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Modelo 1 - Bruto ####
m_log_1 <-  stats::glm(resultado ~ exp2P, family = 'binomial', data = dados_BA1)
m_results <-  summary(m_log_1)
intervalo <-  confint(m_log_1)
m_confint <-  exp(intervalo)
Coeficientes <-   paste0( ( round(exp(m_log_1$coefficients[2]),3)) , ' (',   
                        round(m_confint[2,1],3), ';', 
                        round(m_confint[2,2],3), ')' )
VE <-   paste0((
             round(1 - exp(m_log_1$coefficients[2]),3)) , ' (',   
             round(1- m_confint[2,2],3),';', 
             round(1 -m_confint[2,1],3), ')' )
Retorno_modelo1 <-  data.frame(VE,
                             Coeficientes, 
                             P_valor = round(coef(summary(m_log_1))[,'Pr(>|z|)'][2],3))
modelo_bruto <-  Retorno_modelo1


####################################
# Modelo 1 - Total - Quartis
####################################
m_log_2 <- stats::glm(resultado ~ exp2P + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5 + quartil_analise, 
                      family = 'binomial', 
                      data = dados_BA1)

m_results <- summary(m_log_2)
intervalo <- confint(m_log_2)
m_confint <- exp(intervalo)
Coeficientes <- paste0((round(exp(m_log_2$coefficients[2]),3)) , ' (',   
                        round(m_confint[2,1],3), ';', 
                        round(m_confint[2,2],3), ')' )

VE <-   paste0((round(1 - exp(m_log_2$coefficients[2]),3)) , ' (',   
                round(1- m_confint[2,2],3),';', 
                round(1 -m_confint[2,1],3), ')' )

Retorno_modelo2 <- data.frame(VE,
                              Coeficientes, 
                              P_valor = round(coef(summary(m_log_2))[,'Pr(>|z|)'][2],3))

```

```{r echo=TRUE, message=FALSE, warning=FALSE}
Crude <-  Retorno_modelo1
Crude
Ajustado <-  Retorno_modelo2
Ajustado
```

###### GEE

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Modelo Pareado por GEE ####
dados_BA1$par_recod <-  base::as.factor(dados_BA1$par)

dados_BA1 <- dados_BA1 %>%
             dplyr::arrange(par_recod)

modelo_gee <- geepack::geeglm(resultado ~ exp2P, 
                              id = par_recod, 
                              family = 'binomial', 
                              corstr = 'exc', 
                              data = dados_BA1)
summary(modelo_gee)
```

###### MM

```{r echo=TRUE, message=FALSE, warning=FALSE}
modelo_misto <-  lme4::glmer(resultado ~ exp2P + (1 | par_recod), family = binomial, data = dados_BA1)
summary(modelo_misto)
```

##### Bruto BA.2

###### GLM

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Modelo 1 - Bruto ####
m_log_1 <-  stats::glm(resultado ~ exp2P, family = 'binomial', data = dados_BA2)
m_results <-  summary(m_log_1)
intervalo <-  confint(m_log_1)
m_confint <-  exp(intervalo)
Coeficientes <-   paste0( ( round(exp(m_log_1$coefficients[2]),3)) , ' (',   
                        round(m_confint[2,1],3), ';', 
                        round(m_confint[2,2],3), ')' )
VE <-   paste0((
             round(1 - exp(m_log_1$coefficients[2]),3)) , ' (',   
             round(1- m_confint[2,2],3),';', 
             round(1 -m_confint[2,1],3), ')' )
Retorno_modelo1 <-  data.frame(VE,
                             Coeficientes, 
                             P_valor = round(coef(summary(m_log_1))[,'Pr(>|z|)'][2],3))
modelo_bruto <-  Retorno_modelo1


####################################
# Modelo 1 - Total - Quartis
####################################
m_log_2 <- stats::glm(resultado ~ exp2P + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5 + quartil_analise, 
                      family = 'binomial', 
                      data = dados_BA2)

m_results <- summary(m_log_2)
intervalo <- confint(m_log_2)
m_confint <- exp(intervalo)
Coeficientes <- paste0((round(exp(m_log_2$coefficients[2]),3)) , ' (',   
                        round(m_confint[2,1],3), ';', 
                        round(m_confint[2,2],3), ')' )

VE <-   paste0((round(1 - exp(m_log_2$coefficients[2]),3)) , ' (',   
                round(1- m_confint[2,2],3),';', 
                round(1 -m_confint[2,1],3), ')' )

Retorno_modelo2 <- data.frame(VE,
                              Coeficientes, 
                              P_valor = round(coef(summary(m_log_2))[,'Pr(>|z|)'][2],3))

```

```{r echo=TRUE, message=FALSE, warning=FALSE}
Crude <-  Retorno_modelo1
Crude
Ajustado <-  Retorno_modelo2
Ajustado
```

###### GEE

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Modelo Pareado por GEE ####
dados_BA2$par_recod <-  base::as.factor(dados_BA2$par)

dados_BA2 <- dados_BA2 %>%
             dplyr::arrange(par_recod)

modelo_gee <- geepack::geeglm(resultado ~ exp2P, 
                              id = par_recod, 
                              family = 'binomial', 
                              corstr = 'exc', 
                              data = dados_BA2)
summary(modelo_gee)
```

###### MM

```{r echo=TRUE, message=FALSE, warning=FALSE}
modelo_misto <-  lme4::glmer(resultado ~ exp2P + (1 | par_recod), family = binomial, data = dados_BA2)
summary(modelo_misto)
```



## Pfizer: 2/3 Pfizer 

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analise1R <-   dados_completo  %>%
                       dplyr::filter(exp_primaria == 1 | LB40 == 0) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(exp1 = dplyr::case_when(exp_primaria == 1 ~ "1",
                                                             LB40 == 0 ~ "0",
                                                             TRUE ~ NA_character_),
                                     exp1 = base::factor(exp1, levels = c("0", "1")))
```

Há `r nrow(dados_analise1R)` participantes com duas ou mais doses do tipo Pfizer. Há `r sum(dados_analise1R$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R$exp1 == 0)` não vacinados. São `r sum(dados_analise1R$resultado == 1)` positivos e `r sum(dados_analise1R$resultado == 2)` negativos. A tabela a seguir demonstra as características gerais destes participantes:

```{r message=FALSE, warning=FALSE, results= "asis"}
####################
#PFIZER: EXPOSIÇÃO
####################
#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")

doses_pfizer <- summary_table(dplyr::group_by(dados_analise1R, exp1),
                              summaries = our_summary1)
doses_pfizer

doses_pfizer <- data.frame(doses_pfizer)
doses_pfizer$nome <- rownames(doses_pfizer)
```

Tabela relacionada com os casos positivos e negativos:

```{r message=FALSE, warning=FALSE, results= "asis"}
##########################################
# PFIZER: 2 OU 3 DOSES + COVID E NÃO COVID
##########################################
options(qwraps2_markup = "markdown")
pfizer_23dosesNC <- qwraps2::summary_table(dplyr::group_by(dados_analise1R, resultado),
                           summaries = our_summary1)
pfizer_23dosesNC

pfizer_23dosesNC <- data.frame(pfizer_23dosesNC)
pfizer_23dosesNC$nome <- rownames(pfizer_23dosesNC)
```

Figura resumo:

```{r echo=FALSE, message=FALSE, warning=FALSE}
###############################################
#       TAXA DE POSITIVIDADE & ÔMICRON        #
###############################################

dados_analise1R %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                pfizer_semana_7dias    = sum(dias_Maior7_V2dosesplus == "1", na.rm = T),
                omicron_semana_7dias   = sum(omicron == "1", na.rm = T),
                pfizer_semana_doseplus = sum(V2dosesplus == "1", na.rm = T),
                taxa_positivos = positivos_semana/total_semana * 100,
                taxa_pfizer    = pfizer_semana_7dias/total_semana * 100,
                taxa_omicron   = omicron_semana_7dias/total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(pfizer_semana_7dias), x = as.numeric(semana_do_estudo), color = 'Pfizer')) +
  geom_line(aes(y = as.numeric(taxa_omicron), x = as.numeric(semana_do_estudo), color = 'Ômicron')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()


```


A relação de variante se encontra a seguir:


```{r message=FALSE, warning=FALSE, results= "asis"}
##########################################
# PFIZER: 2 DOSES
##########################################
options(qwraps2_markup = "markdown")
pfizer_23 <- qwraps2::summary_table(dplyr::group_by(dados_analise1R, exp1),
                           summaries = our_summary3)
pfizer_23

pfizer_23 <- data.frame(pfizer_23)
pfizer_23$nome <- rownames(pfizer_23)
```




### Modelo
#### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
#############################################
# MODELO BRUTO: DUAS OU TRÊS VACINAS PFIZER #
#############################################
m_logBC <-  glm(resultado ~  exp1, 
                family = 'binomial', 
                data = dados_analise1R)
m_results <-  summary(m_logBC)
odds <- exp(coefficients(m_logBC))
conf <- exp(confint(m_logBC))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes  <- paste0(( round(exp(m_logBC$coefficients[2]),3)) ,
                          ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo1 <-  data.frame(Coeficientes,
                               ve,
                               P_valor = round(coef(summary(m_logBC))[,'Pr(>|z|)'][2],3),
                               Amplitude = exp(confint(m_logBC)[2,2] - confint(m_logBC)[2,1]))
Retorno_modelo1
```

```{r echo=FALSE}
#############################################
#      Indica que o modelo ajustou ok       #
#############################################
library('ResourceSelection')
hoslem.test(dados_analise1R$resultado, fitted(m_logBC))
```


A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC, type = "deviance")
probabilitiesBC = predict(m_logBC, type = "response")

dados_analise1R <-  dados_analise1R %>%
  dplyr::mutate(logit_modeloBC = base::log(probabilitiesBC/(1-probabilitiesBC)),
                deviance_modeloBC = res.devBC) 

figura_1 <-  ggplot(dados_analise1R, aes(semana_do_estudo, y = deviance_modeloBC))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise1R, aes(semana_do_estudo, y = probabilitiesBC))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

##### Por Semana

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO BRUTO: DUAS OU TRÊS VACINAS PFIZER + SEMANA DO ESTUDO
###############################################

m_logBCSemana <-  glm(resultado ~  exp1 + semana_do_estudo, 
                      family = 'binomial', 
                      data = dados_analise1R)
m_results <-  summary(m_logBCSemana)
odds <- exp(coefficients(m_logBCSemana))
conf <- exp(confint(m_logBCSemana))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCSemana, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesBCSemana <- predict(m_logBCSemana, type = "response")

dados_analise1R <-  dados_analise1R %>%
                      dplyr::mutate(logit_modeloBCSemana = base::log(probabilitiesBCSemana/(1-probabilitiesBCSemana)),
                                    deviance_modeloBCSemana = residuals(m_logBCSemana, type = "deviance"))

Coeficientes <- paste0( (round(exp(m_logBCSemana$coefficients[2]),3)),
                        ' (',
                        round(conf[2,1],3),
                        ';', round(conf[2,2],3), ')')

ve <- paste0((round(1 - exp(m_logBCSemana$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')


Retorno_modelo <- data.frame(Coeficientes, 
                             ve,
                             P_valor   = round(coef(summary(m_logBCSemana))[,'Pr(>|z|)'][2],3),
                             Amplitude = exp(confint(m_logBCSemana)[2,2] - confint(m_logBCSemana)[2,1]))
Retorno_modelo
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCSemana)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}
figura_1 <-  ggplot(dados_analise1R, aes(deviance_modeloBCSemana, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise1R, aes(logit_modeloBCSemana, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3
```

##### Taxa Positivos

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TAXA DE POSITIVOS (por semana)
###############################################

m_logBCPositivo <-  glm(resultado ~ exp1 + taxa_positivos, 
                        family = 'binomial', 
                        data = dados_analise1R)

m_results <-  summary(m_logBCPositivo)
odds <- exp(coefficients(m_logBCPositivo))
conf <- exp(confint(m_logBCPositivo))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCPositivo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesBCPositivo <- predict(m_logBCPositivo, type = "response")

dados_analise1R <- dados_analise1R %>%
  dplyr::mutate(logit_modeloBCPositivo    = log(probabilitiesBCPositivo/(1-probabilitiesBCPositivo)),
                deviance_modeloBCPositivo = residuals(m_logBCPositivo, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logBCPositivo$coefficients[2]),3)),
                       ' (',   round(conf[2,1],3), ';',
                       round(conf[2,2],3), ')')


ve <- paste0((round(1 - exp(m_logBCPositivo$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBCPositivo))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBCPositivo)[2,2] - confint(m_logBCPositivo)[2,1]))
Retorno_modelo
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCPositivo)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise1R, aes(deviance_modeloBCPositivo, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_1 <-  ggplot(dados_analise1R, aes(logit_modeloBCPositivo, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

##### Taxa Pfizer

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TAXA DE PFIZER (por semana)
###############################################

m_logBCPfizer <-  glm(resultado ~ exp1 + taxa_pfizer, 
                      family = 'binomial', 
                      data = dados_analise1R)

m_results <-  summary(m_logBCPfizer)
odds <- exp(coefficients(m_logBCPfizer))
conf <- exp(confint(m_logBCPfizer))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCPfizer, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesBCPfizer <- predict(m_logBCPfizer, type = "response")

dados_analise1R <- dados_analise1R %>%
  dplyr::mutate(logit_modeloBCPfizer    = log(probabilitiesBCPfizer/(1-probabilitiesBCPfizer)),
                deviance_modeloBCPfizer = residuals(m_logBCPfizer, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logBCPfizer$coefficients[2]),3)),
                       ' (',   round(conf[2,1],3), ';',
                       round(conf[2,2],3), ')')

ve <- paste0((round(1 - exp(m_logBCPfizer$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logBCPfizer))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBCPfizer)[2,2] - confint(m_logBCPfizer)[2,1]))
Retorno_modelo
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCPfizer)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise1R, aes(deviance_modeloBCPfizer, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_1 <-  ggplot(dados_analise1R, aes(logit_modeloBCPfizer, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

##### Quartis

Abaixo se encontram resultados do modelo bruto por quartil.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO BRUTO: DUAS OU TRÊS VACINAS PFIZER: POR QUARTIS 
###############################################

m_logBCQuartis <-  glm(resultado ~ exp1 + quartil_analise, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logBCQuartis)
odds <- exp(coefficients(m_logBCQuartis))
conf <- exp(confint(m_logBCQuartis))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesBCQuartis <- predict(m_logBCQuartis, type = "response")

dados_analise1R <- dados_analise1R %>%
  dplyr::mutate(logit_modeloBCQuartis    = log(probabilitiesBCQuartis/(1-probabilitiesBCQuartis)),
                deviance_modeloBCQuartis = residuals(m_logBCQuartis, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logBCQuartis$coefficients[2:5]),3)),
                       ' (',   round(conf[2:5,1],3), ';',
                       round(conf[2:5,2],3), ')')


ve <- paste0((round(1 - exp(m_logBCQuartis$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logBCQuartis))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logBCQuartis)[2:5,2] - confint(m_logBCQuartis)[2:5,1]))
Retorno_modelo
```

```{r message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCQuartis)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}
figura_1 <-  ggplot(dados_analise1R, aes(x = semana_do_estudo,
                                         y = deviance_modeloBCQuartis,
                                         fill = quartil_analise))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise1R, aes(x = semana_do_estudo,
                                         y = logit_modeloBCQuartis,
                                         fill = quartil_analise)) +
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3
```

###### Quartis Interação

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO BRUTO: DUAS OU TRÊS VACINAS PFIZER: POR QUARTIS (interação)
###############################################

m_logBCQuartisInte <-  glm(resultado ~ factor(exp1) * quartil_analise, 
                           family = 'binomial', 
                           data = dados_analise1R)

m_results <-  summary(m_logBCQuartisInte)
odds <- exp(coefficients(m_logBCQuartisInte))
conf <- exp(confint(m_logBCQuartisInte))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBCQuartisInte, type = '3')
```

```{r message=FALSE, warning=FALSE, include=FALSE}

probabilitiesBCQuartisInt <- predict(m_logBCQuartisInte, type = "response")

dados_analise1R <- dados_analise1R %>%
  dplyr::mutate(logit_modeloBCQuartisInte    = log(probabilitiesBCQuartisInt/(1-probabilitiesBCQuartisInt)),
                deviance_modeloBCQuartisInte = residuals(m_logBCQuartisInte, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logBCQuartisInte$coefficients[2]),3)),
                       ' (',   round(conf[2,1],3), ';',
                       round(conf[2,2],3), ')')

ve <- paste0((round(1 - exp(m_logBCQuartisInte$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBCQuartisInte))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBCQuartisInte)[2,2] - confint(m_logBCQuartisInte)[2,1]))

Retorno_modelo
```

```{r message=FALSE, warning=FALSE}
lmtest::resettest(m_logBCQuartisInte)
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}
figura_1 <-  ggplot(dados_analise1R, aes(deviance_modeloBCQuartisInte, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_1 <-  ggplot(dados_analise1R, aes(logit_modeloBCQuartisInte, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3
```

#### Ajustado Categórico

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
#############################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: POR QUARTIS #
#############################################################

m_logAJQuartis <-  glm(resultado ~ exp1 + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJQuartis)
odds <- exp(coefficients(m_logAJQuartis))
conf <- exp(confint(m_logAJQuartis))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesAJQuartis <- predict(m_logAJQuartis, type = "response")
dados_analise1R <- dados_analise1R %>%
                      dplyr::mutate(logit_modeloAJQuartis    = log(probabilitiesAJQuartis/(1-probabilitiesAJQuartis)),
                                    deviance_modeloAJQuartis = residuals(m_logAJQuartis, type = "deviance"))
                    
Coeficientes <- paste0((round(exp(m_logAJQuartis$coefficients[2:11]),3)),
                        ' (',
                        round(conf[2:11,1],3),
                        ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJQuartis$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJQuartis))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJQuartis)[2:11,2] - confint(m_logAJQuartis)[2:11,1]))
Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise1R, aes(deviance_modeloAJQuartis, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_1 <-  ggplot(dados_analise1R, aes(logit_modeloAJQuartis, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

##### Com Raça

Abaixo se encontram resultados do modelo ajustado com raça (branco, preto pardo e outros).

```{r message=FALSE, warning=FALSE, include=FALSE}
#####################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: RAÇA
#####################################################

m_logAJQuartis <-  glm(resultado ~ exp1 + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + LB1_WBBO, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJQuartis)
conf <- exp(confint(m_logAJQuartis))
car::Anova(m_logAJQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJQuartis$coefficients[2:14]),3)),
                       ' (',
                       round(conf[2:14,1],3),
                       ';',
                       round(conf[2:14,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJQuartis$coefficients[2:14]),3)),
             ' (',
             round(1 - conf[2:14,1],3),
             ';',
             round(1 - conf[2:14,2],3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJQuartis))[,'Pr(>|z|)'][2:14],3))
Retorno_modelo
```

###### Bruto

Abaixo se encontram resultados do modelo ajustado com raça (branco, preto, pardo e outros).

```{r message=FALSE, warning=FALSE, include=FALSE}
#####################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: raça#
####################################################
m_logAJQuartis <-  glm(resultado ~ exp1 + LB1_WBBO, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJQuartis)
odds <- exp(coefficients(m_logAJQuartis))
conf <- exp(confint(m_logAJQuartis))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJQuartis <- predict(m_logAJQuartis, type = "response")

dados_analise1R <- dados_analise1R %>%
                      dplyr::mutate(logit_modeloAJQuartis    = log(probabilitiesAJQuartis/(1-probabilitiesAJQuartis)),
                                    deviance_modeloAJQuartis = residuals(m_logAJQuartis, type = "deviance"))
                    
Coeficientes <- paste0((round(exp(m_logAJQuartis$coefficients[2:4]),3)),
                       ' (',
                       round(conf[2:4,1],3),
                       ';',
                       round(conf[2:4,2],3),
                       ')')
ve <- paste0((round(1 - exp(m_logAJQuartis$coefficients[2:4]),3)) ,
              ' (',
              round(abs(1 - conf[2:4,1]),3),
              ';',
              round(abs(1 - conf[2:4,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJQuartis))[,'Pr(>|z|)'][2:4],3),
                              Amplitude = exp(confint(m_logAJQuartis)[2:4,2] - confint(m_logAJQuartis)[2:4,1]))
Retorno_modelo
```

Abaixo se encontram resultados do modelo ajustado com raça (todas categorias).

```{r message=FALSE, warning=FALSE, include=FALSE}
############################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: POR QUARTIS#
############################################################
m_logAJQuartis <-  glm(resultado ~ exp1 + LB1, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJQuartis)
odds <- exp(coefficients(m_logAJQuartis))
conf <- exp(confint(m_logAJQuartis))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJQuartis, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJQuartis <- predict(m_logAJQuartis, type = "response")

dados_analise1R <- dados_analise1R %>%
                      dplyr::mutate(logit_modeloAJQuartis    = log(probabilitiesAJQuartis/(1-probabilitiesAJQuartis)),
                                    deviance_modeloAJQuartis = residuals(m_logAJQuartis, type = "deviance"))
                    
Coeficientes <- paste0((round(exp(m_logAJQuartis$coefficients[2:7]),3)),
                       ' (',
                       round(conf[2:7,1],3),
                       ';',
                       round(conf[2:7,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJQuartis$coefficients[2:7]),3)) ,
              ' (',
              round(abs(1 - conf[2:7,1]),3),
              ';',
              round(abs(1 - conf[2:7,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJQuartis))[,'Pr(>|z|)'][2:7],3),
                              Amplitude = exp(confint(m_logAJQuartis)[2:7,2] - confint(m_logAJQuartis)[2:7,1]))
Retorno_modelo
```

### Subgrupos
#### Idade
##### Interação

```{r echo=FALSE, message=FALSE, warning=FALSE}
#######################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: IDADE #
#######################################################

m_logAJIdade <-  glm(resultado ~ exp1*idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJIdade)
odds <- exp(coefficients(m_logAJIdade))
conf <- exp(confint(m_logAJIdade))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIdade, type = '3')

Coeficientes <- paste0((round(exp(m_logAJIdade$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIdade$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,1]),3),
              ';',
              round(abs(1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIdade))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJIdade)[2:8,2] - confint(m_logAJIdade)[2:8,1]))
Retorno_modelo

```

##### Idade (12y a 17y)

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analise1R12 <- dados_analise1R %>% 
                      dplyr::filter(idade_cat4 == 1)
```

Há `r nrow(dados_analise1R12)` participantes com duas ou mais doses do tipo Pfizer com idade entre 12 e 17 anos. Há `r sum(dados_analise1R12$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R12$exp1 == 0)` não vacinados. São `r sum(dados_analise1R12$resultado == 1)` positivos e `r sum(dados_analise1R12$resultado == 2)` negativos. 

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: IDADE 12 A 17
######################################################################

m_logAJ1217 <-  glm(resultado ~ exp1 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R12)

m_results <-  summary(m_logAJ1217)
odds <- exp(coefficients(m_logAJ1217))
conf <- exp(confint(m_logAJ1217))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ1217, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJ1217$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJ1217$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,1]),3),
              ';',
              round(abs(1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ1217))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJ1217)[2:8,2] - confint(m_logAJ1217)[2:8,1]))
Retorno_modelo
```

##### Idade (18y a 39y)

```{r include=FALSE}
dados_analise1R1839 <- dados_analise1R %>% 
                      dplyr::filter(idade_cat4 == 2)
```

Há `r nrow(dados_analise1R1839)` participantes com duas ou mais doses do tipo Pfizer com idade entre 18 e 39 anos. Há `r sum(dados_analise1R1839$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R1839$exp1 == 0)` não vacinados. São `r sum(dados_analise1R1839$resultado == 1)` positivos e `r sum(dados_analise1R1839$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
####################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: IDADE 18 a 39 anos #
####################################################################

m_logAJ1839 <-  glm(resultado ~ exp1 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R1839)

m_results <-  summary(m_logAJ1839)
odds <- exp(coefficients(m_logAJ1839))
conf <- exp(confint(m_logAJ1839))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ1839, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJ1839$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJ1839$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,1]),3),
              ';',
              round(abs(1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ1839))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJ1839)[2:8,2] - confint(m_logAJ1839)[2:8,1]))
Retorno_modelo
```

##### Idade (40y a 64y)

```{r include=FALSE}
dados_analise1R4064 <- dados_analise1R %>% 
                      dplyr::filter(idade_cat4 == 3)
```

Há `r nrow(dados_analise1R4064)` participantes com duas ou mais doses do tipo Pfizer com idade entre 40 e 64 anos. Há `r sum(dados_analise1R4064$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R4064$exp1 == 0)` não vacinados. São `r sum(dados_analise1R4064$resultado == 1)` positivos e `r sum(dados_analise1R4064$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r message=FALSE, warning=FALSE, include=FALSE}
####################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: IDADE 18 a 39 anos #
####################################################################

m_logAJ4064 <-  glm(resultado ~ exp1 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R4064)

m_results <-  summary(m_logAJ4064)
odds <- exp(coefficients(m_logAJ4064))
conf <- exp(confint(m_logAJ4064))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ4064, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJ4064$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJ4064$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,1]),3),
              ';',
              round(abs(1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ4064))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJ4064)[2:8,2] - confint(m_logAJ4064)[2:8,1]))
Retorno_modelo
```

##### Idade (>=65y)

```{r include=FALSE}
dados_analise1R65 <- dados_analise1R %>% 
                      dplyr::filter(idade_cat4 == 4)
```

Há `r nrow(dados_analise1R65)` participantes com duas ou mais doses do tipo Pfizer com idade maior que 65 anos. Há `r sum(dados_analise1R65$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R65$exp1 == 0)` não vacinados. São `r sum(dados_analise1R65$resultado == 1)` positivos e `r sum(dados_analise1R65$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado. Não se ajusta devido ao n.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
########################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: IDADE maior igual a 65 #
########################################################################

m_logAJ65 <-  glm(resultado ~ exp1 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R65)

m_results <-  summary(m_logAJ65)
odds <- exp(coefficients(m_logAJ65))
conf <- exp(confint(m_logAJ65))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ65, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

Coeficientes <- paste0((round(exp(m_logAJ65$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJ65$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,1]),3),
              ';',
              round(abs(1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ65))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJ65)[2:8,2] - confint(m_logAJ65)[2:8,1]))
Retorno_modelo
```

#### Tempo desde a última vacina

##### Interação

```{r echo=FALSE}
#######################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO #
#######################################################

m_logAJTempo <-  glm(resultado ~ exp1*data_dif_tempoDoseM + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

#car::Anova(m_logAJTempo, type = '3')

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,1]),3),
              ';',
              round(abs(1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:8,2] - confint(m_logAJTempo)[2:8,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=7 days and <30 days)

```{r include=FALSE}
dados_analise1R730M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 30 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R730M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (>=7 days and <30 days). Há `r sum(dados_analise1R730M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R730M$exp1 == 0)` não vacinados. São `r sum(dados_analise1R730M$resultado == 1)` positivos e `r sum(dados_analise1R730M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp1 + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R730M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=30 days and <60 days)

```{r include=FALSE}
dados_analise1R73060M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose >= 30 & data_dif_tempoDose < 60 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R73060M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (>=30 days and <60 days). Há `r sum(dados_analise1R73060M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R73060M$exp1 == 0)` não vacinados. São `r sum(dados_analise1R73060M$resultado == 1)` positivos e `r sum(dados_analise1R73060M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp1 + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R73060M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=60 days and <90 days)

```{r include=FALSE}
dados_analise1R6090M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose >= 60 & data_dif_tempoDose < 90 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R6090M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (>=60 days and <90 days). Há `r sum(dados_analise1R6090M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R6090M$exp1 == 0)` não vacinados. São `r sum(dados_analise1R6090M$resultado == 1)` positivos e `r sum(dados_analise1R6090M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp1 + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R6090M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=90 days and <120 days)

```{r include=FALSE}
dados_analise1R90120M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose >= 90 & data_dif_tempoDose < 120 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R90120M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (>=90 days and <120 days). Há `r sum(dados_analise1R90120M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R90120M$exp1 == 0)` não vacinados. São `r sum(dados_analise1R90120M$resultado == 1)` positivos e `r sum(dados_analise1R90120M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp1 + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R90120M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=120 days and <150 days)

```{r include=FALSE}
dados_analise1R120150M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose >= 120 & data_dif_tempoDose < 150 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R120150M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (>=120 days and <150 days). Há `r sum(dados_analise1R120150M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R120150M$exp1 == 0)` não vacinados. São `r sum(dados_analise1R120150M$resultado == 1)` positivos e `r sum(dados_analise1R120150M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp1 + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R120150M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=150 days and <180 days)

```{r include=FALSE}
dados_analise1R150180M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose >= 150 & data_dif_tempoDose < 180 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R150180M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (>=150 days and <180 days). Há `r sum(dados_analise1R150180M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R150180M$exp1 == 0)` não vacinados. São `r sum(dados_analise1R150180M$resultado == 1)` positivos e `r sum(dados_analise1R150180M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp1 + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R150180M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=180 days)

```{r include=FALSE}
dados_analise1R180M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose >= 180 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R180M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (>=180 days). Há `r sum(dados_analise1R180M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R180M$exp1 == 0)` não vacinados. São `r sum(dados_analise1R180M$resultado == 1)` positivos e `r sum(dados_analise1R180M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp1 + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R180M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (<90)

```{r include=FALSE}
dados_analise1R90M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose < 90 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1R90M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (<90). Há `r sum(dados_analise1R90M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R90M$exp1 == 0)` não vacinados. São `r sum(dados_analise1R90M$resultado == 1)` positivos e `r sum(dados_analise1R90M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp1 + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R90M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (>=90)

```{r include=FALSE}
dados_analise1RM90M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1RM90M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (>=90). Há `r sum(dados_analise1RM90M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RM90M$exp1 == 0)` não vacinados. São `r sum(dados_analise1RM90M$resultado == 1)` positivos e `r sum(dados_analise1RM90M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ exp1 + quartil_analise + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RM90M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```

##### Tempo desde a última vacina (< 90 e >=90)

```{r include=FALSE}
dados_analise1RM90M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDose < 90 | data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose))
```

Há `r nrow(dados_analise1RM90M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (>=90). Há `r sum(dados_analise1RM90M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RM90M$exp1 == 0)` não vacinados. São `r sum(dados_analise1RM90M$resultado == 1)` positivos e `r sum(dados_analise1RM90M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ data_dif_tempoDose3M + quartil_analise + sexo + idade_cat4 + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RM90M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:11]),3)) ,
              ' (',
              round((1 - conf[2:11,2]),3),
              ';',
              round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:11,2] - confint(m_logAJTempo)[2:11,1]))
Retorno_modelo
```


##### Tempo desde a última vacina (1 a 7)

```{r include=FALSE}
dados_analise1R7M <- dados_analise1R %>% 
                      dplyr::filter(data_dif_tempoDoseM == "0M" | data_dif_tempoDoseM == "1M" | 
                                    data_dif_tempoDoseM == "2M" | data_dif_tempoDoseM == "3M" |
                                    data_dif_tempoDoseM == "4M" | data_dif_tempoDoseM == "5M" |
                                    data_dif_tempoDoseM == "6M" | data_dif_tempoDoseM == "7M")
```

Há `r nrow(dados_analise1R7M)` participantes com duas ou mais doses do tipo Pfizer com Tempo desde a última vacina (1 a 7). Há `r sum(dados_analise1R7M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1R7M$exp1 == 0)` não vacinados. São `r sum(dados_analise1R7M$resultado == 1)` positivos e `r sum(dados_analise1R7M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: TEMPO ÚLTIMA VACINA
######################################################################

m_logAJTempo <-  glm(resultado ~ data_dif_tempoDoseM + quartil_analise + sexo + idade_cat4 + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R7M)

m_results <-  summary(m_logAJTempo)
odds <- exp(coefficients(m_logAJTempo))
conf <- exp(confint(m_logAJTempo))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJTempo, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJTempo$coefficients[2:12]),3)),
                       ' (',
                       round(conf[2:12,1],3),
                       ';',
                       round(conf[2:12,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJTempo$coefficients[2:12]),3)) ,
              ' (',
              round((1 - conf[2:12,2]),3),
              ';',
              round((1 - conf[2:12,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJTempo))[,'Pr(>|z|)'][2:12],3),
                              Amplitude = exp(confint(m_logAJTempo)[2:12,2] - confint(m_logAJTempo)[2:12,1]))
Retorno_modelo
```

```{r echo=FALSE}
ResourceSelection::hoslem.test(dados_analise1R7M$resultado, fitted(m_logAJTempo))
```

#### BMI

##### Interação

```{r echo=FALSE}
#####################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: BMI #
#####################################################

m_logAJBMI <-  glm(resultado ~ exp1*cat_imc + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJBMI)
odds <- exp(coefficients(m_logAJBMI))
conf <- exp(confint(m_logAJBMI))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJBMI, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJBMI$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJBMI$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,1]),3),
#               ';',
#               round(abs(1 - conf[2:8,2]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJBMI))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJBMI)[2:8,2] - confint(m_logAJBMI)[2:8,1]))
# Retorno_modelo
```

##### BMI:underweight

```{r include=FALSE}
dados_analise1RBMI <- dados_analise1R %>% 
                                   dplyr::filter(cat_imc == "Baixo peso")
```

Há `r nrow(dados_analise1RBMI)` participantes com duas ou mais doses do tipo Pfizer com BMI:underweight. Há `r sum(dados_analise1RBMI$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RBMI$exp1 == 0)` não vacinados. São `r sum(dados_analise1RBMI$resultado == 1)` positivos e `r sum(dados_analise1RBMI$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para underweight. Não ajusta devido a exposição.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: IMC
###################################################

m_logAJIMC <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBMI)

m_results <-  summary(m_logAJIMC)
odds <- exp(coefficients(m_logAJIMC))
conf <- exp(confint(m_logAJIMC))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJIMC, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIMC$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIMC$coefficients[2:8]),3)) ,
              ' (',
              round(abs(1 - conf[2:8,2]),3),
              ';',
              round(abs(1 - conf[2:8,1]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes, 
                              P_valor = round(coef(summary(m_logAJIMC))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJIMC)[2:8,2] - confint(m_logAJIMC)[2:8,1]))
Retorno_modelo
```

##### BMI:normal weight

```{r include=FALSE}
dados_analise1RBMI <- dados_analise1R %>% 
                                   dplyr::filter(cat_imc == "Eutrófico")
```

Há `r nrow(dados_analise1RBMI)` participantes com duas ou mais doses do tipo Pfizer com BMI:normal weight. Há `r sum(dados_analise1RBMI$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RBMI$exp1 == 0)` não vacinados. São `r sum(dados_analise1RBMI$resultado == 1)` positivos e `r sum(dados_analise1RBMI$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para normal weight.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: IMC
###################################################

m_logAJIMC <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBMI)

m_results <-  summary(m_logAJIMC)
odds <- exp(coefficients(m_logAJIMC))
conf <- exp(confint(m_logAJIMC))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIMC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIMC$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIMC$coefficients[2:11]),3)) ,
              ' (',
              round((1 - conf[2:11,2]),3),
              ';',
              round((1 - conf[2:11,1]),3), ')')



Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJIMC))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIMC)[2:11,2] - confint(m_logAJIMC)[2:11,1]))
Retorno_modelo
```

##### BMI:overweight

```{r include=FALSE}
dados_analise1RBMI <- dados_analise1R %>% 
                                   dplyr::filter(cat_imc == "Sobrepeso")
```

Há `r nrow(dados_analise1RBMI)` participantes com duas ou mais doses do tipo Pfizer com BMI:overweight. Há `r sum(dados_analise1RBMI$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RBMI$exp1 == 0)` não vacinados. São `r sum(dados_analise1RBMI$resultado == 1)` positivos e `r sum(dados_analise1RBMI$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para overweight.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: IMC
###################################################

m_logAJIMC <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBMI)

m_results <-  summary(m_logAJIMC)
odds <- exp(coefficients(m_logAJIMC))
conf <- exp(confint(m_logAJIMC))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIMC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIMC$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIMC$coefficients[2:11]),3)) ,
              ' (',
              round((1 - conf[2:11,2]),3),
              ';',
              round((1 - conf[2:11,1]),3), ')')



Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJIMC))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIMC)[2:11,2] - confint(m_logAJIMC)[2:11,1]))
Retorno_modelo
```

##### BMI:obese

```{r include=FALSE}
dados_analise1RBMI <- dados_analise1R %>% 
                                   dplyr::filter(cat_imc == "Obeso")
```

Há `r nrow(dados_analise1RBMI)` participantes com duas ou mais doses do tipo Pfizer com BMI:obese Há `r sum(dados_analise1RBMI$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RBMI$exp1 == 0)` não vacinados. São `r sum(dados_analise1RBMI$resultado == 1)` positivos e `r sum(dados_analise1RBMI$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para obese.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: IMC
###################################################

m_logAJIMC <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBMI)

m_results <-  summary(m_logAJIMC)
odds <- exp(coefficients(m_logAJIMC))
conf <- exp(confint(m_logAJIMC))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIMC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIMC$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIMC$coefficients[2:10]),3)) ,
              ' (',
              round((1 - conf[2:10,2]),3),
              ';',
              round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJIMC))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJIMC)[2:10,2] - confint(m_logAJIMC)[2:10,1]))
Retorno_modelo
```

##### Doença Cardiovascular (Yes)

```{r include=FALSE}
dados_analise1RDV <- dados_analise1R %>% 
                       dplyr::filter(LB55a == 1 | LB55b == 1 |
                                     LB55c == 1 | LB55f == 1 )
```

Há `r nrow(dados_analise1RDV)` participantes com duas ou mais doses do tipo Pfizer com Doença Cardiovascular (Yes). Há `r sum(dados_analise1RDV$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RDV$exp1 == 0)` não vacinados. São `r sum(dados_analise1RDV$resultado == 1)` positivos e `r sum(dados_analise1RDV$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Doença Cardiovascular. Não se ajusta.

```{r message=FALSE, warning=FALSE, include=FALSE}
#####################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: Doença Cardiovascular
#####################################################################

m_logAJIDV <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RDV)

m_results <-  summary(m_logAJIDV)
odds <- exp(coefficients(m_logAJIDV))
conf <- exp(confint(m_logAJIDV))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIDV, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIDV$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';', round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJIDV$coefficients[2:11]),3)) ,
             ' (', 
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIDV))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIDV)[2:11,2] - confint(m_logAJIDV)[2:11,1]))
Retorno_modelo

```

##### Doença Cardiovascular (No)


```{r include=FALSE}
dados_analise1RDV <- dados_analise1R %>% 
                       dplyr::filter(LB55a == 0 & LB55b == 0 &
                                     LB55c == 0 & LB55f == 0)
```


Há `r nrow(dados_analise1RDV)` participantes com duas ou mais doses do tipo Pfizer com Doença Cardiovascular (No). Há `r sum(dados_analise1RDV$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RDV$exp1 == 0)` não vacinados. São `r sum(dados_analise1RDV$resultado == 1)` positivos e `r sum(dados_analise1RDV$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Doença Cardiovascular.

```{r message=FALSE, warning=FALSE, include=FALSE}
#####################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: Doença Cardiovascular
#####################################################################

m_logAJIDV <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RDV)

m_results <-  summary(m_logAJIDV)
odds <- exp(coefficients(m_logAJIDV))
conf <- exp(confint(m_logAJIDV))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIDV, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIDV$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';', round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJIDV$coefficients[2:11]),3)) ,
             ' (', 
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIDV))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIDV)[2:11,2] - confint(m_logAJIDV)[2:11,1]))
Retorno_modelo

```



#### Charlson

##### Interação

Abaixo se encontram resultados do modelo ajustado para Charlson.

```{r echo=TRUE, message=FALSE, warning=FALSE}
##########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: Charlson #
##########################################################

m_logAJCH<-  glm(resultado ~ exp1*LB_indice_charlson_cat + quartil_analise + idade_cat4 + sexo + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJCH)
odds <- exp(coefficients(m_logAJCH))
conf <- exp(confint(m_logAJCH))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJCH, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJCH$coefficients[2:10]),3)),
#                        ' (',
#                        round(conf[2:10,1],3),
#                        ';',
#                        round(conf[2:10,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJCH$coefficients[2:10]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:10,1]),3),
#               ';',
#               round(abs(1 - conf[2:10,2]),3), ')')
# 
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJCH))[,'Pr(>|z|)'][2:10],3),
#                               Amplitude = exp(confint(m_logAJCH)[2:10,2] - confint(m_logAJCH)[2:10,1]))
# Retorno_modelo
```


##### Charlson (>=1)

```{r include=FALSE}
dados_analise1RCH1 <- dados_analise1R %>% 
                       dplyr::filter(LB_indice_charlson_cat == 1 | LB_indice_charlson_cat   == 2)
```

Há `r nrow(dados_analise1RCH1)` participantes com duas ou mais doses do tipo Pfizer com Charlson (>=1). Há `r sum(dados_analise1RCH1$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RCH1$exp1 == 0)` não vacinados. São `r sum(dados_analise1RCH1$resultado == 1)` positivos e `r sum(dados_analise1RCH1$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Charlson (>=1).

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: Charlson (>=1)
###############################################################

m_logAJICH1 <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RCH1)

m_results <-  summary(m_logAJICH1)
odds <- exp(coefficients(m_logAJICH1))
conf <- exp(confint(m_logAJICH1))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJICH1, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJICH1$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJICH1$coefficients[2:10]),3)) ,
              ' (',
              round(abs(1 - conf[2:10,2]),3),
              ';',
              round(abs(1 - conf[2:10,1]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJICH1))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJICH1)[2:10,2] - confint(m_logAJICH1)[2:10,1]))
Retorno_modelo
```

##### Charlson (=0)

```{r include=FALSE}
dados_analise1RCH0 <- dados_analise1R %>% 
                       dplyr::filter(LB_indice_charlson_cat == 3)
```

Há `r nrow(dados_analise1RCH0)` participantes com duas ou mais doses do tipo Pfizer com Charlson (==0). Há `r sum(dados_analise1RCH0$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RCH0$exp1 == 0)` não vacinados. São `r sum(dados_analise1RCH0$resultado == 1)` positivos e `r sum(dados_analise1RCH0$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Charlson (=0).

```{r message=FALSE, warning=FALSE, include=FALSE}
###############################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: Charlson (=0)
###############################################################

m_logAJICH0 <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RCH0)

m_results <-  summary(m_logAJICH0)
odds <- exp(coefficients(m_logAJICH0))
conf <- exp(confint(m_logAJICH0))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJICH0, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJICH0$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJICH0$coefficients[2:10]),3)) ,
              ' (',
              round(abs(1 - conf[2:10,2]),3),
              ';',
              round(abs(1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJICH0))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJICH0)[2:10,2] - confint(m_logAJICH0)[2:10,1]))
Retorno_modelo
```

#### Raça

##### Interação

```{r echo=FALSE}
######################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: RAÇA #
######################################################

m_logAJRACA <-  glm(resultado ~ exp1*LB1_WBBO + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJRACA)
odds <- exp(coefficients(m_logAJRACA))
conf <- exp(confint(m_logAJRACA))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJRACA, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJRACA$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJRACA$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,1]),3),
#               ';',
#               round(abs(1 - conf[2:8,2]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJRACA))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJRACA)[2:8,2] - confint(m_logAJRACA)[2:8,1]))
# Retorno_modelo
```

##### Raça (branco)

```{r include=FALSE}
dados_analise1RBR <- dados_analise1R %>% 
                       dplyr::filter(LB1 == 1)
```

Há `r nrow(dados_analise1RBR)` participantes com duas ou mais doses do tipo Pfizer para raça igual a declarados brancos. Há `r sum(dados_analise1RBR$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RBR$exp1 == 0)` não vacinados. São `r sum(dados_analise1RBR$resultado == 1)` positivos e `r sum(dados_analise1RBR$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para raça igual a declarados brancos.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: Brancos
########################################################

m_logAJIBR <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RBR)

m_results <-  summary(m_logAJIBR)
odds <- exp(coefficients(m_logAJIBR))
conf <- exp(confint(m_logAJIBR))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIBR, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIBR$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJIBR$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIBR))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIBR)[2:11,2] - confint(m_logAJIBR)[2:11,1]))
Retorno_modelo
```

##### Raça (preto)

```{r include=FALSE}
dados_analise1RPR <- dados_analise1R %>% 
                       dplyr::filter(LB1 == 2)
```

Há `r nrow(dados_analise1RPR)` participantes com duas ou mais doses do tipo Pfizer para raça igual a declarados pretos. Há `r sum(dados_analise1RPR$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RPR$exp1 == 0)` não vacinados. São `r sum(dados_analise1RPR$resultado == 1)` positivos e `r sum(dados_analise1RPR$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para raça igual a declarados pretos.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: Pretos
########################################################

m_logAJIPR <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RPR)

m_results <-  summary(m_logAJIPR)
odds <- exp(coefficients(m_logAJIPR))
conf <- exp(confint(m_logAJIPR))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJIPR, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

Coeficientes <- paste0((round(exp(m_logAJIPR$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJIPR$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJIPR))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJIPR)[2:11,2] - confint(m_logAJIPR)[2:11,1]))
Retorno_modelo
```

##### Raça (Pardo)

```{r include=FALSE}
dados_analise1RPAR <- dados_analise1R %>% 
                       dplyr::filter(LB1 == 3)
```

Há `r nrow(dados_analise1RPAR)` participantes com duas ou mais doses do tipo Pfizer para raça igual a declarados pardos. Há `r sum(dados_analise1RPAR$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1RPAR$exp1 == 0)` não vacinados. São `r sum(dados_analise1RPAR$resultado == 1)` positivos e `r sum(dados_analise1RPAR$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para raça igual a declarados pardos.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: PARDOS
########################################################

m_logAJPAR <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1RPAR)

m_results <-  summary(m_logAJPAR)
odds <- exp(coefficients(m_logAJPAR))
conf <- exp(confint(m_logAJPAR))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJPAR, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJPAR$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJPAR$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJPAR))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJPAR)[2:11,2] - confint(m_logAJPAR)[2:11,1]))
Retorno_modelo
```

##### Raça (outros)

```{r include=FALSE}
dados_analise1ROT <- dados_analise1R %>% 
                       dplyr::filter(LB1 == 4 | LB1 == 5 | LB1 == 6 )
```

Há `r nrow(dados_analise1ROT)` participantes com duas ou mais doses do tipo Pfizer para raça igual a declarados outros. Há `r sum(dados_analise1ROT$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1ROT$exp1 == 0)` não vacinados. São `r sum(dados_analise1ROT$resultado == 1)` positivos e `r sum(dados_analise1ROT$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para raça igual a declarados outros.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: OUTROS
########################################################

m_logAJOT <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1ROT)

m_results <-  summary(m_logAJOT)
odds <- exp(coefficients(m_logAJOT))
conf <- exp(confint(m_logAJOT))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJOT, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJOT$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOT$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOT))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJOT)[2:11,2] - confint(m_logAJOT)[2:11,1]))
Retorno_modelo
```


#### Sexo
##### Interação

```{r echo=FALSE}
######################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: SEXO #
######################################################

m_logAJSEXO <-  glm(resultado ~ exp1*sexo + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJSEXO)
odds <- exp(coefficients(m_logAJSEXO))
conf <- exp(confint(m_logAJSEXO))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJSEXO, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJSEXO$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJSEXO$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,1]),3),
#               ';',
#               round(abs(1 - conf[2:8,2]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJSEXO))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJSEXO)[2:8,2] - confint(m_logAJSEXO)[2:8,1]))
# Retorno_modelo
```

##### Sexo:Female

```{r include=FALSE}
dados_analise1F <- dados_analise1R %>% 
                    dplyr::mutate(sexo = base::as.character(sexo)) %>% 
                    dplyr::filter(sexo == "F")
```

Há `r nrow(dados_analise1F)` participantes com duas ou mais doses do tipo Pfizer para Sexo:Female. Há `r sum(dados_analise1F$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1F$exp1 == 0)` não vacinados. São `r sum(dados_analise1F$resultado == 1)` positivos e `r sum(dados_analise1F$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Sexo:Female.

```{r echo=TRUE, message=FALSE, warning=FALSE}
########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: FEMALE
########################################################

m_logAJF <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1F)

m_results <-  summary(m_logAJF)
odds <- exp(coefficients(m_logAJF))
conf <- exp(confint(m_logAJF))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJF, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJF$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJF$coefficients[2:10]),3)),
             ' (',
             round((1 - conf[2:10,2]),3),
             ';',
             round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJF))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJF)[2:10,2] - confint(m_logAJF)[2:10,1]))
Retorno_modelo
```

##### Sexo:male

```{r include=FALSE}
dados_analise1M <- dados_analise1R %>% 
                    dplyr::mutate(sexo = base::as.character(sexo)) %>% 
                    dplyr::filter(sexo == "M")
```

Há `r nrow(dados_analise1M)` participantes com duas ou mais doses do tipo Pfizer para Sexo:male. Há `r sum(dados_analise1M$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1M$exp1 == 0)` não vacinados. São `r sum(dados_analise1M$resultado == 1)` positivos e `r sum(dados_analise1M$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Sexo:male.

```{r message=FALSE, warning=FALSE, include=FALSE}
########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: FEMALE
########################################################

m_logAJM <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1M)

m_results <-  summary(m_logAJM)
odds <- exp(coefficients(m_logAJM))
conf <- exp(confint(m_logAJM))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJM, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJM$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJM$coefficients[2:10]),3)),
             ' (',
             round((1 - conf[2:10,2]),3),
             ';',
             round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJM))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJM)[2:10,2] - confint(m_logAJM)[2:10,1]))
Retorno_modelo
```

#### Smoking
##### Interação

```{r echo=FALSE}
#########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: SMOKING #
#########################################################

m_logAJSMOK <-  glm(resultado ~ exp1*LB5 + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJSMOK)
odds <- exp(coefficients(m_logAJSMOK))
conf <- exp(confint(m_logAJSMOK))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJSMOK, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJSMOK$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJSMOK$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,1]),3),
#               ';',
#               round(abs(1 - conf[2:8,2]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJSMOK))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJSMOK)[2:8,2] - confint(m_logAJSMOK)[2:8,1]))
# Retorno_modelo
```

##### Current smoking (yes)

```{r include=FALSE}
dados_analise1CS <- dados_analise1R %>% 
                    dplyr::filter(LB5 == 1)
```

Há `r nrow(dados_analise1CS)` participantes com duas ou mais doses do tipo Pfizer para Current smoking (yes). Há `r sum(dados_analise1CS$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1CS$exp1 == 0)` não vacinados. São `r sum(dados_analise1CS$resultado == 1)` positivos e `r sum(dados_analise1CS$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Current smoking (yes).

```{r message=FALSE, warning=FALSE, include=FALSE}
##############################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: CURRENT SMOKE#
##############################################################

m_logAJCS <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0, 
                       family = 'binomial', 
                       data = dados_analise1CS)

m_results <-  summary(m_logAJCS)
odds <- exp(coefficients(m_logAJCS))
conf <- exp(confint(m_logAJCS))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJCS, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJCS$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCS$coefficients[2:10]),3)),
             ' (',
             round((1 - conf[2:10,2]),3),
             ';',
             round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCS))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJCS)[2:10,2] - confint(m_logAJCS)[2:10,1]))
Retorno_modelo
```

##### Current smoking (no)

```{r include=FALSE}
dados_analise1CS <- dados_analise1R %>% 
                    dplyr::filter(LB5 == 0)
```

Há `r nrow(dados_analise1CS)` participantes com duas ou mais doses do tipo Pfizer para Current smoking (yes). Há `r sum(dados_analise1CS$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1CS$exp1 == 0)` não vacinados. São `r sum(dados_analise1CS$resultado == 1)` positivos e `r sum(dados_analise1CS$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Current smoking (yes).

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: CURRENT SMOKE#
##############################################################

m_logAJCS <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0, 
                       family = 'binomial', 
                       data = dados_analise1CS)

m_results <-  summary(m_logAJCS)
odds <- exp(coefficients(m_logAJCS))
conf <- exp(confint(m_logAJCS))
amplitude <-  conf[2,2] - conf[2,1]

#car::Anova(m_logAJCS, type = '3')
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJCS$coefficients[2:10]),3)),
                       ' (',
                       round(conf[2:10,1],3),
                       ';',
                       round(conf[2:10,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCS$coefficients[2:10]),3)),
             ' (',
             round((1 - conf[2:10,2]),3),
             ';',
             round((1 - conf[2:10,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCS))[,'Pr(>|z|)'][2:10],3),
                              Amplitude = exp(confint(m_logAJCS)[2:10,2] - confint(m_logAJCS)[2:10,1]))
Retorno_modelo
```
#### Diabetes
##### Interação

```{r echo=FALSE}
##########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: DIABETES #
##########################################################

m_logAJDIAB <-  glm(resultado ~ exp1*mellitus + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJDIAB)
odds <- exp(coefficients(m_logAJDIAB))
conf <- exp(confint(m_logAJDIAB))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logAJDIAB, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJDIAB$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJDIAB$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,1]),3),
#               ';',
#               round(abs(1 - conf[2:8,2]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJDIAB))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJDIAB)[2:8,2] - confint(m_logAJDIAB)[2:8,1]))
# Retorno_modelo
```

##### Diabetes (yes)

```{r include=FALSE}
dados_analise1D <- dados_analise1R %>% 
                    dplyr::filter(mellitus == 1)
```

Há `r nrow(dados_analise1D)` participantes com duas ou mais doses do tipo Pfizer para Diabetes (yes). Há `r sum(dados_analise1D$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1D$exp1 == 0)` não vacinados. São `r sum(dados_analise1D$resultado == 1)` positivos e `r sum(dados_analise1D$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Diabetes (yes). Não converge.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
##############################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: DIABETES     #
##############################################################

m_logAJD <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1D)

m_results <-  summary(m_logAJD)
odds <- exp(coefficients(m_logAJD))
conf <- exp(confint(m_logAJD))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJD, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
Coeficientes <- paste0((round(exp(m_logAJD$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJD$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJD))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJD)[2:11,2] - confint(m_logAJD)[2:11,1]))
Retorno_modelo
```

##### Diabetes (no)

```{r include=FALSE}
dados_analise1D <- dados_analise1R %>% 
                    dplyr::filter(mellitus == 0)
```

Há `r nrow(dados_analise1D)` participantes com duas ou mais doses do tipo Pfizer para Diabetes (yes). Há `r sum(dados_analise1D$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1D$exp1 == 0)` não vacinados. São `r sum(dados_analise1D$resultado == 1)` positivos e `r sum(dados_analise1D$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Diabetes (yes). Não converge.

```{r echo=TRUE, message=FALSE, warning=FALSE}
##############################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: DIABETES     #
##############################################################

m_logAJD <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1D)

m_results <-  summary(m_logAJD)
odds <- exp(coefficients(m_logAJD))
conf <- exp(confint(m_logAJD))
amplitude <-  conf[2,2] - conf[2,1]

#car::Anova(m_logAJD, type = '3')
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJD$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJD$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJD))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJD)[2:11,2] - confint(m_logAJD)[2:11,1]))
Retorno_modelo
```

#### Pulmonar
##### Interação

```{r echo=FALSE}
##########################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: PULMONAR #
##########################################################

m_logAJPDC <-  glm(resultado ~ exp1*LB55g + idade_cat4 + quartil_analise + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1R)

m_results <-  summary(m_logAJPDC)
odds <- exp(coefficients(m_logAJPDC))
conf <- exp(confint(m_logAJPDC))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJPDC, type = '3')

# Coeficientes <- paste0((round(exp(m_logAJPDC$coefficients[2:8]),3)),
#                        ' (',
#                        round(conf[2:8,1],3),
#                        ';',
#                        round(conf[2:8,2],3), ')')
# 
# ve <- paste0((round(1 - exp(m_logAJPDC$coefficients[2:8]),3)) ,
#               ' (',
#               round(abs(1 - conf[2:8,1]),3),
#               ';',
#               round(abs(1 - conf[2:8,2]),3), ')')
# 
# Retorno_modelo <-  data.frame(Coeficientes,
#                               ve,
#                               P_valor = round(coef(summary(m_logAJPDC))[,'Pr(>|z|)'][2:8],3),
#                               Amplitude = exp(confint(m_logAJPDC)[2:8,2] - confint(m_logAJPDC)[2:8,1]))
# Retorno_modelo
```

##### Chronic pulmonary disease (yes)

```{r include=FALSE}
dados_analise1CPD <- dados_analise1R %>% 
                    dplyr::filter(LB55g == 1)
```

Há `r nrow(dados_analise1CPD)` participantes com duas ou mais doses do tipo Pfizer para Chronic pulmonary disease (yes). Há `r sum(dados_analise1CPD$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1CPD$exp1 == 0)` não vacinados. São `r sum(dados_analise1CPD$resultado == 1)` positivos e `r sum(dados_analise1CPD$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Chronic pulmonary disease (yes). Não converge devido ao n.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
###########################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: Chronic pulmonary disease #
###########################################################################

m_logAJCPD <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1CPD)

m_results <-  summary(m_logAJCPD)
odds <- exp(coefficients(m_logAJCPD))
conf <- exp(confint(m_logAJCPD))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJCPD, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
Coeficientes <- paste0((round(exp(m_logAJCPD$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCPD$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCPD))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJCPD)[2:11,2] - confint(m_logAJCPD)[2:11,1]))
Retorno_modelo
```

##### Chronic pulmonary disease (no)

```{r include=FALSE}
dados_analise1CPD <- dados_analise1R %>% 
                    dplyr::filter(LB55g == 0)
```

Há `r nrow(dados_analise1CPD)` participantes com duas ou mais doses do tipo Pfizer para Chronic pulmonary disease (yes). Há `r sum(dados_analise1CPD$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1CPD$exp1 == 0)` não vacinados. São `r sum(dados_analise1CPD$resultado == 1)` positivos e `r sum(dados_analise1CPD$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado para Chronic pulmonary disease (yes). Não converge devido ao n.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###########################################################################
# MODELO AJUSTADO: DUAS OU TRÊS VACINAS PFIZER: Chronic pulmonary disease #
###########################################################################

m_logAJCPD <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_analise1CPD)

m_results <-  summary(m_logAJCPD)
odds <- exp(coefficients(m_logAJCPD))
conf <- exp(confint(m_logAJCPD))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJCPD, type = '3')
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJCPD$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCPD$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCPD))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJCPD)[2:11,2] - confint(m_logAJCPD)[2:11,1]))
Retorno_modelo
```

### Sensibilidade

#### Delta phase (up to 30-11-21)

```{r include=FALSE}
fase_delta <- dados_analise1R %>% 
                 dplyr::mutate(delta = dplyr::case_when(resultado == 1 & LB_creation_date <= "2021-11-30" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date <= "2021-11-30")
```

Há `r nrow(fase_delta)` participantes nesta fase. Há `r sum(fase_delta$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_delta$exp1 == 0)` não vacinados. São `r sum(fase_delta$resultado == 1)` positivos e `r sum(fase_delta$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado para Delta phase (up to 30-11-21). Não se ajusta.

```{r eval=FALSE, include=FALSE}
###############################
# MODELO AJUSTADO: FASE DELTA #
###############################

m_logAJDF <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_delta)

m_results <-  summary(m_logAJDF)
odds <- exp(coefficients(m_logAJDF))
conf <- exp(confint(m_logAJDF))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJDF, type = '3')

Coeficientes <- paste0((round(exp(m_logAJDF$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJDF$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJDF))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJDF)[2:11,2] - confint(m_logAJDF)[2:11,1]))
Retorno_modelo
```


#### Delta Genotipagem

```{r include=FALSE}
fase_deltaG <- dados_analise1R %>% 
                 dplyr::mutate(delta = dplyr::case_when(variante == "Delta" ~ "Delta",
                                                        is.na(variante)     ~ NA_character_,
                                                        TRUE ~ "Outras"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) 
```

Há `r nrow(fase_deltaG)` participantes nesta fase. Há `r sum(fase_deltaG$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_deltaG$exp1 == 0)` não vacinados. São `r sum(fase_deltaG$resultado == 1)` positivos e `r sum(fase_deltaG$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. Não se ajusta.



#### Omicron phase (from 01-12-21)

```{r include=FALSE}
fase_omicron <- dados_analise1R %>% 
                 dplyr::mutate(omicron = dplyr::case_when(resultado == 1 & LB_creation_date >= "2021-12-01" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date >= "2021-12-01")
```

Há `r nrow(fase_omicron)` participantes nesta fase. Há `r sum(fase_omicron$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicron$exp1 == 0)` não vacinados. São `r sum(fase_omicron$resultado == 1)` positivos e `r sum(fase_omicron$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado para Omicron phase (from 01-12-21). 

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFO <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicron)

m_results <-  summary(m_logAJFO)
odds <- exp(coefficients(m_logAJFO))
conf <- exp(confint(m_logAJFO))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFO, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFO$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFO$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFO))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJFO)[2:11,2] - confint(m_logAJFO)[2:11,1]))
Retorno_modelo
```


#### Omicron Genotipagem

```{r include=FALSE}

fase_omicronG <- dados_analise1R %>% 
                 dplyr::mutate(omicron = dplyr::case_when(variante == "Omicron Ba.1" |
                                                        variante == "Omicron Ba.2" |
                                                        variante == "Omicron Ba.4" ~ "Omicron",
                                                        is.na(variante)     ~ NA_character_,
                                                        TRUE ~ "Outras"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) 
```

Há `r nrow(fase_omicronG)` participantes nesta fase. Há `r sum(fase_omicronG$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronG$exp1 == 0)` não vacinados. São `r sum(fase_omicronG$resultado == 1)` positivos e `r sum(fase_omicronG$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado.


#### Omicron Ba1 phase (01-12-21 to 31-03-22)

```{r include=FALSE}
fase_omicronBa1 <- dados_analise1R %>% 
                 dplyr::mutate(omicron_Ba1 = dplyr::case_when(resultado == 1 & LB_creation_date >= "2021-12-01" & LB_creation_date <= "2022-03-31" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date >= "2021-12-01" & LB_creation_date <= "2022-03-31")
```

Há `r nrow(fase_omicronBa1)` participantes nesta fase. Há `r sum(fase_omicronBa1$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronBa1$exp1 == 0)` não vacinados. São `r sum(fase_omicronBa1$resultado == 1)` positivos e `r sum(fase_omicronBa1$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado para Omicron Ba1 phase (01-12-21 to 30-03-22). 

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFOBA1 <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronBa1)

m_results <-  summary(m_logAJFOBA1)
odds <- exp(coefficients(m_logAJFOBA1))
conf <- exp(confint(m_logAJFOBA1))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFOBA1, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFOBA1$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFOBA1$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFOBA1))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJFOBA1)[2:11,2] - confint(m_logAJFOBA1)[2:11,1]))
Retorno_modelo
```


#### Omicron Ba1 Genotipagem

```{r include=FALSE}

fase_omicronba1G <- dados_analise1R %>% 
                 dplyr::mutate(omicronba1 = dplyr::case_when(variante == "Omicron Ba.1"  ~ "Omicron Ba1",
                                                        is.na(variante)     ~ NA_character_,
                                                        TRUE ~ "Outras"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) 
```

Há `r nrow(fase_omicronba1G)` participantes nesta fase. Há `r sum(fase_omicronba1G$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronba1G$exp1 == 0)` não vacinados. São `r sum(fase_omicronba1G$resultado == 1)` positivos e `r sum(fase_omicronba1G$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado.


#### Omicron Ba2 phase (from 01-04-22)

```{r include=FALSE}
fase_omicronBa2 <- dados_analise1R %>% 
                 dplyr::mutate(omicron_Ba2 = dplyr::case_when(resultado == 1 & LB_creation_date >= "2022-04-01" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date >= "2022-04-01")
```

Há `r nrow(fase_omicronBa2)` participantes com duas ou mais doses do tipo Pfizer. Há `r sum(fase_omicronBa2$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronBa2$exp1 == 0)` não vacinados. São `r sum(fase_omicronBa2$resultado == 1)` positivos e `r sum(fase_omicronBa2$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado para Omicron Ba1 phase (01-12-21 to 30-03-22). 

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFOBA2 <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronBa2)

m_results <-  summary(m_logAJFOBA2)
odds <- exp(coefficients(m_logAJFOBA2))
conf <- exp(confint(m_logAJFOBA2))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFOBA2, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFOBA2$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFOBA2$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFOBA2))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJFOBA2)[2:8,2] - confint(m_logAJFOBA2)[2:8,1]))
Retorno_modelo
```


#### Omicron Ba2 Genotipagem

```{r include=FALSE}

fase_omicronba2G <- dados_analise1R %>% 
                 dplyr::mutate(omicronba2 = dplyr::case_when(variante == "Omicron Ba.2"  ~ "Omicron Ba2",
                                                        is.na(variante)     ~ NA_character_,
                                                        TRUE ~ "Outras"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) 
```

Há `r nrow(fase_omicronba2G)` participantes nesta fase. Há `r sum(fase_omicronba2G$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(fase_omicronba2G$exp1 == 0)` não vacinados. São `r sum(fase_omicronba2G$resultado == 1)` positivos e `r sum(fase_omicronba2G$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado.


#### First patient enrollment only

```{r message=FALSE, warning=FALSE}

dados_FPE  <-  dados_analise1R %>%
                  dplyr::arrange(nome_completo, data_de_nascimento, LB_creation_date) %>%
                  dplyr::group_by(nome_completo, data_de_nascimento) %>%
                  dplyr::mutate(ordem = row_number()) %>%
                    ungroup() %>% 
                  dplyr::filter(ordem == 1)
```

Há `r nrow(dados_FPE)` participantes com primeira entrada. Há `r sum(dados_FPE$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_FPE$exp1 == 0)` não vacinados. São `r sum(dados_FPE$resultado == 1)` positivos e `r sum(dados_FPE$resultado == 2)` negativos.


```{r echo=FALSE, message=FALSE, warning=FALSE}
###################################
# MODELO AJUSTADO: FIRST PATIENT  #
###################################

m_logAJFPE <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_FPE)

m_results <-  summary(m_logAJFPE)
odds <- exp(coefficients(m_logAJFPE))
conf <- exp(confint(m_logAJFPE))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFPE, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFPE$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFPE$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFPE))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJFPE)[2:8,2] - confint(m_logAJFPE)[2:8,1]))
Retorno_modelo
```

#### Control group with <5 days of symptoms


```{r echo=FALSE}
############################## 
#       Caso 5 dias          #
##############################

dados_CG <- dados_analise1R %>% 
             dplyr::filter(data_dif_tempoDoseControle == 0) 

```

Há `r nrow(dados_CG)` participantes. Há `r sum(dados_CG$exp1 == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_CG$exp1 == 0)` não vacinados. São `r sum(dados_CG$resultado == 1)` positivos e `r sum(dados_CG$resultado == 2)` negativos.

```{r echo=FALSE}
m_logAJCG <-  glm(resultado ~ exp1 + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_CG)

m_results <-  summary(m_logAJCG)
odds <- exp(coefficients(m_logAJCG))
conf <- exp(confint(m_logAJCG))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJCG, type = '3')

Coeficientes <- paste0((round(exp(m_logAJCG$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJCG$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJCG))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJCG)[2:8,2] - confint(m_logAJCG)[2:8,1]))
Retorno_modelo
```



### Booster
#### Booster Completo
##### AstraZeneca (Referência)

```{r message=FALSE, warning=FALSE, include=FALSE}
############
# COMPLETO #
############
dados_BSB <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(2,0,1,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))
```



###### Sem Tempo

Há `r nrow(dados_BSB)` participantes. São `r sum(dados_BSB$resultado == 1)` positivos e `r sum(dados_BSB$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJB <-  glm(resultado ~ exp_booster + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_BSB)


m_results <-  summary(m_logAJB)
odds <- exp(coefficients(m_logAJB))
conf <- exp(confint(m_logAJB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJB)[2:8,2] - confint(m_logAJB)[2:8,1]))
Retorno_modelo
```

###### Com Tempo

Há `r nrow(dados_BSB)` participantes. São `r sum(dados_BSB$resultado == 1)` positivos e `r sum(dados_BSB$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJB <-  glm(resultado ~ exp_booster + data_dif_tempoDose3M + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_BSB)


m_results <-  summary(m_logAJB)
odds <- exp(coefficients(m_logAJB))
conf <- exp(confint(m_logAJB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJB)[2:8,2] - confint(m_logAJB)[2:8,1]))
Retorno_modelo
```


###### >= 7 e < 90

```{r message=FALSE, warning=FALSE, include=FALSE}
############
# COMPLETO #
############
dados_BT <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 90 | is.na(data_dif_tempoDose)) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(2,0,1,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_BT)` participantes. São `r sum(dados_BT$resultado == 1)` positivos e `r sum(dados_BT$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJB <-  glm(resultado ~ exp_booster + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_BT)


m_results <-  summary(m_logAJB)
odds <- exp(coefficients(m_logAJB))
conf <- exp(confint(m_logAJB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJB)[2:8,2] - confint(m_logAJB)[2:8,1]))
Retorno_modelo
```

###### >= 90

```{r message=FALSE, warning=FALSE, include=FALSE}
############
# COMPLETO #
############
dados_BT <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose)) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(2,0,1,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_BT)` participantes. São `r sum(dados_BT$resultado == 1)` positivos e `r sum(dados_BT$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJB <-  glm(resultado ~ exp_booster + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_BT)


m_results <-  summary(m_logAJB)
odds <- exp(coefficients(m_logAJB))
conf <- exp(confint(m_logAJB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJB)[2:8,2] - confint(m_logAJB)[2:8,1]))
Retorno_modelo
```

##### Janssen (Referência)

```{r message=FALSE, warning=FALSE, include=FALSE}
############
# COMPLETO #
############
dados_BSB <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(4,0,1,2,3)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))
```



###### Sem Tempo

Há `r nrow(dados_BSB)` participantes. São `r sum(dados_BSB$resultado == 1)` positivos e `r sum(dados_BSB$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJB <-  glm(resultado ~ exp_booster + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_BSB)


m_results <-  summary(m_logAJB)
odds <- exp(coefficients(m_logAJB))
conf <- exp(confint(m_logAJB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJB)[2:8,2] - confint(m_logAJB)[2:8,1]))
Retorno_modelo
```

###### Com Tempo

Há `r nrow(dados_BSB)` participantes. São `r sum(dados_BSB$resultado == 1)` positivos e `r sum(dados_BSB$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJB <-  glm(resultado ~ exp_booster + data_dif_tempoDose3M + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_BSB)


m_results <-  summary(m_logAJB)
odds <- exp(coefficients(m_logAJB))
conf <- exp(confint(m_logAJB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJB)[2:8,2] - confint(m_logAJB)[2:8,1]))
Retorno_modelo
```


###### >= 7 e < 90

```{r message=FALSE, warning=FALSE, include=FALSE}
############
# COMPLETO #
############
dados_BT <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 90 | is.na(data_dif_tempoDose)) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(4,0,1,2,3)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_BT)` participantes. São `r sum(dados_BT$resultado == 1)` positivos e `r sum(dados_BT$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJB <-  glm(resultado ~ exp_booster + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_BT)


m_results <-  summary(m_logAJB)
odds <- exp(coefficients(m_logAJB))
conf <- exp(confint(m_logAJB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJB)[2:8,2] - confint(m_logAJB)[2:8,1]))
Retorno_modelo
```

###### >= 90

```{r message=FALSE, warning=FALSE, include=FALSE}
############
# COMPLETO #
############
dados_BT <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose)) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(4,0,1,2,3)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_BT)` participantes. São `r sum(dados_BT$resultado == 1)` positivos e `r sum(dados_BT$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJB <-  glm(resultado ~ exp_booster + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_BT)


m_results <-  summary(m_logAJB)
odds <- exp(coefficients(m_logAJB))
conf <- exp(confint(m_logAJB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJB)[2:8,2] - confint(m_logAJB)[2:8,1]))
Retorno_modelo
```





##### CoronaVac (Referência)

Não converge devido ao n.


#### Booster vs Sem Booster (Referência)
##### Sem tempo

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_BSB <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(0,1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_BSB)` participantes neste regime. Há `r sum(dados_BSB$exp_booster == 0)` completo sem booster, `r sum(dados_BSB$exp_booster == 1)` com booster Pfizer, `r sum(dados_BSB$exp_booster == 2)` com booster AstraZeneca, `r sum(dados_BSB$exp_booster == 3)` com booster CoronaVac e `r sum(dados_BSB$exp_booster == 4)` com booster Janssen. São `r sum(dados_BSB$resultado == 1)` positivos e `r sum(dados_BSB$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJBSB <-  glm(resultado ~ exp_booster + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_BSB)


m_results <-  summary(m_logAJBSB)
odds <- exp(coefficients(m_logAJBSB))
conf <- exp(confint(m_logAJBSB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJBSB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJBSB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJBSB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBSB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJBSB)[2:8,2] - confint(m_logAJBSB)[2:8,1]))
Retorno_modelo
```

##### Com tempo

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_BSB <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(0,1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_BSB)` participantes neste regime. Há `r sum(dados_BSB$exp_booster == 0)` completo sem booster, `r sum(dados_BSB$exp_booster == 1)` com booster Pfizer, `r sum(dados_BSB$exp_booster == 2)` com booster AstraZeneca, `r sum(dados_BSB$exp_booster == 3)` com booster CoronaVac e `r sum(dados_BSB$exp_booster == 4)` com booster Janssen. São `r sum(dados_BSB$resultado == 1)` positivos e `r sum(dados_BSB$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJBSB <-  glm(resultado ~ exp_booster + data_dif_tempoDose3M + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_BSB)


m_results <-  summary(m_logAJBSB)
odds <- exp(coefficients(m_logAJBSB))
conf <- exp(confint(m_logAJBSB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJBSB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJBSB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJBSB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBSB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJBSB)[2:8,2] - confint(m_logAJBSB)[2:8,1]))
Retorno_modelo
```

#### Booster Pfizer (Referência)

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_BSB <- dados_completo %>% 
                 dplyr::filter(exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_BSB)` participantes neste regime. Há `r sum(dados_BSB$exp_booster == 1)` com booster Pfizer, `r sum(dados_BSB$exp_booster == 2)` com booster AstraZeneca, `r sum(dados_BSB$exp_booster == 3)` com booster CoronaVac e `r sum(dados_BSB$exp_booster == 4)` com booster Janssen. São `r sum(dados_BSB$resultado == 1)` positivos e `r sum(dados_BSB$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJBSB <-  glm(resultado ~ exp_booster + data_dif_tempoDose3M + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_BSB)


m_results <-  summary(m_logAJBSB)
odds <- exp(coefficients(m_logAJBSB))
conf <- exp(confint(m_logAJBSB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJBSB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJBSB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJBSB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBSB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJBSB)[2:8,2] - confint(m_logAJBSB)[2:8,1]))
Retorno_modelo
```


#### >= 7 e <90

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_BSB <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 90) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(0,1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJBSB <-  glm(resultado ~ exp_booster + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_BSB)


m_results <-  summary(m_logAJBSB)
odds <- exp(coefficients(m_logAJBSB))
conf <- exp(confint(m_logAJBSB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJBSB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJBSB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJBSB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBSB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJBSB)[2:8,2] - confint(m_logAJBSB)[2:8,1]))
Retorno_modelo
```


#### >=90

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_BSB <- dados_completo %>% 
                 dplyr::filter(exp_booster == 0 | exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 90) %>% 
                 dplyr::mutate(exp_booster = base::factor(exp_booster, levels = c(0,1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJBSB <-  glm(resultado ~ exp_booster + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_BSB)


m_results <-  summary(m_logAJBSB)
odds <- exp(coefficients(m_logAJBSB))
conf <- exp(confint(m_logAJBSB))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJBSB, type = '3')

Coeficientes <- paste0((round(exp(m_logAJBSB$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJBSB$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBSB))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJBSB)[2:8,2] - confint(m_logAJBSB)[2:8,1]))
Retorno_modelo
```



#### Booster Pfizer vs. complete without booster

```{r include=FALSE}
dados_analiseBFC <- dados_completo %>% 
                       dplyr::filter(exp_booster == 0 | exp_booster == 1) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(expBFC = dplyr::case_when(exp_booster == 0  ~ "Sem Booster",
                                                               exp_booster == 1  ~ "Booster Pfizer",
                                                               TRUE ~ NA_character_),
                                     expBFC = base::factor(expBFC, levels = c("Sem Booster", "Booster Pfizer")))
                                     
```

Há `r nrow(dados_analiseBFC)` participantes com booster Pfizer e sem booster. Há `r sum(dados_analiseBFC$expBFC == "Booster Pfizer")` participantes com Pfizer (duas ou três doses) e `r sum(dados_analiseBFC$expBFC == "Sem Booster")` sem booster. São `r sum(dados_analiseBFC$resultado == 1)` positivos e `r sum(dados_analiseBFC$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

##### Sem Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFC <-  glm(resultado ~ expBFC + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analiseBFC)
conf <- exp(confint(m_logAJBFC))
car::Anova(m_logAJBFC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFC$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBFC$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')
Retorno_modelo <-  data.frame(Coeficientes, ve,
                              P_valor = round(coef(summary(m_logAJBFC))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```

##### Com Tempo 

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFC <-  glm(resultado ~ expBFC + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + data_dif_tempoDose3M, 
                       family = 'binomial', 
                       data = dados_analiseBFC)
conf <- exp(confint(m_logAJBFC))
car::Anova(m_logAJBFC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFC$coefficients[2:13]),3)) , ' (',   round(conf[2:13,1],3), ';', round(conf[2:13,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBFC$coefficients[2:13]),3)) , ' (',  round(abs(1 - conf[2:13,1]),3), ';', round(abs(1 - conf[2:13,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBFC))[,'Pr(>|z|)'][2:13],3))
Retorno_modelo
```

#### Booster AstraZeneca vs. complete without booster

```{r include=FALSE}
dados_analiseBAC <- dados_completo %>% 
                       dplyr::filter(exp_booster == 0 | exp_booster == 2) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(expBAC = dplyr::case_when(exp_booster == 0  ~ "Sem Booster",
                                                               exp_booster == 2  ~ "Booster AstraZeneca",
                                                               TRUE ~ NA_character_),
                                     expBAC = base::factor(expBAC, levels = c("Sem Booster", "Booster AstraZeneca")))
                                     
```

Há `r nrow(dados_analiseBAC)` participantes com Booster AstraZeneca ou complete without booster. Há `r sum(dados_analiseBAC$expBAC == "Booster AstraZeneca")` participantes com Booster AstraZeneca e `r sum(dados_analiseBAC$expBAC == "Sem Booster")` complete without booster. São `r sum(dados_analiseBAC$resultado == 1)` positivos e `r sum(dados_analiseBAC$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

##### Sem Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBAC <-  glm(resultado ~ expBAC + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analiseBAC)
conf <- exp(confint(m_logAJBAC))
car::Anova(m_logAJBAC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBAC$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBAC$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')
Retorno_modelo <-  data.frame(Coeficientes, ve,
                              P_valor = round(coef(summary(m_logAJBAC))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```

##### Com Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBAC <-  glm(resultado ~ expBAC + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + data_dif_tempoDose3M, 
                       family = 'binomial', 
                       data = dados_analiseBAC)
conf <- exp(confint(m_logAJBAC))
car::Anova(m_logAJBAC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBAC$coefficients[2:13]),3)) , ' (',   round(conf[2:13,1],3), ';', round(conf[2:13,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBAC$coefficients[2:13]),3)) , ' (',  round(abs(1 - conf[2:13,1]),3), ';', round(abs(1 - conf[2:13,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBAC))[,'Pr(>|z|)'][2:13],3))
Retorno_modelo
```

#### Booster CoronaVac vs. complete without booster 

```{r include=FALSE}
dados_analiseBCC <- dados_completo %>% 
                       dplyr::filter(exp_booster == 0 | exp_booster == 3) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(expBCC = dplyr::case_when(exp_booster == 0  ~ "Sem Booster",
                                                               exp_booster == 3  ~ "Booster CoronaVac",
                                                               TRUE ~ NA_character_),
                                     expBCC = base::factor(expBCC, levels = c("Sem Booster", "Booster CoronaVac")))
                                     
```

Há `r nrow(dados_analiseBCC)` participantes com booster CoronaVac e sem booster. Há `r sum(dados_analiseBCC$expBCC == "Booster CoronaVac")` participantes com booster CoronaVac e `r sum(dados_analiseBCC$expBCC == "Sem Booster")` complete without booster. São `r sum(dados_analiseBCC$resultado == 1)` positivos e `r sum(dados_analiseBCC$resultado == 2)` negativos.

O modelo não se ajusta.

##### Sem Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBCC <-  glm(resultado ~ expBCC + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analiseBCC)
conf <- exp(confint(m_logAJBCC))
car::Anova(m_logAJBCC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBCC$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBCC$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')
Retorno_modelo <-  data.frame(Coeficientes, ve,
                              P_valor = round(coef(summary(m_logAJBCC))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```

##### Com Tempo

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBCC <-  glm(resultado ~ expBCC + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + data_dif_tempoDose3M, 
                       family = 'binomial', 
                       data = dados_analiseBCC)
conf <- exp(confint(m_logAJBCC))
car::Anova(m_logAJBCC, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBCC$coefficients[2:13]),3)) , ' (',   round(conf[2:13,1],3), ';', round(conf[2:13,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBCC$coefficients[2:13]),3)) , ' (',  round(abs(1 - conf[2:13,1]),3), ';', round(abs(1 - conf[2:13,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBCC))[,'Pr(>|z|)'][2:13],3))
Retorno_modelo
```

#### Booster Janssen vs. complete without booster

```{r include=FALSE}
dados_analiseBJC <- dados_completo %>% 
                       dplyr::filter(exp_booster == 0 | exp_booster == 4) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(expBJC = dplyr::case_when(exp_booster == 0  ~ "Sem Booster",
                                                               exp_booster == 4  ~ "Booster Janssen",
                                                               TRUE ~ NA_character_),
                                     expBJC = base::factor(expBJC, levels = c("Sem Booster", "Booster Janssen")))
                                     
```

Há `r nrow(dados_analiseBJC)` participantes com Booster Janssen ou complete without booster. Há `r sum(dados_analiseBJC$expBJC == "Booster Janssen")` participantes com Booster Janssen e `r sum(dados_analiseBJC$expBJC == "Sem Booster")` complete without booster. São `r sum(dados_analiseBJC$resultado == 1)` positivos e `r sum(dados_analiseBJC$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

##### Sem Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBJC <-  glm(resultado ~ expBJC + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analiseBJC)
conf <- exp(confint(m_logAJBJC))
car::Anova(m_logAJBJC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBJC$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBJC$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')
Retorno_modelo <-  data.frame(Coeficientes, ve,
                              P_valor = round(coef(summary(m_logAJBJC))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```

##### Com Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBJC <-  glm(resultado ~ expBJC + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + data_dif_tempoDose3M, 
                       family = 'binomial', 
                       data = dados_analiseBJC)
conf <- exp(confint(m_logAJBJC))
car::Anova(m_logAJBJC, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBJC$coefficients[2:13]),3)) , ' (',   round(conf[2:13,1],3), ';', round(conf[2:13,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBJC$coefficients[2:13]),3)) , ' (',  round(abs(1 - conf[2:13,1]),3), ';', round(abs(1 - conf[2:13,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBJC))[,'Pr(>|z|)'][2:13],3))
Retorno_modelo
```

#### Booster Pfizer vs. non-Pfizer booster

```{r include=FALSE}
dados_analiseBFnF <- dados_completo %>% 
                       dplyr::filter(exp_booster == 1 | exp_booster == 2 | exp_booster == 3 | exp_booster == 4) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(expBFnF = dplyr::case_when(exp_booster == 1  ~ "Booster Pfizer",
                                                                exp_booster == 2 | exp_booster == 3 | exp_booster == 4 ~ "non-Pfizer booster",
                                                               TRUE ~ NA_character_),
                                     expBFnF = base::factor(expBFnF, levels = c("non-Pfizer booster", "Booster Pfizer")))
```

Há `r nrow(dados_analiseBFnF)` participantes com Booster Pfizer ou. non-Pfizer booster. Há `r sum(dados_analiseBFnF$expBFnF == "Booster Pfizer")` participantes com Booster Pfizer e `r sum(dados_analiseBFnF$expBFnF == "non-Pfizer booster")` non-Pfizer booster. São `r sum(dados_analiseBFnF$resultado == 1)` positivos e `r sum(dados_analiseBFnF$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

##### Sem Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFnF <-  glm(resultado ~ expBFnF + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analiseBFnF)
conf <- exp(confint(m_logAJBFnF))
car::Anova(m_logAJBFnF, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFnF$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBFnF$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')
Retorno_modelo <-  data.frame(Coeficientes, ve,
                              P_valor = round(coef(summary(m_logAJBFnF))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```

##### Com Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFnF <-  glm(resultado ~ expBFnF + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + data_dif_tempoDose3M, 
                       family = 'binomial', 
                       data = dados_analiseBFnF)
conf <- exp(confint(m_logAJBFnF))
car::Anova(m_logAJBFnF, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFnF$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBFnF$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBFnF))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```


#### Booster Pfizer vs. Booster AstraZeneca

```{r include=FALSE}
dados_analiseBFA <- dados_completo %>% 
                       dplyr::filter(exp_booster == 1 | exp_booster == 2) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(expBFA = dplyr::case_when(exp_booster == 1  ~ "Booster Pfizer",
                                                               exp_booster == 2  ~ "Booster AstraZeneca",
                                                               TRUE ~ NA_character_),
                                     expBFA = base::factor(expBFA, levels = c("Booster AstraZeneca","Booster Pfizer")))
```

Há `r nrow(dados_analiseBFA)` participantes com Booster Pfizer ou. Booster AstraZeneca. Há `r sum(dados_analiseBFA$expBFA == "Booster Pfizer")` participantes com Booster Pfizer e `r sum(dados_analiseBFA$expBFA == "Booster AstraZeneca")` Booster AstraZeneca. São `r sum(dados_analiseBFA$resultado == 1)` positivos e `r sum(dados_analiseBFA$resultado == 2)` negativos.

Abaixo se encontram resultados do modelo ajustado.

##### Sem Tempo

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFA <-  glm(resultado ~ expBFA + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analiseBFA)
conf <- exp(confint(m_logAJBFA))
#car::Anova(m_logAJBFA, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFA$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJBFA$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')
Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBFA))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```

##### Com Tempo

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFA <-  glm(resultado ~ expBFA + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + data_dif_tempoDose3M, 
                       family = 'binomial', 
                       data = dados_analiseBFA)
conf <- exp(confint(m_logAJBFA))
#car::Anova(m_logAJBFA, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFA$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')
ve <- paste0((round(1 - exp(m_logAJBFA$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,1]),3),
             ';',
             round((1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBFA))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```


#### Booster Pfizer vs. Booster CoronaVac

```{r include=FALSE}
dados_analiseBFCV <- dados_completo %>% 
                       dplyr::filter(exp_booster == 1 | exp_booster == 3) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(expBFCV = dplyr::case_when(exp_booster == 1  ~ "Booster Pfizer",
                                                                exp_booster == 3  ~ "Booster CoronaVac",
                                                               TRUE ~ NA_character_),
                                     expBFCV = base::factor(expBFCV, levels = c("Booster CoronaVac", "Booster Pfizer")))
```

Há `r nrow(dados_analiseBFCV)` participantes com Booster Pfizer ou. Booster CoronaVac Há `r sum(dados_analiseBFCV$expBFCV == "Booster Pfizer")` participantes com Booster Pfizer e `r sum(dados_analiseBFCV$expBFCV == "Booster CoronaVac")` Booster CoronaVac São `r sum(dados_analiseBFCV$resultado == 1)` positivos e `r sum(dados_analiseBFCV$resultado == 2)` negativos.

O modelo não se ajusta devido ao n.

Abaixo se encontram resultados do modelo ajustado.

##### Sem Tempo

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFCV <-  glm(resultado ~ expBFCV + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analiseBFCV)
conf <- exp(confint(m_logAJBFCV))
car::Anova(m_logAJBFCV, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFCV$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBFCV$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')
Retorno_modelo <-  data.frame(Coeficientes, ve,
                              P_valor = round(coef(summary(m_logAJBFCV))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```

##### Com Tempo

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFCV <-  glm(resultado ~ expBFCV + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + data_dif_tempoDose3M, 
                       family = 'binomial', 
                       data = dados_analiseBFCV)
conf <- exp(confint(m_logAJBFCV))
car::Anova(m_logAJBFCV, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFCV$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBFCV$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBFCV))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```


#### Booster Pfizer vs. Booster Janssen

```{r include=FALSE}
dados_analiseBFJ <- dados_completo %>% 
                       dplyr::filter(exp_booster == 1 | exp_booster == 4) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1"))) %>% 
                       dplyr::mutate(expBFJ = dplyr::case_when(exp_booster == 1  ~ "Booster Pfizer",
                                                               exp_booster == 4  ~ "Booster Janssen",
                                                               TRUE ~ NA_character_),
                                     expBFJ = base::factor(expBFJ, levels = c("Booster Janssen", "Booster Pfizer")))
```

Há `r nrow(dados_analiseBFJ)` participantes com Booster Pfizer ou. Booster Janssen Há `r sum(dados_analiseBFJ$expBFJ == "Booster Pfizer")` participantes com Booster Pfizer e `r sum(dados_analiseBFJ$expBFJ == "Booster Janssen")` Booster Janssen São `r sum(dados_analiseBFJ$resultado == 1)` positivos e `r sum(dados_analiseBFJ$resultado == 2)` negativos.

O modelo não se ajusta devido ao n.

Abaixo se encontram resultados do modelo ajustado.

##### Sem Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFJ <-  glm(resultado ~ expBFJ + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                       family = 'binomial', 
                       data = dados_analiseBFJ)
conf <- exp(confint(m_logAJBFJ))
car::Anova(m_logAJBFJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFJ$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBFJ$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')
Retorno_modelo <-  data.frame(Coeficientes, ve,
                              P_valor = round(coef(summary(m_logAJBFJ))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```

##### Com Tempo

```{r message=FALSE, warning=FALSE, include=FALSE}
###################
# MODELO AJUSTADO #
###################
m_logAJBFJ <-  glm(resultado ~ expBFJ + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5 + data_dif_tempoDose3M, 
                       family = 'binomial', 
                       data = dados_analiseBFJ)
conf <- exp(confint(m_logAJBFJ))
car::Anova(m_logAJBFJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes <- paste0((round(exp(m_logAJBFJ$coefficients[2:11]),3)) , ' (',   round(conf[2:11,1],3), ';', round(conf[2:11,2],3), ')')
ve <- paste0((round(1 - exp(m_logAJBFJ$coefficients[2:11]),3)) , ' (',  round(abs(1 - conf[2:11,1]),3), ';', round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJBFJ))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```


# Pfizer: 1° Dose

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analise1Pfizer <-   dados_completo  %>%
                            dplyr::filter((LB41 == 1 & LB86 == 3 & data_dif_1dose >= 14) |
                                            LB40 == 0) %>%
                            dplyr::filter(!(is.na(resultado))) %>%
                            dplyr::filter(!(resultado == "3")) %>% 
                            dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                          pfizer1 = dplyr::case_when(LB41 == 1 & LB86 == 3 & data_dif_1dose >= 14 ~ "1",
                                                                     is.na(LB41) | is.na(LB86) | is.na(data_dif_1dose) ~ NA_character_,
                                                                     TRUE ~ "0"),
                                          exp1P   = dplyr::case_when((LB41 == 1 & LB86 == 3 & data_dif_1dose >= 14) ~ "1",
                                                                     LB40 == 0 ~ "0",
                                                                     TRUE ~ NA_character_),
                                          exp1P   = base::factor(exp1P, levels = c("0", "1"))) 
```

Há `r nrow(dados_analise1Pfizer)` participantes com duas ou mais doses do tipo Pfizer para Chronic pulmonary disease (yes). Há `r sum(dados_analise1Pfizer$exp1P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1Pfizer$exp1P == 0)` não vacinados. São `r sum(dados_analise1Pfizer$resultado == 1)` positivos e `r sum(dados_analise1Pfizer$resultado == 2)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis"}
###################
#    1° PFIZER    #
###################
#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")
doses_1Pfizer <- summary_table(dplyr::group_by(dados_analise1Pfizer, exp1P),
                                 summaries = our_summary1)
doses_1Pfizer
```

## Modelo

Abaixo se encontra gráfico demostrando ao longo do tempo a taxa de positividade e 1° dose de vacinação do tipo Pfizer.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#########################
#  TAXA DE POSITIVIDADE #
#########################

dados_analise1Pfizer %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                semana_7dias_1pfizer = sum(pfizer1 == "1", na.rm = T),
                taxa_positivos       = positivos_semana / total_semana * 100,
                taxa_1pfizer         = semana_7dias_1pfizer / total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(semana_7dias_1pfizer), x = as.numeric(semana_do_estudo), color = '1° Pfizer')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()

```

### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
######################################
# MODELO BRUTO: Pfizer - 1 dose only #
######################################
m_logBC_1P <-  glm(resultado ~  exp1P, 
                   family = 'binomial', 
                   data = dados_analise1Pfizer)

m_results <-  summary(m_logBC_1P)
odds <- exp(coefficients(m_logBC_1P))
conf <- exp(confint(m_logBC_1P))
amplitude <-  conf[2,2] - conf[2,1]
car::Anova(m_logBC_1P, type = '3')
```

```{r message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_1P$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC_1P$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_1P))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_1P)[2,2] - confint(m_logBC_1P)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_1P, type = "deviance")
probabilitiesBC_1P = predict(m_logBC_1P, type = "response")

dados_analise1Pfizer <-  dados_analise1Pfizer %>%
                           dplyr::mutate(logit_modeloBC_1P = base::log(probabilitiesBC_1P/(1-probabilitiesBC_1P)),
                                         deviance_modeloBC_1P = res.devBC) 

figura_1 <-  ggplot(dados_analise1Pfizer, aes(semana_do_estudo, y = deviance_modeloBC_1P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise1Pfizer, aes(semana_do_estudo, y = probabilitiesBC_1P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

### Ajustado 

Os quartis ajustados para a vacina tipo 1° Dose Pfizer segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analise1Pfizer$quartil_analise)

```

```{r message=FALSE, warning=FALSE, include=FALSE}
#########################################
# MODELO AJUSTADO: Pfizer - 1 dose only #
#########################################

m_logAJ <-  glm(resultado ~ exp1P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                family = 'binomial', 
                data = dados_analise1Pfizer)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ, type = '3')
```

Abaixo se encontram resultados do modelo ajustado.

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise1Pfizer <- dados_analise1Pfizer %>%
                          dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                                        deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))
Retorno_modelo
```

#### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise1Pfizer, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_analise1Pfizer, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

# Pfizer: 1° e 2° Dose

```{r message=FALSE, warning=FALSE}

dados_analise12Pfizer <-   dados_completo  %>%
                            dplyr::filter(LB41 == 2 & LB86 == 3 & EL66 == 3 & data_dif_2dose >= 7 | LB40 == 0) %>%
                            dplyr::filter(!(is.na(resultado))) %>%
                            dplyr::filter(!(resultado == "3")) %>% 
                            dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                          pfizer12  = dplyr::case_when(LB41 == 2 & LB86 == 3 & EL66 == 3 & data_dif_2dose >= 7 ~ "1",
                                                                       is.na(LB41) | is.na(LB86) | is.na(data_dif_1dose) ~ NA_character_,
                                                                       TRUE ~ "0"),
                                          exp12P    = dplyr::case_when((LB41 == 2 & LB86 == 3 & EL66 == 3 & data_dif_2dose >= 7) ~ "1",
                                                                       LB40 == 0 ~ "0",
                                                                       TRUE ~ NA_character_),
                                          exp12P    = base::factor(exp12P, levels = c("0", "1"))) 
```

Há `r nrow(dados_analise12Pfizer)` participantes com duas ou mais doses do tipo Pfizer para Pfizer: 1° e 2° Dose. Há `r sum(dados_analise12Pfizer$exp12P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise12Pfizer$exp12P == 0)` não vacinados. São `r sum(dados_analise12Pfizer$resultado == 1)` positivos e `r sum(dados_analise12Pfizer$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r message=FALSE, warning=FALSE, results = "asis"}

###################
# 1° e 2°  PFIZER #
###################

#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")


doses_12Pfizer <- summary_table(dplyr::group_by(dados_analise12Pfizer, exp12P),
                                 summaries = our_summary1)
doses_12Pfizer
```

## Modelo

Abaixo se encontra gráfico demostrando ao longo do tempo a taxa de positividade e 1° dose  e 2° dose de vacinação do tipo Pfizer.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#########################
# TAXA DE POSITIVIDADE  #
#########################

dados_analise12Pfizer %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                semana_7dias_12pfizer = sum(pfizer12 == "1", na.rm = T),
                taxa_positivos       = positivos_semana / total_semana * 100,
                taxa_12pfizer         = semana_7dias_12pfizer / total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(semana_7dias_12pfizer), x = as.numeric(semana_do_estudo), color = '1° e 2° dose Pfizer')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()

```

### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
################################
# MODELO BRUTO: 1° e 2° PFIZER
################################

m_logBC_12P <-  glm(resultado ~  exp12P, 
                   family = 'binomial', 
                   data = dados_analise12Pfizer)

m_results <-  summary(m_logBC_12P)
odds <- exp(coefficients(m_logBC_12P))
conf <- exp(confint(m_logBC_12P))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logBC_12P, type = '3')
```

```{r message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_12P$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC_12P$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_12P))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_12P)[2,2] - confint(m_logBC_12P)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_12P, type = "deviance")
probabilitiesBC_12P = predict(m_logBC_12P, type = "response")

dados_analise12Pfizer <-  dados_analise12Pfizer %>%
                           dplyr::mutate(logit_modeloBC_12P = base::log(probabilitiesBC_12P/(1-probabilitiesBC_12P)),
                                         deviance_modeloBC_1P = res.devBC) 

figura_1 <-  ggplot(dados_analise12Pfizer, aes(semana_do_estudo, y = logit_modeloBC_12P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise12Pfizer, aes(semana_do_estudo, y = probabilitiesBC_12P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

### Ajustado 

Os quartis ajustados para a vacina tipo 1° E 2° Dose Pfizer segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analise12Pfizer$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: UMA PFIZER
###################################################

m_logAJ <-  glm(resultado ~ exp12P + idade_cat4 + sexo + LB_indice_charlson_cat2  + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analise12Pfizer)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise12Pfizer <- dados_analise12Pfizer %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')


ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))

Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise12Pfizer, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_analise12Pfizer, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

# Pfizer: Apenas 2° Dose

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_analise2Pfizer <-   dados_completo  %>%
                            dplyr::filter((LB41 == 2 & EL66 == 3 & data_dif_2dose >= 7) |  
                                           LB40 == 0) %>%
                            dplyr::filter(!(is.na(resultado))) %>%
                            dplyr::filter(!(resultado == "3")) %>% 
                            dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                          pfizer2   = dplyr::case_when((LB41 == 2 & EL66 == 3 & data_dif_2dose >= 7) ~ "1",
                                                                        is.na(LB41) | is.na(EL66) | is.na(data_dif_2dose) ~ NA_character_,
                                                                        TRUE ~ "0"),
                                          exp2P = dplyr::case_when((LB41 == 2 & EL66 == 3 & data_dif_2dose >= 7) ~ "1",
                                                                     LB40 == 0 ~ "0",
                                                                     TRUE ~ NA_character_),
                                          exp2P = base::factor(exp2P, levels = c("0", "1"))) 
```

Há `r nrow(dados_analise2Pfizer)` participantes com duas ou mais doses do tipo Pfizer para Pfizer: 1° e 2° Dose. Há `r sum(dados_analise2Pfizer$exp2P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise2Pfizer$exp2P == 0)` não vacinados. São `r sum(dados_analise2Pfizer$resultado == 1)` positivos e `r sum(dados_analise2Pfizer$resultado == 2)` negativos.

```{r message=FALSE, warning=FALSE, results = "asis"}
#########################
# APENAS 2° DOSE PFIZER #
########################

#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")


doses_2Pfizer <- summary_table(dplyr::group_by(dados_analise2Pfizer, exp2P),
                                 summaries = our_summary1)
doses_2Pfizer
```

## Modelo

Abaixo se encontra gráfico demostrando ao longo do tempo a taxa de positividade e apenas 2° dose de vacinação do tipo Pfizer.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#########################
# TAXA DE POSITIVIDADE  #
#########################

dados_analise2Pfizer %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                semana_7dias_2pfizer = sum(pfizer2 == "1", na.rm = T),
                taxa_positivos       = positivos_semana / total_semana * 100,
                taxa_2pfizer         = semana_7dias_2pfizer / total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(semana_7dias_2pfizer), x = as.numeric(semana_do_estudo), color = 'Apenas 2° dose Pfizer')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()

```

### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
################################
# MODELO BRUTO: Apenas 2° PFIZER
################################

m_logBC_2P <- glm(resultado ~  exp2P, 
                     family = 'binomial', 
                     data = dados_analise2Pfizer)

m_results <-  summary(m_logBC_2P)
m_results

odds <- exp(coefficients(m_logBC_2P))
odds
conf <- exp(confint(m_logBC_2P))
conf
amplitude <-  conf[2,2] - conf[2,1]
amplitude

car::Anova(m_logBC_2P, type = '3')

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_2P$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

Retorno_modelo <-  data.frame(Coeficientes, 
                              P_valor = round(coef(summary(m_logBC_2P))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_2P)[2,2] - confint(m_logBC_2P)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_2P, type = "deviance")
probabilitiesBC_2P = predict(m_logBC_2P, type = "response")

dados_analise2Pfizer <-  dados_analise2Pfizer %>%
                           dplyr::mutate(logit_modeloBC_2P = base::log(probabilitiesBC_2P/(1-probabilitiesBC_2P)),
                                         deviance_modeloBC_2P = res.devBC) 

figura_1 <-  ggplot(dados_analise2Pfizer, aes(semana_do_estudo, y = deviance_modeloBC_2P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise2Pfizer, aes(semana_do_estudo, y = probabilitiesBC_2P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

### Ajustado 

Os quartis ajustados para a vacina tipo apenas 2° dose Pfizer segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analise2Pfizer$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
################################################
# MODELO AJUSTADO: APENAS SEGUNDA DOSES PFIZER #
################################################
m_logAJ <-  glm(resultado ~ exp2P + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analise2Pfizer)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise2Pfizer <- dados_analise2Pfizer %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))
Retorno_modelo
```


#### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise2Pfizer, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_analise2Pfizer, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```





# Pfizer: 1°, 2° e 3° Dose

```{r message=FALSE, warning=FALSE}

dados_analise123Pfizer <-   dados_completo  %>%
                            dplyr::filter((LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3 & data_dif_3dose >= 7) | LB40 == 0) %>%
                            dplyr::filter(!(is.na(resultado))) %>%
                            dplyr::filter(!(resultado == "3")) %>% 
                            dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                          pfizer123  = dplyr::case_when(LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3 & data_dif_3dose >= 7 ~ "1",
                                                                        is.na(LB41) | is.na(LB86) | is.na(data_dif_3dose) ~ NA_character_,
                                                                        TRUE ~ "0"),
                                          exp123P = dplyr::case_when((LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3 & data_dif_3dose >= 7) ~ "1",
                                                                     LB40 == 0 ~ "0",
                                                                     TRUE ~ NA_character_),
                                          exp123P = base::factor(exp123P, levels = c("0", "1"))) 
```

Há `r nrow(dados_analise123Pfizer)` participantes com duas ou mais doses do tipo Pfizer para Pfizer: 1° e 2° Dose. Há `r sum(dados_analise123Pfizer$exp123P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise123Pfizer$exp123P == 0)` não vacinados. São `r sum(dados_analise123Pfizer$resultado == 1)` positivos e `r sum(dados_analise123Pfizer$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r message=FALSE, warning=FALSE, results = "asis"}
######################
# 1°, 2° E 3° PFIZER #
######################
#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")

doses_123Pfizer <- summary_table(dplyr::group_by(dados_analise123Pfizer, exp123P),
                                 summaries = our_summary1)
doses_123Pfizer
```

## Modelo

Abaixo se encontra gráfico demostrando ao longo do tempo a taxa de positividade e 1°, 2° E 3° dose de vacinação do tipo Pfizer.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#########################
# TAXA DE POSITIVIDADE  #
#########################

dados_analise123Pfizer %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                semana_7dias_123pfizer = sum(pfizer123 == "1", na.rm = T),
                taxa_positivos       = positivos_semana / total_semana * 100,
                taxa_123pfizer         = semana_7dias_123pfizer / total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(semana_7dias_123pfizer), x = as.numeric(semana_do_estudo), color = '1°, 2° e 3° dose Pfizer')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()

```

### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
################################
# MODELO BRUTO: 1° e 2° PFIZER
################################

m_logBC_123P <- glm(resultado ~  exp123P, 
                     family = 'binomial', 
                     data = dados_analise123Pfizer)

m_results <-  summary(m_logBC_123P)
odds <- exp(coefficients(m_logBC_123P))
conf <- exp(confint(m_logBC_123P))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logBC_123P, type = '3')
```

```{r message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_123P$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC_123P$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_123P))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_123P)[2,2] - confint(m_logBC_123P)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_123P, type = "deviance")
probabilitiesBC_123P = predict(m_logBC_123P, type = "response")

dados_analise123Pfizer <-  dados_analise123Pfizer %>%
                           dplyr::mutate(logit_modeloBC_123P = base::log(probabilitiesBC_123P/(1-probabilitiesBC_123P)),
                                         deviance_modeloBC_123P = res.devBC) 

figura_1 <-  ggplot(dados_analise123Pfizer, aes(semana_do_estudo, y = deviance_modeloBC_123P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise123Pfizer, aes(semana_do_estudo, y = probabilitiesBC_123P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

### Ajustado 

Os quartis ajustados para a vacina tipo 1°, 2° e 3° dose Pfizer segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analise123Pfizer$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: TRÊS DOSES PFIZER
###################################################

m_logAJ <-  glm(resultado ~ exp123P + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analise123Pfizer)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise123Pfizer <- dados_analise123Pfizer %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(1 - conf[2:11,1],3),
              ';',
              round(1 - conf[2:11,2],3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))
Retorno_modelo
```


##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise123Pfizer, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_analise123Pfizer, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```


### Pfizer 1, 2 e 3 vs Nada

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_P123N <- dados_completo %>% 
                 dplyr::filter(exp_sec == 0 | exp_sec == 1 | exp_sec == 2 | exp_sec == 3) %>% 
                 dplyr::mutate(exp_sec = base::factor(exp_sec, levels = c(0,1,2,3)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_P123N)` participantes neste regime. Há `r sum(dados_P123N$exp_sec == 0)` participantes com nenhuma dose,  `r sum(dados_P123N$exp_sec == 1)` com uma dose, `r sum(dados_P123N$exp_sec == 2)` com duas doses e `r sum(dados_P123N$exp_sec == 3)` com três doses. São `r sum(dados_P123N$resultado == 1)` positivos e `r sum(dados_P123N$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJP123N <-  glm(resultado ~ exp_sec + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_P123N)


m_results <-  summary(m_logAJP123N)
odds <- exp(coefficients(m_logAJP123N))
conf <- exp(confint(m_logAJP123N))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJP123N, type = '3')

Coeficientes <- paste0((round(exp(m_logAJP123N$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJP123N$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJP123N))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJP123N)[2:8,2] - confint(m_logAJP123N)[2:8,1]))
Retorno_modelo
```



#### <90

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_P123N <- dados_completo %>% 
                 dplyr::filter(exp_sec == 0 | exp_sec == 1 | exp_sec == 2 | exp_sec == 3) %>% 
                 dplyr::filter(data_dif_tempoDose < 90 | is.na(data_dif_tempoDose)) %>% 
                 dplyr::mutate(exp_sec = base::factor(exp_sec, levels = c(0,1,2,3)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_P123N)` participantes neste regime. Há `r sum(dados_P123N$exp_sec == 0)` participantes com nenhuma dose,  `r sum(dados_P123N$exp_sec == 1)` com uma dose, `r sum(dados_P123N$exp_sec == 2)` com duas doses e `r sum(dados_P123N$exp_sec == 3)` com três doses. São `r sum(dados_P123N$resultado == 1)` positivos e `r sum(dados_P123N$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 


```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJP123N <-  glm(resultado ~ exp_sec + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_P123N)


m_results <-  summary(m_logAJP123N)
odds <- exp(coefficients(m_logAJP123N))
conf <- exp(confint(m_logAJP123N))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJP123N, type = '3')

Coeficientes <- paste0((round(exp(m_logAJP123N$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJP123N$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJP123N))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJP123N)[2:8,2] - confint(m_logAJP123N)[2:8,1]))
Retorno_modelo
```

#### >= 90

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_P123N <- dados_completo %>% 
                 dplyr::filter(exp_sec == 0 | exp_sec == 1 | exp_sec == 2 | exp_sec == 3) %>% 
                 dplyr::filter(data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose)) %>% 
                 dplyr::mutate(exp_sec = base::factor(exp_sec, levels = c(0,1,2,3)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_P123N)` participantes neste regime. Há `r sum(dados_P123N$exp_sec == 0)` participantes com nenhuma dose,  `r sum(dados_P123N$exp_sec == 1)` com uma dose, `r sum(dados_P123N$exp_sec == 2)` com duas doses e `r sum(dados_P123N$exp_sec == 3)` com três doses. São `r sum(dados_P123N$resultado == 1)` positivos e `r sum(dados_P123N$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 


```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJP123N <-  glm(resultado ~ exp_sec + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_P123N)


m_results <-  summary(m_logAJP123N)
odds <- exp(coefficients(m_logAJP123N))
conf <- exp(confint(m_logAJP123N))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJP123N, type = '3')

Coeficientes <- paste0((round(exp(m_logAJP123N$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJP123N$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJP123N))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJP123N)[2:8,2] - confint(m_logAJP123N)[2:8,1]))
Retorno_modelo
```

# Pfizer: 1° ou 2° ou 3° Dose
## Modelo

```{r message=FALSE, warning=FALSE}

dados_analise1O2O3Pfizer <-   dados_completo  %>%
                            dplyr::filter((LB41 == 1 & LB86 == 3 & data_dif_1dose >= 14) |
                                          (LB41 == 2 & LB86 == 3 & EL66 == 3) |
                                          (LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3) | LB40 == 0) %>%
                            dplyr::filter(!(is.na(resultado))) %>%
                            dplyr::filter(!(resultado == "3")) %>% 
                            dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                          pfizer123  = dplyr::case_when(LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3 & data_dif_3dose >= 7 ~ "1",
                                                                        is.na(LB41) | is.na(LB86) | is.na(data_dif_3dose) ~ NA_character_,
                                                                        TRUE ~ "0"),
                                          exp1o2o3P = dplyr::case_when((LB41 == 1 & LB86 == 3 & data_dif_1dose >= 14) |
                                                                       (LB41 == 2 & LB86 == 3 & EL66 == 3) |
                                                                       (LB41 == 3 & LB86 == 3 & EL66 == 3 & LB46 == 3) ~ "1",
                                                                       LB40 == 0 ~ "0",
                                                                       TRUE ~ NA_character_),
                                          exp1o2o3P = base::factor(exp1o2o3P, levels = c("0", "1"))) 
```

Há `r nrow(dados_analise1O2O3Pfizer)` participantes com duas ou mais doses do tipo Pfizer para Pfizer: 1° e 2° Dose. Há `r sum(dados_analise1O2O3Pfizer$exp1o2o3P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise1O2O3Pfizer$exp1o2o3P == 0)` não vacinados. São `r sum(dados_analise1O2O3Pfizer$resultado == 1)` positivos e `r sum(dados_analise1O2O3Pfizer$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r message=FALSE, warning=FALSE, results = "asis"}
######################
# 1°, 2° OU 3° PFIZER #
######################
#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")
doses_123Pfizer <- summary_table(dplyr::group_by(dados_analise1O2O3Pfizer, exp1o2o3P),
                                 summaries = our_summary1)
doses_123Pfizer
```

### Ajustado 

Os quartis ajustados para a vacina tipo 1°, 2° e 3° dose Pfizer segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analise1O2O3Pfizer$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: TRÊS DOSES PFIZER
###################################################

m_logAJ <-  glm(resultado ~ exp1o2o3P + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analise1O2O3Pfizer)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise1O2O3Pfizer <- dados_analise1O2O3Pfizer %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))
Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise1O2O3Pfizer, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_analise1O2O3Pfizer, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

### Pfizer 1, 2 ou 3 vs Nada

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_P12E3N <- dados_completo %>% 
                 dplyr::filter(exp_sec_123d == 0 | exp_sec_123d == 1 ) %>% 
                 dplyr::mutate(exp_sec_123d = base::factor(exp_sec_123d, levels = c(0,1)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_P12E3N)` participantes neste regime. Há `r sum(dados_P12E3N$exp_sec_123d == 0)` participantes com nenhuma dose,  `r sum(dados_P12E3N$exp_sec_123d == 1)` com uma dose, duas ou três doses. São `r sum(dados_P12E3N$resultado == 1)` positivos e `r sum(dados_P12E3N$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJP12E3N <-  glm(resultado ~ exp_sec_123d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_P12E3N)


m_results <-  summary(m_logAJP12E3N)
odds <- exp(coefficients(m_logAJP12E3N))
conf <- exp(confint(m_logAJP12E3N))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJP12E3N, type = '3')

Coeficientes <- paste0((round(exp(m_logAJP12E3N$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJP12E3N$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJP12E3N))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJP12E3N)[2:8,2] - confint(m_logAJP12E3N)[2:8,1]))
Retorno_modelo
```


#### <90

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_P12E3N <- dados_completo %>% 
                 dplyr::filter(exp_sec_123d == 0 | exp_sec_123d == 1 ) %>% 
                 dplyr::filter(data_dif_tempoDose < 90 | is.na(data_dif_tempoDose)) %>%
                 dplyr::mutate(exp_sec_123d = base::factor(exp_sec_123d, levels = c(0,1)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_P12E3N)` participantes neste regime. Há `r sum(dados_P12E3N$exp_sec_123d == 0)` participantes com nenhuma dose,  `r sum(dados_P12E3N$exp_sec_123d == 1)` com uma dose, duas ou três doses. São `r sum(dados_P12E3N$resultado == 1)` positivos e `r sum(dados_P12E3N$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJP12E3N <-  glm(resultado ~ exp_sec_123d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_P12E3N)


m_results <-  summary(m_logAJP12E3N)
odds <- exp(coefficients(m_logAJP12E3N))
conf <- exp(confint(m_logAJP12E3N))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJP12E3N, type = '3')

Coeficientes <- paste0((round(exp(m_logAJP12E3N$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJP12E3N$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJP12E3N))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJP12E3N)[2:8,2] - confint(m_logAJP12E3N)[2:8,1]))
Retorno_modelo
```


#### >= 90

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_P12E3N <- dados_completo %>% 
                 dplyr::filter(exp_sec_123d == 0 | exp_sec_123d == 1 ) %>% 
                 dplyr::filter(data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose)) %>%
                 dplyr::mutate(exp_sec_123d = base::factor(exp_sec_123d, levels = c(0,1)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_P12E3N)` participantes neste regime. Há `r sum(dados_P12E3N$exp_sec_123d == 0)` participantes com nenhuma dose,  `r sum(dados_P12E3N$exp_sec_123d == 1)` com uma dose, duas ou três doses. São `r sum(dados_P12E3N$resultado == 1)` positivos e `r sum(dados_P12E3N$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJP12E3N <-  glm(resultado ~ exp_sec_123d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_P12E3N)


m_results <-  summary(m_logAJP12E3N)
odds <- exp(coefficients(m_logAJP12E3N))
conf <- exp(confint(m_logAJP12E3N))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJP12E3N, type = '3')

Coeficientes <- paste0((round(exp(m_logAJP12E3N$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJP12E3N$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJP12E3N))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJP12E3N)[2:8,2] - confint(m_logAJP12E3N)[2:8,1]))
Retorno_modelo
```

# Pfizer: Apenas 3° Dose

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_analise3Pfizer <-   dados_completo  %>%
                            dplyr::filter((LB41 == 3 & LB46 == 3 & data_dif_3dose >= 7) |
                                           LB40 == 0) %>%
                            dplyr::filter(!(is.na(resultado))) %>%
                            dplyr::filter(!(resultado == "3")) %>% 
                            dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                          pfizer3   = dplyr::case_when(LB41 == 3 & LB46 == 3 & data_dif_3dose >= 7 ~ "1",
                                                                        is.na(LB41) | is.na(EL66) | is.na(data_dif_2dose) ~ NA_character_,
                                                                        TRUE ~ "0"),
                                          exp3P = dplyr::case_when((LB41 == 3 & LB46 == 3 & data_dif_3dose >= 7) | (LB41 == 3 & LB46 == 3 & is.na(data_dif_3dose)) ~ "1",
                                                                     LB40 == 0 ~ "0",
                                                                     TRUE ~ NA_character_),
                                          exp3P = base::factor(exp3P, levels = c("0", "1"))) 

```

Há `r nrow(dados_analise3Pfizer)` participantes com duas ou mais doses do tipo Pfizer para Pfizer: 1° e 2° Dose. Há `r sum(dados_analise3Pfizer$exp3P == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise3Pfizer$exp3P == 0)` não vacinados. São `r sum(dados_analise3Pfizer$resultado == 1)` positivos e `r sum(dados_analise3Pfizer$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r message=FALSE, warning=FALSE, results = "asis"}

#########################
# APENAS 3° DOSE PFIZER #
########################
#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")
doses_3Pfizer <- summary_table(dplyr::group_by(dados_analise3Pfizer, exp3P),
                                 summaries = our_summary1)
doses_3Pfizer
```

## Modelo

Abaixo se encontra gráfico demostrando ao longo do tempo a taxa de positividade e apenas 3° dose de vacinação do tipo Pfizer.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#########################
# TAXA DE POSITIVIDADE  #
#########################

dados_analise3Pfizer %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                semana_7dias_3pfizer = sum(pfizer3 == "1", na.rm = T),
                taxa_positivos       = positivos_semana / total_semana * 100,
                taxa_3pfizer         = semana_7dias_3pfizer / total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(semana_7dias_3pfizer), x = as.numeric(semana_do_estudo), color = 'Apenas 3° dose Pfizer')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()

```

### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
################################
# MODELO BRUTO: Apenas 3° PFIZER
################################

m_logBC_3P <- glm(resultado ~  exp3P, 
                     family = 'binomial', 
                     data = dados_analise3Pfizer)

m_results <-  summary(m_logBC_3P)
odds <- exp(coefficients(m_logBC_3P))
conf <- exp(confint(m_logBC_3P))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logBC_3P, type = '3')
```

```{r message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_3P$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC_3P$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_3P))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_3P)[2,2] - confint(m_logBC_3P)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_3P, type = "deviance")
probabilitiesBC_3P = predict(m_logBC_3P, type = "response")

dados_analise3Pfizer <-  dados_analise3Pfizer %>%
                           dplyr::mutate(logit_modeloBC_2P = base::log(probabilitiesBC_3P/(1-probabilitiesBC_3P)),
                                         deviance_modeloBC_3P = res.devBC) 

figura_1 <-  ggplot(dados_analise3Pfizer, aes(semana_do_estudo, y = deviance_modeloBC_3P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise3Pfizer, aes(semana_do_estudo, y = probabilitiesBC_3P))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

### Ajustado 

Os quartis ajustados para a vacina tipo apenas 3° dose Pfizer segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analise3Pfizer$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: APENAS TERCEIRA DOSE PFIZER
###################################################

m_logAJ <-  glm(resultado ~ exp3P + idade_cat + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analise3Pfizer)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise3Pfizer <- dados_analise3Pfizer %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))

Retorno_modelo
```

###### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_analise3Pfizer, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_analise3Pfizer, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

# Outras Vacinas (Referência)
## Outras vs Pfizer
### Ajustado
```{r echo=TRUE, message=FALSE, warning=FALSE}

dados_OP <- dados_completo %>% 
                 dplyr::filter(exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
                 dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
##################
#  LINEARIEDADE  #
##################

intlog <- dados_OP$data_dif_tempoDose*log(dados_OP$data_dif_tempoDose)
dados_OP$intlog <- intlog

m_intlog <-  glm(resultado ~ exp_ter_2d + data_dif_tempoDose + intlog + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
              family = binomial(link = "logit"), 
              data = dados_OP)
summary(m_intlog)

logito <- m_intlog$linear.predictors
dados_OP$logito <- logito

ggplot(dados_OP, aes(data_dif_tempoDose, logito)) +
  geom_point(size = 0.5, alpha = 0.5) +
  geom_smooth(method = "loess") +
  theme_classic()

```

Há `r nrow(dados_OP)` participantes neste regime. Há `r sum(dados_OP$exp_ter_2d == 1)` com duas doses Pfizer, `r sum(dados_OP$exp_ter_2d == 2)` com duas doses AstraZeneca, `r sum(dados_OP$exp_ter_2d == 3)` com duas doses CoronaVac e `r sum(dados_OP$exp_ter_2d == 4)` com uma dose Janssen. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + data_dif_tempoDose3M + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```

#### Resíduos

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJOP, type = "response")

dados_OP <- dados_OP %>%
              dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                            deviance_modeloAJ = residuals(m_logAJOP, type = "deviance"))
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_OP, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_OP, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

### >= 7 e <90

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_OP <- dados_completo %>% 
                 dplyr::filter(exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 90) %>%
                 dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_OP)` participantes neste regime. Há `r sum(dados_OP$exp_ter_2d == 1)` com duas doses Pfizer, `r sum(dados_OP$exp_ter_2d == 2)` com duas doses AstraZeneca, `r sum(dados_OP$exp_ter_2d == 3)` com duas doses CoronaVac e `r sum(dados_OP$exp_ter_2d == 4)` com uma dose Janssen. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJON <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_OP)


m_results <-  summary(m_logAJON)
odds <- exp(coefficients(m_logAJON))
conf <- exp(confint(m_logAJON))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJON, type = '3')

Coeficientes <- paste0((round(exp(m_logAJON$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJON$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJON))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJON)[2:8,2] - confint(m_logAJON)[2:8,1]))
Retorno_modelo
```

### >=90

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_OP <- dados_completo %>% 
                 dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 90 ) %>%
                 dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_OP)` participantes neste regime. Há  `r sum(dados_OP$exp_ter_2d == 1)` com duas doses Pfizer, `r sum(dados_OP$exp_ter_2d == 2)` com duas doses AstraZeneca, `r sum(dados_OP$exp_ter_2d == 3)` com duas doses CoronaVac e `r sum(dados_OP$exp_ter_2d == 4)` com uma dose Janssen. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJON <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_OP)


m_results <-  summary(m_logAJON)
odds <- exp(coefficients(m_logAJON))
conf <- exp(confint(m_logAJON))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJON, type = '3')

Coeficientes <- paste0((round(exp(m_logAJON$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJON$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJON))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJON)[2:8,2] - confint(m_logAJON)[2:8,1]))
Retorno_modelo
```

## Outras vs Nada
### Ajustado
```{r message=FALSE, warning=FALSE, include=FALSE}

dados_ON <- dados_completo %>% 
                 dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
                 dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(0,1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_ON)` participantes neste regime. Há `r sum(dados_ON$exp_ter_2d == 0)` com nenhuma dose, `r sum(dados_ON$exp_ter_2d == 1)` com duas doses Pfizer, `r sum(dados_ON$exp_ter_2d == 2)` com duas doses AstraZeneca, `r sum(dados_ON$exp_ter_2d == 3)` com duas doses CoronaVac e `r sum(dados_ON$exp_ter_2d == 4)` com uma dose Janssen. São `r sum(dados_ON$resultado == 1)` positivos e `r sum(dados_ON$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJON <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_ON)


m_results <-  summary(m_logAJON)
odds <- exp(coefficients(m_logAJON))
conf <- exp(confint(m_logAJON))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJON, type = '3')

Coeficientes <- paste0((round(exp(m_logAJON$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJON$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJON))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJON)[2:8,2] - confint(m_logAJON)[2:8,1]))
Retorno_modelo
```

#### Resíduos

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJON, type = "response")

dados_ON <- dados_ON %>%
              dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                            deviance_modeloAJ = residuals(m_logAJON, type = "deviance"))
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_ON, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_ON, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```


### >= 7 e <90

```{r message=FALSE, warning=FALSE, include=FALSE}

dados_ON <- dados_completo %>% 
                 dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 90 | is.na(data_dif_tempoDose)) %>%
                 dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(0,1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_ON)` participantes neste regime. Há `r sum(dados_ON$exp_ter_2d == 0)` com nenhuma dose, `r sum(dados_ON$exp_ter_2d == 1)` com duas doses Pfizer, `r sum(dados_ON$exp_ter_2d == 2)` com duas doses AstraZeneca, `r sum(dados_ON$exp_ter_2d == 3)` com duas doses CoronaVac e `r sum(dados_ON$exp_ter_2d == 4)` com uma dose Janssen. São `r sum(dados_ON$resultado == 1)` positivos e `r sum(dados_ON$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJON <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_ON)


m_results <-  summary(m_logAJON)
odds <- exp(coefficients(m_logAJON))
conf <- exp(confint(m_logAJON))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJON, type = '3')

Coeficientes <- paste0((round(exp(m_logAJON$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJON$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJON))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJON)[2:8,2] - confint(m_logAJON)[2:8,1]))
Retorno_modelo
```

#### Resíduos

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJON, type = "response")

dados_ON <- dados_ON %>%
              dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                            deviance_modeloAJ = residuals(m_logAJON, type = "deviance"))
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=TRUE, message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_ON, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_ON, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```


### >= 90

```{r echo=TRUE, message=FALSE, warning=FALSE}

dados_ON <- dados_completo %>% 
                 dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
                 dplyr::filter(data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose)) %>%
                 dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(0,1,2,3,4)),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c(0,1)))

```

Há `r nrow(dados_ON)` participantes neste regime. Há `r sum(dados_ON$exp_ter_2d == 0)` com nenhuma dose, `r sum(dados_ON$exp_ter_2d == 1)` com duas doses Pfizer, `r sum(dados_ON$exp_ter_2d == 2)` com duas doses AstraZeneca, `r sum(dados_ON$exp_ter_2d == 3)` com duas doses CoronaVac e `r sum(dados_ON$exp_ter_2d == 4)` com uma dose Janssen. São `r sum(dados_ON$resultado == 1)` positivos e `r sum(dados_ON$resultado == 0)` negativos.

Abaixo se encontram resultados do modelo ajustado. 

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJON <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = dados_ON)


m_results <-  summary(m_logAJON)
odds <- exp(coefficients(m_logAJON))
conf <- exp(confint(m_logAJON))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJON, type = '3')

Coeficientes <- paste0((round(exp(m_logAJON$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJON$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJON))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJON)[2:8,2] - confint(m_logAJON)[2:8,1]))
Retorno_modelo
```

#### Resíduos

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJON, type = "response")

dados_ON <- dados_ON %>%
              dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                            deviance_modeloAJ = residuals(m_logAJON, type = "deviance"))
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r message=FALSE, warning=FALSE}

figura_1 <-  ggplot(dados_ON, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_ON, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```


### CoronaVac (Referência)

```{r echo=TRUE, message=FALSE, warning=FALSE}
##################
#COMPLETO
###################
dados_OP <- dados_completo %>% 
  dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
  dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(3,0,1,2,4)),
                resultado = dplyr::case_when(resultado == 1 ~ 1,
                                             resultado == 2 ~ 0),
                resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_OP)` participantes. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```

#### >= 7 e <90

```{r echo=TRUE, message=FALSE, warning=FALSE}
##################
#COMPLETO
###################
dados_OP <- dados_completo %>% 
  dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
  dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 90 | is.na(data_dif_tempoDose)) %>% 
  dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(3,0,1,2,4)),
                resultado = dplyr::case_when(resultado == 1 ~ 1,
                                             resultado == 2 ~ 0),
                resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_OP)` participantes. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```


#### >90

```{r echo=TRUE, message=FALSE, warning=FALSE}
##################
#COMPLETO
###################
dados_OP <- dados_completo %>% 
  dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
  dplyr::filter(data_dif_tempoDose >= 90 | is.na(data_dif_tempoDose)) %>% 
  dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(3,0,1,2,4)),
                resultado = dplyr::case_when(resultado == 1 ~ 1,
                                             resultado == 2 ~ 0),
                resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_OP)` participantes. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```


### AstraZeneca (Referência)

```{r echo=TRUE, message=FALSE, warning=FALSE}
##################
#COMPLETO
###################
dados_OP <- dados_completo %>% 
  dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
  dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(4,0,1,2,3)),
                resultado = dplyr::case_when(resultado == 1 ~ 1,
                                             resultado == 2 ~ 0),
                resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_OP)` participantes. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```

#### >= 7 e <90

```{r echo=TRUE, message=FALSE, warning=FALSE}
##################
#COMPLETO
###################
dados_OP <- dados_completo %>% 
  dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
  dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 90) %>% 
  dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(4,0,1,2,3)),
                resultado = dplyr::case_when(resultado == 1 ~ 1,
                                             resultado == 2 ~ 0),
                resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_OP)` participantes. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```


#### >90

```{r echo=TRUE, message=FALSE, warning=FALSE}
##################
#COMPLETO
###################
dados_OP <- dados_completo %>% 
  dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
  dplyr::filter(data_dif_tempoDose >=  90) %>% 
  dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(4,0,1,2,3)),
                resultado = dplyr::case_when(resultado == 1 ~ 1,
                                             resultado == 2 ~ 0),
                resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_OP)` participantes. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,1]),3),
             ';',
             round((1 - conf[2:8,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```



### Janssen (Referência)

```{r echo=TRUE, message=FALSE, warning=FALSE}
##################
#COMPLETO
###################
dados_OP <- dados_completo %>% 
  dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
  dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(4,0,1,2,3)),
                resultado = dplyr::case_when(resultado == 1 ~ 1,
                                             resultado == 2 ~ 0),
                resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_OP)` participantes. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```


#### >= 7 e <90

```{r echo=TRUE, message=FALSE, warning=FALSE}
##################
#COMPLETO
###################
dados_OP <- dados_completo %>% 
  dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
  dplyr::filter(data_dif_tempoDose >= 7 & data_dif_tempoDose < 90 | is.na(data_dif_tempoDose)) %>%  
  dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(4,0,1,2,3)),
                resultado = dplyr::case_when(resultado == 1 ~ 1,
                                             resultado == 2 ~ 0),
                resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_OP)` participantes. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```


#### >90

```{r echo=TRUE, message=FALSE, warning=FALSE}
##################
#COMPLETO
###################
dados_OP <- dados_completo %>% 
  dplyr::filter(exp_ter_2d == 0 | exp_ter_2d == 1 | exp_ter_2d == 2 | exp_ter_2d == 3 | exp_ter_2d == 4) %>% 
  dplyr::filter(data_dif_tempoDose >=  90 | is.na(data_dif_tempoDose)) %>%  
  dplyr::mutate(exp_ter_2d = base::factor(exp_ter_2d, levels = c(4,0,1,2,3)),
                resultado = dplyr::case_when(resultado == 1 ~ 1,
                                             resultado == 2 ~ 0),
                resultado = base::factor(resultado, levels = c(0,1)))
```

Há `r nrow(dados_OP)` participantes. São `r sum(dados_OP$resultado == 1)` positivos e `r sum(dados_OP$resultado == 0)` negativos.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################
# MODELO AJUSTADO #
###################

m_logAJOP <-  glm(resultado ~ exp_ter_2d + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                  family = 'binomial', 
                  data = dados_OP)


m_results <-  summary(m_logAJOP)
odds <- exp(coefficients(m_logAJOP))
conf <- exp(confint(m_logAJOP))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJOP, type = '3')

Coeficientes <- paste0((round(exp(m_logAJOP$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJOP$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJOP))[,'Pr(>|z|)'][2:8],3),
                              Amplitude = exp(confint(m_logAJOP)[2:8,2] - confint(m_logAJOP)[2:8,1]))
Retorno_modelo
```


# Outras Vacinas (Individual)
## CoronaVac vs Sem Vacina

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analise2R <-   dados_completo  %>%
                       dplyr::filter(exp_ter_2d == 3 | LB40 == 0) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                     exp2CV = dplyr::case_when(exp_ter_2d == 3 ~ "1",
                                                               LB40 == 0 ~ "0",
                                                               TRUE ~ NA_character_),
                                     exp2CV = base::factor(exp2CV, levels = c("0", "1"))) 
```

Há `r nrow(dados_analise2R)` participantes com duas doses do tipo CoronaVac vs Nenhuma Vacina. Há `r sum(dados_analise2R$exp2CV == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise3Pfizer$exp2CV == 0)` não vacinados. São `r sum(dados_analise2R$resultado == 1)` positivos e `r sum(dados_analise2R$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r message=FALSE, warning=FALSE, results = "asis"}
####################
#      CORONAVAC
###################
#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")


doses_CoronaVac <- summary_table(dplyr::group_by(dados_analise2R, exp2CV),
                                 summaries = our_summary1)
doses_CoronaVac
```

### Modelo

Abaixo se encontra gráfico demostrando ao longo do tempo a taxa de positividade e vacinação do tipo CoronaVac.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###############################################
# TAXA DE POSITIVIDADE
###############################################

dados_completo %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                coronavac_semana_14dias   = sum(dias_Maior14CV == "1", na.rm = T),
                taxa_positivos            = positivos_semana / total_semana * 100,
                taxa_coronavac            = coronavac_semana_14dias / total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(coronavac_semana_14dias), x = as.numeric(semana_do_estudo), color = 'CoronaVac')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()

```

#### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
#######################################
# MODELO BRUTO: DUAS VACINAS CORONAVAC
#######################################

m_logBC_CV <-  glm(resultado ~  exp2CV, 
                   family = 'binomial', 
                   data = dados_analise2R)

m_results <-  summary(m_logBC_CV)
odds <- exp(coefficients(m_logBC_CV))
conf <- exp(confint(m_logBC_CV))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logBC_CV, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_CV$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC_CV$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_CV))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_CV)[2,2] - confint(m_logBC_CV)[2,1]))
Retorno_modelo
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_CV, type = "deviance")
probabilitiesBC_CV = predict(m_logBC_CV, type = "response")

dados_analise2R <-  dados_analise2R %>%
  dplyr::mutate(logit_modeloBC_CV = base::log(probabilitiesBC_CV/(1-probabilitiesBC_CV)),
                deviance_modeloBC_CV = res.devBC) 

figura_1 <-  ggplot(dados_analise2R, aes(semana_do_estudo, y = logit_modeloBC_CV))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise2R, aes(semana_do_estudo, y = probabilitiesBC_CV))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

#### Ajustado 

Os quartis ajustados para a vacina tipo CoronaVac segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analise2R$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r echo=TRUE, message=FALSE, warning=FALSE}
####################################
# MODELO AJUSTADO: DUAS  CORONAVAC #
####################################

m_logAJ <-  glm(resultado ~ exp2CV + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analise2R)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise2R <- dados_analise2R %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))
Retorno_modelo
```


##### Por Tempo

```{r eval=FALSE, include=FALSE}
###################################################
#    MODELO AJUSTADO: DUAS  CORONAVAC POR TEMPO   #
###################################################

m_logAJT <-  glm(resultado ~ exp2CV + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + data_dif_tempoDose3M + LB5, 
                family = 'binomial', 
                data = dados_analise2R)

m_results <-  summary(m_logAJT)
odds <- exp(coefficients(m_logAJT))
conf <- exp(confint(m_logAJT))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJT, type = '3')
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

probabilitiesAJT <- predict(m_logAJT, type = "response")

# dados_analise2R <- dados_analise2R %>%
#                      dplyr::mutate(logit_modeloAJT    = log(probabilitiesAJT/(1-probabilitiesAJT)),
#                                    deviance_modeloAJT = residuals(m_logAJT, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJT$coefficients[2:12]),3)),
                       ' (',
                       round(conf[2:12,1],3),
                       ';',
                       round(conf[2:12,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJT$coefficients[2:12]),3)) ,
              ' (',
              round(abs(1 - conf[2:12,1]),3),
              ';',
              round(abs(1 - conf[2:12,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJT))[,'Pr(>|z|)'][2:12],3),
                              Amplitude = exp(confint(m_logAJT)[2:12,2] - confint(m_logAJT)[2:12,1]))
Retorno_modelo
```

## CoronaVac vs Pfizer

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analisePCV <-   dados_completo  %>%
                       dplyr::filter(exp_ter_2d == 1 | exp_ter_2d == 3) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                     expPCV = dplyr::case_when(exp_ter_2d == 1 ~ "1",
                                                               exp_ter_2d == 3 ~ "0",
                                                               TRUE ~ NA_character_),
                                     expPCV = base::factor(expPCV, levels = c("0", "1"))) 
```

Há `r nrow(dados_analisePCV)` participantes com duas doses do tipo CoronaVac vs Nenhuma Vacina. Há `r sum(dados_analisePCV$expPCV == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analisePCV$expPCV == 0)` não vacinados. São `r sum(dados_analisePCV$resultado == 1)` positivos e `r sum(dados_analisePCV$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r echo=FALSE, message=FALSE, warning=FALSE, results= "asis"}

####################
# CORONAVAC & PFIZER
####################

#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")
doses_PCV <- summary_table(dplyr::group_by(dados_analisePCV, expPCV),
                                 summaries = our_summary1)
doses_PCV
```

### Modelo

#### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
####################################################
# MODELO BRUTO: DUAS VACINAS CORONAVAC E DUAS PFIZER
####################################################

m_logBC_PCV <-  glm(resultado ~  expPCV, 
                   family = 'binomial', 
                   data = dados_analisePCV)

m_results <-  summary(m_logBC_PCV)
odds <- exp(coefficients(m_logBC_PCV))
conf <- exp(confint(m_logBC_PCV))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logBC_PCV, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_PCV$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC_PCV$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_PCV))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_PCV)[2,2] - confint(m_logBC_PCV)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_PCV, type = "deviance")
probabilitiesBC_PCV = predict(m_logBC_PCV, type = "response")

dados_analisePCV <-  dados_analisePCV %>%
  dplyr::mutate(logit_modeloBC_PCV = base::log(probabilitiesBC_PCV/(1-probabilitiesBC_PCV)),
                deviance_modeloBC_CV = res.devBC) 

figura_1 <-  ggplot(dados_analisePCV, aes(semana_do_estudo, y = logit_modeloBC_PCV))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analisePCV, aes(semana_do_estudo, y = probabilitiesBC_PCV))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

#### Ajustado 

Os quartis ajustados para a duas vacinas tipo CoronaVac e duas vacinas tipo Pfizer segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analisePCV$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: DUAS CORONAVAC E DUAS PFIZER
###################################################

m_logAJ <-  glm(resultado ~ expPCV + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analisePCV)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePCV <- dados_analisePCV %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))
Retorno_modelo
```

##### Por Tempo

```{r include=FALSE}
###################################################
#    MODELO AJUSTADO: DUAS  CORONAVAC POR TEMPO   #
###################################################

m_logAJ <-  glm(resultado ~ expPCV + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + data_dif_tempoDose3M + LB5, 
                family = 'binomial', 
                data = dados_analisePCV)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

 dados_analisePCV <- dados_analisePCV %>%
   dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                 deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:12]),3)),
                       ' (',
                       round(conf[2:12,1],3),
                       ';',
                       round(conf[2:12,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:12]),3)) ,
              ' (',
              round(abs(1 - conf[2:12,1]),3),
              ';',
              round(abs(1 - conf[2:12,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:12],3),
                              Amplitude = exp(confint(m_logAJ)[2:12,2] - confint(m_logAJ)[2:12,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

figura_1 <-  ggplot(dados_analisePCV, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()


figura_2 <-  ggplot(dados_analisePCV, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

## AstraZeneca vs Sem Vacina

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analise3R <-   dados_completo  %>%
                       dplyr::filter(exp_ter_2d == 2 | LB40 == 0) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                     exp3AZ = dplyr::case_when(exp_ter_2d == 2 ~ "1",
                                                               LB40 == 0 ~ "0",
                                                               TRUE ~ NA_character_),
                                     exp3AZ = base::factor(exp3AZ, levels = c("0", "1"))) 
```

Há `r nrow(dados_analise3R)` participantes com duas doses do tipo AstraZeneca vs Nenhuma Vacina. Há `r sum(dados_analise3R$exp3AZ == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise3R$exp3AZ == 0)` não vacinados. São `r sum(dados_analise3R$resultado == 1)` positivos e `r sum(dados_analise3R$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis"}

####################
#  ASTRAZENECA
####################

#options(qwraps2_markup = 'latex')
#options(qwraps2_markup = "markdown")


doses_AstraZeneca <- summary_table(dplyr::group_by(dados_analise3R, exp3AZ),
                                   summaries = our_summary1)
doses_AstraZeneca
```

### Modelo

Abaixo se encontra gráfico demostrando ao longo do tempo a taxa de positividade e vacinação do tipo AstraZeneca.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###############################################
# TAXA DE POSITIVIDADE
###############################################

dados_completo %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                astrazeneca_semana_15dias   = sum(dias_Maior15AZ == "1", na.rm = T),
                taxa_positivos            = positivos_semana / total_semana * 100,
                taxa_astrazeneca          = astrazeneca_semana_15dias / total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(astrazeneca_semana_15dias), x = as.numeric(semana_do_estudo), color = 'AstraZeneca')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()

```

#### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
################################################
# MODELO BRUTO: DUAS  ASTRAZENECA
################################################

m_logBC_AZ <-  glm(resultado ~  exp3AZ, 
                   family = 'binomial', 
                   data = dados_analise3R)

m_results <-  summary(m_logBC_AZ)
odds <- exp(coefficients(m_logBC_AZ))
conf <- exp(confint(m_logBC_AZ))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logBC_AZ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_AZ$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )


ve <- paste0((round(1 - exp(m_logBC_AZ$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_AZ))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_AZ)[2,2] - confint(m_logBC_AZ)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_AZ, type = "deviance")
probabilitiesBC_AZ = predict(m_logBC_AZ, type = "response")

dados_analise3R <-  dados_analise3R %>%
  dplyr::mutate(logit_modeloBC_AZ = base::log(probabilitiesBC_AZ/(1-probabilitiesBC_AZ)),
                deviance_modeloBC_CV = res.devBC) 

figura_1 <-  ggplot(dados_analise3R, aes(semana_do_estudo, y = logit_modeloBC_AZ))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise3R, aes(semana_do_estudo, y = probabilitiesBC_AZ))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

#### Ajustado 

Os quartis ajustados para a vacina tipo AstraZeneca segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analise3R$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: DUAS VACINAS ASTRAZENECA
###################################################

m_logAJ <-  glm(resultado ~ exp3AZ + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analise3R)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise3R <- dados_analise3R %>%
                     dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                                   deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')


ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))
Retorno_modelo
```

##### Por Tempo

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
###################################################
# MODELO AJUSTADO: DUAS VACINAS ASTRAZENECA + TEMPO
###################################################

m_logAJ <-  glm(resultado ~ exp3AZ + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + data_dif_tempoDose3M + LB5, 
                family = 'binomial', 
                data = dados_analise3R)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

# dados_analise3R <- dados_analise3R %>%
#                      dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
#                                    deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

figura_1 <-  ggplot(dados_analise3R, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()


figura_2 <-  ggplot(dados_analise3R, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

## AstraZeneca vs Pfizer

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analisePAZ <-   dados_completo  %>%
                       dplyr::filter(exp_ter_2d == 1 | exp_ter_2d == 2) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                     expPAZ = dplyr::case_when(exp_ter_2d == 1 ~ "1",
                                                               exp_ter_2d == 2 ~ "0",
                                                               TRUE ~ NA_character_),
                                     expPAZ = base::factor(expPAZ, levels = c("0", "1"))) 
```

Há `r nrow(dados_analisePAZ)` participantes com duas doses do tipo AstraZeneca vs Nenhuma Vacina. Há `r sum(dados_analisePAZ$expPAZ == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analisePAZ$expPAZ == 0)` não vacinados. São `r sum(dados_analisePAZ$resultado == 1)` positivos e `r sum(dados_analisePAZ$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r echo=FALSE, message=FALSE, warning=FALSE, results= "asis"}
#######################
# ASTRAZENECA & PFIZER
#######################
#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")
doses_PAZ <- summary_table(dplyr::group_by(dados_analisePAZ, expPAZ),
                                 summaries = our_summary1)
doses_PAZ
```

### Modelo

#### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
####################################################
# MODELO BRUTO: DUAS VACINAS CORONAVAC E DUAS PFIZER
####################################################

m_logBC_PCV <-  glm(resultado ~  expPCV, 
                   family = 'binomial', 
                   data = dados_analisePCV)

m_results <-  summary(m_logBC_PCV)
odds <- exp(coefficients(m_logBC_PCV))
conf <- exp(confint(m_logBC_PCV))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logBC_PCV, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_PCV$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_PCV))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_PCV)[2,2] - confint(m_logBC_PCV)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_PCV, type = "deviance")
probabilitiesBC_PCV = predict(m_logBC_PCV, type = "response")

dados_analisePCV <-  dados_analisePCV %>%
  dplyr::mutate(logit_modeloBC_PCV = base::log(probabilitiesBC_PCV/(1-probabilitiesBC_PCV)),
                deviance_modeloBC_CV = res.devBC) 

figura_1 <-  ggplot(dados_analisePCV, aes(semana_do_estudo, y = logit_modeloBC_PCV))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analisePCV, aes(semana_do_estudo, y = probabilitiesBC_PCV))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

#### Ajustado 

Os quartis ajustados para a duas vacinas tipo CoronaVac e duas vacinas tipo Pfizer segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analisePAZ$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: DUAS ASTRAZENECA E DUAS PFIZER
###################################################

m_logAJ <-  glm(resultado ~ expPAZ + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analisePAZ)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePAZ <- dados_analisePAZ %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```



##### Por Tempo

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: DUAS VACINAS ASTRAZENECA + TEMPO
###################################################

m_logAJ <-  glm(resultado ~ expPAZ + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + data_dif_tempoDose3M + LB5, 
                family = 'binomial', 
                data = dados_analisePAZ)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePAZ <- dados_analisePAZ %>%
                      dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                                    deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

figura_1 <-  ggplot(dados_analisePAZ, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()


figura_2 <-  ggplot(dados_analisePAZ, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```


## Janssen vs Sem Vacina

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analise4R <-   dados_completo  %>%
                       dplyr::filter(exp_ter_2d == 4 | LB40 == 0) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                     exp4JS = dplyr::case_when(dias_Maior14JS == 1 ~ "1",
                                                               LB40 == 0 ~ "0",
                                                               TRUE ~ NA_character_),
                                     exp4JS = base::factor(exp4JS, levels = c("0", "1"))) 
```

Há `r nrow(dados_analise4R)` participantes com duas doses do tipo AstraZeneca vs Nenhuma Vacina. Há `r sum(dados_analise4R$exp4JS == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analise4R$exp4JS == 0)` não vacinados. São `r sum(dados_analise4R$resultado == 1)` positivos e `r sum(dados_analise4R$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r message=FALSE, warning=FALSE, results = "asis"}
####################
#      JANSSEN
###################
#options(qwraps2_markup = 'latex')
#options(qwraps2_markup = "markdown")
doses_Janssen <- summary_table(dplyr::group_by(dados_analise4R, exp4JS),
                                 summaries = our_summary1)
doses_Janssen
```

### Modelo

Abaixo se encontra gráfico demostrando ao longo do tempo a taxa de positividade e vacinação do tipo Janssen.

```{r echo=FALSE, message=FALSE, warning=FALSE}
###############################################
# TAXA DE POSITIVIDADE
###############################################

dados_completo %>%
  dplyr::group_by(semana_do_estudo) %>% 
  dplyr::mutate(positivos_semana = sum(resultado == "1", na.rm = TRUE),
                total_semana = n(),
                janssen_semana_15dias   = sum(dias_Maior14JS == "1", na.rm = T),
                taxa_positivos          = positivos_semana / total_semana * 100,
                taxa_janssen            = janssen_semana_15dias / total_semana * 100) %>% 
  ggplot() + 
  geom_line(aes(y = as.numeric(positivos_semana), x = as.numeric(semana_do_estudo), color = 'Positivos')) + 
  geom_line(aes(y = as.numeric(janssen_semana_15dias), x = as.numeric(semana_do_estudo), color = 'Janssen')) +
  geom_line(aes(y = as.numeric(total_semana), x = as.numeric(semana_do_estudo), color = 'Total')) +
  scale_x_continuous(breaks = seq(0,40, by = 2), name = 'Semana do estudo') +
  scale_y_continuous(breaks = seq(0,300, by = 25), name = 'Quantidade') +
  theme_bw()

```

#### Bruto

```{r message=FALSE, warning=FALSE, include=FALSE}
############################################
# MODELO BRUTO: UMA DOSE JANSSEN
############################################

m_logBC_JS <-  glm(resultado ~  exp4JS, 
                   family = 'binomial', 
                   data = dados_analise4R)

m_results <-  summary(m_logBC_JS)
odds <- exp(coefficients(m_logBC_JS))
conf <- exp(confint(m_logBC_JS))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logBC_JS, type = '3')
```

Abaixo se encontram resultados do modelo bruto.

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_JS$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_JS))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_JS)[2,2] - confint(m_logBC_JS)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_JS, type = "deviance")
probabilitiesBC_JS = predict(m_logBC_JS, type = "response")

dados_analise4R <-  dados_analise4R %>%
  dplyr::mutate(logit_modeloBC_JS = base::log(probabilitiesBC_JS/(1-probabilitiesBC_JS)),
                deviance_modeloBC_CV = res.devBC) 

figura_1 <-  ggplot(dados_analise4R, aes(semana_do_estudo, y = logit_modeloBC_JS))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analise4R, aes(semana_do_estudo, y = probabilitiesBC_JS))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

#### Ajustado 

Os quartis ajustados para a vacina tipo Janssen segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analise4R$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###############################################
# MODELO AJUSTADO: UMA DOSE JANSSEN
###############################################

m_logAJ <-  glm(resultado ~ exp4JS + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise  + LB5, 
                family = 'binomial', 
                data = dados_analise4R)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise4R <- dados_analise4R %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

##### Por Tempo

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
###############################################
# MODELO AJUSTADO: UMA DOSE JANSSEN + TEMPO
###############################################

m_logAJ <-  glm(resultado ~ exp4JS + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + data_dif_tempoDose3M  + LB5,
                family = 'binomial',
                data = dados_analise4R)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]

#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analise4R <- dados_analise4R %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

figura_1 <-  ggplot(dados_analise4R, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()


figura_2 <-  ggplot(dados_analise4R, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

## Janssen vs Pfizer

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analisePJS <-   dados_completo  %>%
                       dplyr::filter(exp_ter_2d == 1 | exp_ter_2d == 4) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                     expPJS = dplyr::case_when(exp_ter_2d == 1 ~ "1",
                                                               exp_ter_2d == 4 ~ "0",
                                                               TRUE ~ NA_character_),
                                     expPJS = base::factor(expPJS, levels = c("0", "1"))) 
```

Há `r nrow(dados_analisePJS)` participantes com duas doses do tipo AstraZeneca vs Nenhuma Vacina. Há `r sum(dados_analisePJS$expPJS == 1)` participantes com Pfizer (duas ou três doses) e `r sum(dados_analisePJS$expPJS == 0)` não vacinados. São `r sum(dados_analisePJS$resultado == 1)` positivos e `r sum(dados_analisePJS$resultado == 2)` negativos.

A tabela a seguir demonstra as características gerais destes participantes:

```{r echo=FALSE, message=FALSE, warning=FALSE, results= "asis"}
#######################
# JANSSEN & PFIZER
#######################

#options(qwraps2_markup = 'latex')
options(qwraps2_markup = "markdown")
doses_PJS <- summary_table(dplyr::group_by(dados_analisePJS, expPJS),
                                 summaries = our_summary1)
doses_PJS
```

### Modelo

#### Bruto

Abaixo se encontram resultados do modelo bruto.

```{r message=FALSE, warning=FALSE, include=FALSE}
####################################################
# MODELO BRUTO: UMA JANSSEN E DUAS PFIZER
####################################################

m_logBC_PJS <-  glm(resultado ~  expPJS, 
                   family = 'binomial', 
                   data = dados_analisePJS)

m_results <-  summary(m_logBC_PJS)
odds <- exp(coefficients(m_logBC_PJS))
conf <- exp(confint(m_logBC_PJS))
amplitude <-  conf[2,2] - conf[2,1]

car::Anova(m_logBC_PJS, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Coeficientes  <-   paste0(( round(exp(m_logBC_PJS$coefficients[2]),3)) , ' (',   
                          round(conf[2,1],3), ';', 
                          round(conf[2,2],3), ')' )

ve <- paste0((round(1 - exp(m_logBC_PJS$coefficients[2]),3)) ,
              ' (',
              round(abs(1 - conf[2,1]),3),
              ';',
              round(abs(1 - conf[2,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logBC_PJS))[,'Pr(>|z|)'][2],3),
                              Amplitude = exp(confint(m_logBC_PJS)[2,2] - confint(m_logBC_PJS)[2,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r echo=FALSE, message=FALSE, warning=FALSE}

res.devBC <- residuals(m_logBC_PJS, type = "deviance")
probabilitiesBC_PJS = predict(m_logBC_PJS, type = "response")

dados_analisePJS <-  dados_analisePJS %>%
  dplyr::mutate(logit_modeloBC_PJS = base::log(probabilitiesBC_PJS/(1-probabilitiesBC_PJS)),
                deviance_modeloBC_CV = res.devBC) 

figura_1 <-  ggplot(dados_analisePJS, aes(semana_do_estudo, y = logit_modeloBC_PJS))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

figura_2 <-  ggplot(dados_analisePJS, aes(semana_do_estudo, y = probabilitiesBC_PJS))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()

f3 <-  ggpubr::ggarrange(figura_1, figura_2)
f3
```

#### Ajustado 

Os quartis ajustados para a uma vacina tipo Janssen e duas vacinas tipo Pfizer segue o mesmo ponto de corte da análise primária. 

O n para cada quartil se encontra a seguir.

```{r echo=FALSE, message=FALSE, warning=FALSE}

table(dados_analisePJS$quartil_analise)

```

Abaixo se encontram resultados do modelo ajustado.

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: UMA JANSSEN E DUAS PFIZER
###################################################

m_logAJ <-  glm(resultado ~ expPJS + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analisePJS)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePJS <- dados_analisePJS %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

##### Por Tempo

```{r echo=TRUE, message=FALSE, warning=FALSE}
###############################################
# MODELO AJUSTADO: UMA DOSE JANSSEN + TEMPO
###############################################

m_logAJ <-  glm(resultado ~ expPJS + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + data_dif_tempoDose3M + LB5, 
                family = 'binomial', 
                data = dados_analisePJS)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePJS <- dados_analisePJS %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
figura_1 <-  ggplot(dados_analisePJS, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()

figura_2 <-  ggplot(dados_analisePJS, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3
```

```{r eval=FALSE, include=FALSE}
sheets <- list("Base Completa"        = completo_pcr, 
               "Resultado"            = resultado_pcr,
               "Inclusão (sem tempo)" = vacina_ST,
               "Inclusão (com tempo)" = vacina_CT,
               "Pfizer (Completo)"    = pfizer_23doses,
               "Pfizer (Exposição)"   = doses_pfizer,
               "Pfizer (Resultado)"   = pfizer_23dosesNC)

write_xlsx(sheets, 
           paste0("~/persistent-files/fernanda/Relatórios/Análises/tab.xlsx"))
```


# GEE & Modelos Mistos

## GEE

### Modelo (exp)

```{r echo=TRUE}
dados_GEE <- dados_analise2P %>% 
               #dplyr::arrange(semana_do_estudo) %>% 
               dplyr::arrange(quartil_analise) %>% 
               dplyr::mutate(dplyr::across(c(resultado, exp2P), as.numeric)) %>% 
               dplyr::mutate(resultado = dplyr::case_when(resultado == 1 ~ 0,
                                                          resultado == 2 ~ 1)) 
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
m_GEExpo <- geepack::geeglm(resultado ~ exp2P,
                          family = 'binomial', 
                          id = factor(semana_do_estudo), 
                          corstr = 'exc', data = dados_GEE)

confint.geeglm <- function(object, parm, level = 0.95, ...) {
  cc <- coef(summary(object))
  mult <- qnorm((1+level)/2)
  citab <- with(as.data.frame(cc),
                cbind(lwr=Estimate-mult*Std.err,
                      upr=Estimate+mult*Std.err))
  rownames(citab) <- rownames(cc)
  citab[parm,]
}

summary(m_GEExpo)
confint.geeglm(m_GEExpo)
confint.geeglm(m_GEExpo)[, 2] - confint.geeglm(m_GEExpo)[, 1]
exp(coefficients(m_GEExpo))
exp(confint.geeglm(m_GEExpo))
exp(confint.geeglm(m_GEExpo))[, 2] -exp(confint.geeglm(m_GEExpo))[, 1]
```

### Modelo (quartil)

```{r echo=TRUE, message=FALSE, warning=FALSE}


m_GEEQuartil <-  geepack::geeglm(resultado ~ exp2P + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5,
                          family = 'binomial', 
                          id = factor(quartil_analise), 
                          corstr = 'exc', data = dados_GEE)

confint.geeglm <- function(object, parm, level = 0.95, ...) {
  cc <- coef(summary(object))
  mult <- qnorm((1+level)/2)
  citab <- with(as.data.frame(cc),
                cbind(lwr=Estimate-mult*Std.err,
                      upr=Estimate+mult*Std.err))
  rownames(citab) <- rownames(cc)
  citab[parm,]
}

summary(m_GEEQuartil)
confint.geeglm(m_GEEQuartil)
confint.geeglm(m_GEEQuartil)[, 2] - confint.geeglm(m_GEEQuartil)[, 1]
exp(coefficients(m_GEEQuartil))
exp(confint.geeglm(m_GEEQuartil))
exp(confint.geeglm(m_GEEQuartil))[, 2] -exp(confint.geeglm(m_GEEQuartil))[, 1]

```

#### Resíduos

```{r eval=FALSE, include=FALSE}

probabilitiesGEE <- predict(m_GEExpo, type = "response")
dados_GEE <- dados_GEE %>%
                dplyr::mutate(logit_modeloGEE    = log(probabilitiesGEE/(1-probabilitiesGEE)),
                              deviance_modeloGEE = residuals(m_GEExpo, type = "deviance"))    

figura_1 <-  ggplot(dados_GEE, aes(y = deviance_modeloGEE, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") + 
  theme_bw()


figura_2 <-  ggplot(dados_GEE, aes(y = logit_modeloGEE, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3   
```

## Modelos Mistos

```{r echo=TRUE, message=FALSE, warning=FALSE}
dados_MM <- dados_analise2P %>% 
              dplyr::mutate(semana_do_estudo = base::as.factor(semana_do_estudo),
                            quartil_analise  = base::as.factor(quartil_analise))
```


### Modelo

```{r echo=TRUE, message=FALSE, warning=FALSE}
################
# Modelo Misto #
################

# m1_mixed <- lme4::glmer(resultado ~ exp2P + (1 | semana_do_estudo), 
#                                   data = dados_analise2P,
#                                   family = binomial)

m1_mixed <- lme4::glmer(resultado ~ exp2P + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5 + (1 | quartil_analise), 
                                    data = dados_analise2P,
                                    family = binomial)

```


```{r echo=TRUE, message=FALSE, warning=FALSE}
print(m1_mixed, corr = FALSE)
summary(m1_mixed)
#confint(m1_mixed)
#exp(coef(m1_mixed))
 exp(-0.61929)
# exp(-0.836)
# exp(-0.033)

```

#### Resíduos


```{r eval=FALSE, include=FALSE}

dados1 <- dados_analise2P %>% 
  dplyr::filter(!(is.na(variante))) %>% 
  dplyr::select(recruitment_number, variante, LB_creation_date) %>% 
  dplyr::mutate(n = rep(1,584)) %>% 
  tidyr::pivot_wider(names_from  = variante, values_from  = n) %>% 
  #dplyr::mutate(across(where(is.numeric), ~na_if(., 0)))
  #dplyr::mutate(Inconclusivo = dplyr::na_if(Inconclusivo, "0"))
  dplyr::mutate(Inconclusivo = dplyr::case_when(is.na(Inconclusivo) ~ 0,
                                                Inconclusivo == 1 ~ 1),
                Delta        = dplyr::case_when(is.na(Delta) ~ 0,
                                                Delta == 1 ~ 1),
                `Inválido` = dplyr::case_when(is.na(`Inválido`) ~ 0,
                                                `Inválido` == 1 ~ 1),
                `Omicron Ba.1` = dplyr::case_when(is.na(`Omicron Ba.1`) ~ 0,
                                                `Omicron Ba.1` == 1 ~ 1),
                `Omicron Ba.2` = dplyr::case_when(is.na(`Omicron Ba.2`) ~ 0,
                                                `Omicron Ba.2` == 1 ~ 1),
                `Omicron Ba.5` = dplyr::case_when(is.na(`Omicron Ba.5`) ~ 0,
                                                `Omicron Ba.5` == 1 ~ 1)) %>% 
  dplyr::arrange(LB_creation_date)


dados2 <-  base::seq(as.Date("2021-11-04"), as.Date("2022-06-17"), by = "day") %>% 
           base::as.data.frame() 
base::colnames(dados2) <- "LB_creation_date" 


dados3 <- dados1 %>% 
          dplyr::full_join(dados2, by = "LB_creation_date")



dados3 <-  dados3 %>% 
           dplyr::group_by(LB_creation_date) %>% 
           dplyr::summarise(Inconclusivo = sum(Inconclusivo),
                            Delta        = sum(Delta),
                            `Inválido`   = sum(`Inválido`),
                            `Omicron Ba.1` = sum(`Omicron Ba.1`),
                            `Omicron Ba.2` = sum(`Omicron Ba.2`),
                            `Omicron Ba.5` = sum(`Omicron Ba.5`)) 
         
dados4 <- dados3 %>% 
          dplyr::mutate(across(where(is.numeric), ~na_if(., 0)))
          
dados_completo1 <- dados_completo %>% 
                   dplyr::select(recruitment_number, LB_creation_date)

 write_xlsx(dados_completo1, 
           paste0("~/persistent-files//fernanda/Relatórios/Análises/dados_completo1.xlsx"))

```

```{r eval=FALSE, include=FALSE}

dados_completo %>% 
  dplyr::select(recruitment_number, LB_creation_date) %>% 
  dplyr::group_by(LB_creation_date) %>% 
  dplyr::summarise(n = n()) %>% 
  dplyr::mutate(acumulado = base::cumsum(n))

```

```{r eval=FALSE, include=FALSE}
dados_casocontrole <- dados_completo %>% 
                      dplyr::select(recruitment_number, resultado, variante, exposicao) %>% 
                      dplyr::filter(resultado ==1)
```

# Revisão Artigo

## Descritiva (Tempo)










## Sensibilidade

### Delta phase (up to 30-11-21)

```{r include=FALSE}
fase_delta <- dados_analise2P %>% 
                 dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>% 
                 dplyr::filter(mes != 11) %>% 
                 dplyr::mutate(delta = dplyr::case_when(resultado == 1 & LB_creation_date <= "2021-11-30" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date <= "2021-11-30")
```

Não tem ajuste.

### Delta Genotipagem

```{r include=FALSE}
fase_deltaG <- dados_analise2P %>% 
                 dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>% 
                 dplyr::filter(mes != 11) %>% 
                 dplyr::mutate(delta = dplyr::case_when(variante == "Delta" ~ "Delta",
                                                        is.na(variante)     ~ NA_character_,
                                                        TRUE ~ "Outras"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(delta == "Delta" )
```

Não tem ajuste.

### Omicron phase (from 01-12-21)

```{r include=FALSE}
fase_omicron <- dados_analise2P %>%
                 dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>%
                 dplyr::filter(mes != 11) %>% 
                 dplyr::mutate(omicron = dplyr::case_when(resultado == 1 & LB_creation_date >= "2021-12-01" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date >= "2021-12-01")
```


```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFO <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicron)

m_results <-  summary(m_logAJFO)
odds <- exp(coefficients(m_logAJFO))
conf <- exp(confint(m_logAJFO))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFO, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFO$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFO$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFO))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJFO)[2:11,2] - confint(m_logAJFO)[2:11,1]))
Retorno_modelo
```


### Omicron Genotipagem

```{r include=FALSE}

fase_omicronG <- dados_analise2P %>%
                 dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>%
                 dplyr::filter(mes != 11) %>%  
                 dplyr::mutate(variante = dplyr::case_when(variante == "Omicron Ba.1" |
                                                          variante == "Omicron Ba.2" |
                                                          variante == "Omicron Ba.4" ~ "Omicron",
                                                          is.na(variante)     ~ "Sem Covid"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(variante %in% c("Omicron", "Sem Covid"))
```

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFO <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronG)

m_results <-  summary(m_logAJFO)
odds <- exp(coefficients(m_logAJFO))
conf <- exp(confint(m_logAJFO))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFO, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFO$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFO$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFO))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJFO)[2:11,2] - confint(m_logAJFO)[2:11,1]))
Retorno_modelo
```

### Omicron Ba1 phase (01-12-21 to 31-03-22)

```{r include=FALSE}
fase_omicronBa1 <- dados_analise2P %>%
                 dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>%
                 dplyr::filter(mes != 11) %>%
                 dplyr::mutate(omicron_Ba1 = dplyr::case_when(resultado == 1 & LB_creation_date >= "2021-12-01" & LB_creation_date <= "2022-03-31" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date >= "2021-12-01" & LB_creation_date <= "2022-03-31")
```

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFOBA1 <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronBa1)

m_results <-  summary(m_logAJFOBA1)
odds <- exp(coefficients(m_logAJFOBA1))
conf <- exp(confint(m_logAJFOBA1))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFOBA1, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFOBA1$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFOBA1$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFOBA1))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJFOBA1)[2:11,2] - confint(m_logAJFOBA1)[2:11,1]))
Retorno_modelo
```


### Omicron Ba1 Genotipagem

```{r include=FALSE}

fase_omicronba1G <- dados_analise2P %>%
                 dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>%
                 dplyr::filter(mes != 11) %>%
                 dplyr::mutate(omicronba1 = dplyr::case_when(variante == "Omicron Ba.1"  ~ "Omicron Ba1",
                                                        is.na(variante)     ~ "Sem Covid"),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(omicronba1 %in% c("Omicron Ba1", "Sem Covid"))
                                 
```


```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFOBA1G <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronba1G)

m_results <-  summary(m_logAJFOBA1G)
odds <- exp(coefficients(m_logAJFOBA1G))
conf <- exp(confint(m_logAJFOBA1G))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFOBA1G, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFOBA1G$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFOBA1G$coefficients[2:11]),3)),
             ' (',
             round((1 - conf[2:11,2]),3),
             ';',
             round((1 - conf[2:11,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFOBA1G))[,'Pr(>|z|)'][2:11],3))
Retorno_modelo
```

### Omicron Ba2 phase (from 01-04-22)

```{r include=FALSE}
fase_omicronBa2 <- dados_analise2P %>%
                 dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>%
                 dplyr::filter(mes != 11) %>% 
                 dplyr::mutate(omicron_Ba2 = dplyr::case_when(resultado == 1 & LB_creation_date >= "2022-04-01" ~ 1,
                                                        TRUE ~ 0),
                               resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 2 ~ 0),
                               resultado = base::factor(resultado, levels = c("0","1"))) %>% 
                 dplyr::filter(LB_creation_date >= "2022-04-01")
```

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################

m_logAJFOBA2 <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronBa2)

m_results <-  summary(m_logAJFOBA2)
odds <- exp(coefficients(m_logAJFOBA2))
conf <- exp(confint(m_logAJFOBA2))
amplitude <-  conf[2,2] - conf[2,1]
modeloCompleto <- car::Anova(m_logAJFOBA2, type = '3')

Coeficientes <- paste0((round(exp(m_logAJFOBA2$coefficients[2:8]),3)),
                       ' (',
                       round(conf[2:8,1],3),
                       ';',
                       round(conf[2:8,2],3), ')')

ve <- paste0((round(1 - exp(m_logAJFOBA2$coefficients[2:8]),3)),
             ' (',
             round((1 - conf[2:8,2]),3),
             ';',
             round((1 - conf[2:8,1]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJFOBA2))[,'Pr(>|z|)'][2:8],3))
Retorno_modelo
```


### Omicron Ba2 Genotipagem

```{r include=FALSE}


fase_omicronba2G <- dados_analise2P %>%
                    dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>%
                    dplyr::filter(mes != 11) %>%  
                    dplyr::mutate(variante = base::ifelse(is.na(variante), "Sem Covid", variante)) %>% 
                    dplyr::filter(variante %in% c("Omicron Ba.2", "Sem Covid")) %>% 
                    dplyr::mutate(resultado = dplyr::case_when(resultado == 1 ~ 1,
                                                            resultado == 3  | resultado == 2  ~ 0),
                               
                                  resultado = base::factor(resultado, levels = c("0","1"))) 
```

```{r echo=FALSE}
###################################
# MODELO AJUSTADO: FASE ÔMICRON #
###################################
m_logAJFOBA2G <-  glm(resultado ~ exp2P + quartil_analise + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + LB5, 
                       family = 'binomial', 
                       data = fase_omicronba2G)

m_results2G <-  summary(m_logAJFOBA2G)

odds2G <- exp(coefficients(m_logAJFOBA2G))

conf2G <- exp(confint(m_logAJFOBA2G))

#amplitude2G <-  conf[2,2] - conf[2,1]
modeloCompleto2G <- car::Anova(m_logAJFOBA2G, type = '3')

Coeficientes2G <- paste0((round(exp(m_logAJFOBA2G$coefficients[2]),3)),
                       ' (',
                       round(conf2G[2,1],3),
                       ';',
                       round(conf2G[2,2],3), ')')

ve2G <- paste0((round(1 - exp(m_logAJFOBA2G$coefficients[2]),3)),
             ' (',
             round((1 - conf2G[2,2]),3),
             ';',
             round((1 - conf2G[2,1]),3), ')')

Retorno_modelo2G <-  data.frame(Coeficientes2G,
                              ve2G,
                              P_valor = round(coef(summary(m_logAJFOBA2G))[,'Pr(>|z|)'][2],3))
Retorno_modelo2G
```


# Outras Vacinas (Individual)

## CoronaVac vs Pfizer

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analisePCV <-   dados_completo  %>%
                       dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>%
                       dplyr::filter(mes != 11) %>% 
                       dplyr::filter(exp_ter_2d == 1 | exp_ter_2d == 3) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                     expPCV = dplyr::case_when(exp_ter_2d == 1 ~ "1",
                                                               exp_ter_2d == 3 ~ "0",
                                                               TRUE ~ NA_character_),
                                     expPCV = base::factor(expPCV, levels = c("0", "1"))) 
```

#### Ajustado

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: DUAS CORONAVAC E DUAS PFIZER
###################################################

m_logAJ <-  glm(resultado ~ expPCV + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analisePCV)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePCV <- dados_analisePCV %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:11]),3)),
                       ' (',
                       round(conf[2:11,1],3),
                       ';',
                       round(conf[2:11,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:11]),3)) ,
              ' (',
              round(abs(1 - conf[2:11,1]),3),
              ';',
              round(abs(1 - conf[2:11,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:11],3),
                              Amplitude = exp(confint(m_logAJ)[2:11,2] - confint(m_logAJ)[2:11,1]))
Retorno_modelo
```

#### Ajustado (Tempo)

```{r include=FALSE}
###################################################
#    MODELO AJUSTADO: DUAS  CORONAVAC POR TEMPO   #
###################################################

m_logAJ <-  glm(resultado ~ expPCV + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + data_dif_tempoDose3M + LB5, 
                family = 'binomial', 
                data = dados_analisePCV)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]

#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

 dados_analisePCV <- dados_analisePCV %>%
   dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                 deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:12]),3)),
                       ' (',
                       round(conf[2:12,1],3),
                       ';',
                       round(conf[2:12,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:12]),3)) ,
              ' (',
              round(abs(1 - conf[2:12,1]),3),
              ';',
              round(abs(1 - conf[2:12,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:12],3),
                              Amplitude = exp(confint(m_logAJ)[2:12,2] - confint(m_logAJ)[2:12,1]))
Retorno_modelo
```

A análise de resíduos representada em gráficos se encontra abaixo.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

figura_1 <-  ggplot(dados_analisePCV, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()


figura_2 <-  ggplot(dados_analisePCV, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```


## AstraZeneca vs Pfizer

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analisePAZ <-   dados_completo  %>%
                       dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>%
                       dplyr::filter(mes != 11) %>%
                       dplyr::filter(exp_ter_2d == 1 | exp_ter_2d == 2) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                     expPAZ = dplyr::case_when(exp_ter_2d == 1 ~ "1",
                                                               exp_ter_2d == 2 ~ "0",
                                                               TRUE ~ NA_character_),
                                     expPAZ = base::factor(expPAZ, levels = c("0", "1"))) 
```

#### Ajustado 

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: DUAS ASTRAZENECA E DUAS PFIZER
###################################################

m_logAJ <-  glm(resultado ~ expPAZ + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analisePAZ)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePAZ <- dados_analisePAZ %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

#### Ajustado (Tempo)

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: DUAS VACINAS ASTRAZENECA + TEMPO
###################################################

m_logAJ <-  glm(resultado ~ expPAZ + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + data_dif_tempoDose3M + LB5, 
                family = 'binomial', 
                data = dados_analisePAZ)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePAZ <- dados_analisePAZ %>%
                      dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                                    deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes,
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

figura_1 <-  ggplot(dados_analisePAZ, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()


figura_2 <-  ggplot(dados_analisePAZ, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3

```

## Janssen vs Pfizer

```{r message=FALSE, warning=FALSE, include=FALSE}
dados_analisePJS <-   dados_completo  %>%
                       dplyr::mutate(mes  = lubridate::month(LB_creation_date)) %>%
                       dplyr::filter(mes != 11) %>%
                       dplyr::filter(exp_ter_2d == 1 | exp_ter_2d == 4) %>%
                       dplyr::filter(!(is.na(resultado))) %>%
                       dplyr::filter(!(resultado == "3")) %>% 
                       dplyr::mutate(resultado = base::factor(resultado, levels = c("2", "1")),
                                     expPJS = dplyr::case_when(exp_ter_2d == 1 ~ "1",
                                                               exp_ter_2d == 4 ~ "0",
                                                               TRUE ~ NA_character_),
                                     expPJS = base::factor(expPJS, levels = c("0", "1"))) 
```

#### Ajustado 

```{r echo=TRUE, message=FALSE, warning=FALSE}
###################################################
# MODELO AJUSTADO: UMA JANSSEN E DUAS PFIZER
###################################################

m_logAJ <-  glm(resultado ~ expPJS + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + LB5, 
                family = 'binomial', 
                data = dados_analisePJS)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePJS <- dados_analisePJS %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')


Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

#### Ajustado (Tempo)

```{r echo=TRUE, message=FALSE, warning=FALSE}
###############################################
# MODELO AJUSTADO: UMA DOSE JANSSEN + TEMPO
###############################################

m_logAJ <-  glm(resultado ~ expPJS + idade_cat4 + sexo + LB_indice_charlson_cat2 + cat_imc0 + quartil_analise + data_dif_tempoDose3M + LB5, 
                family = 'binomial', 
                data = dados_analisePJS)

m_results <-  summary(m_logAJ)
odds <- exp(coefficients(m_logAJ))
conf <- exp(confint(m_logAJ))
amplitude <-  conf[2,2] - conf[2,1]
#car::Anova(m_logAJ, type = '3')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

probabilitiesAJ <- predict(m_logAJ, type = "response")

dados_analisePJS <- dados_analisePJS %>%
  dplyr::mutate(logit_modeloAJ    = log(probabilitiesAJ/(1-probabilitiesAJ)),
                deviance_modeloAJ = residuals(m_logAJ, type = "deviance"))

Coeficientes <- paste0((round(exp(m_logAJ$coefficients[2:5]),3)),
                       ' (',
                       round(conf[2:5,1],3),
                       ';',
                       round(conf[2:5,2],3),
                       ')')

ve <- paste0((round(1 - exp(m_logAJ$coefficients[2:5]),3)) ,
              ' (',
              round(abs(1 - conf[2:5,1]),3),
              ';',
              round(abs(1 - conf[2:5,2]),3), ')')

Retorno_modelo <-  data.frame(Coeficientes, 
                              ve,
                              P_valor = round(coef(summary(m_logAJ))[,'Pr(>|z|)'][2:5],3),
                              Amplitude = exp(confint(m_logAJ)[2:5,2] - confint(m_logAJ)[2:5,1]))
Retorno_modelo
```

##### Resíduos

A análise de resíduos representada em gráficos se encontra abaixo.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
figura_1 <-  ggplot(dados_analisePJS, aes(y = deviance_modeloAJ, x = semana_do_estudo))+
  geom_point(size = 0.5, alpha = 0.1) +
  geom_smooth(method = "loess") +
  theme_bw()

figura_2 <-  ggplot(dados_analisePJS, aes(y = logit_modeloAJ, x = semana_do_estudo)) +
  geom_point() +
  geom_hline(yintercept = 0, color = "red") +
  geom_smooth() +
  theme_bw()

f3 <- ggpubr::ggarrange(figura_1, figura_2)
f3
```











